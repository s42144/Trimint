<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trimint - Telegram Mining App</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    
    <!-- Monetag Ads SDK -->
    <script src='//libtl.com/sdk.js' data-zone='10290264' data-sdk='show_10290264'></script>
    
    <!-- TON Connect SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --bg-primary: #0a0e27;
            --bg-secondary: #151933;
            --bg-card: #1e2140;
            --text-primary: #ffffff;
            --text-secondary: #a0a9c9;
            --border-color: #2a2e4a;
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        body.light-theme {
            --bg-primary: #f8f9fa;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --border-color: #e0e4e8;
            --shadow-color: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            transition: all 0.3s ease;
        }

        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            opacity: 0.1;
            z-index: -1;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .coin-loader {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            animation: coinSpin 2s linear infinite;
        }

        @keyframes coinSpin {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }

        .loading-text {
            color: var(--text-primary);
            font-size: 18px;
            font-weight: 600;
        }

        .referral-welcome {
            text-align: center;
            color: var(--text-secondary);
            margin-top: 10px;
            font-size: 14px;
        }

        .header {
            background: var(--bg-secondary);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-container {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--primary-gradient);
            padding: 8px 16px;
            border-radius: 25px;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .balance-coin {
            width: 24px;
            height: 24px;
        }

        .balance-amount {
            font-size: 18px;
            font-weight: 700;
            color: white;
        }

        .level-badge {
            background: var(--warning-gradient);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .theme-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .content-area {
            padding-bottom: 100px;
            min-height: calc(100vh - 80px);
        }

        .page {
            display: none;
            animation: pageFadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes pageFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .farming-section {
            text-align: center;
            padding: 40px 20px;
        }

        .main-coin {
            width: 150px;
            height: 150px;
            margin: 0 auto 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            filter: drop-shadow(0 10px 25px var(--shadow-color));
        }

        .main-coin:hover {
            transform: scale(1.05);
        }

        .main-coin.farming {
            animation: farmingPulse 2s ease-in-out infinite;
        }

        @keyframes farmingPulse {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 10px 25px rgba(79, 172, 254, 0.5)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 15px 35px rgba(79, 172, 254, 0.8)); }
        }

        .farming-button {
            background: var(--success-gradient);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow-color);
            margin: 10px;
        }

        .farming-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-color);
        }

        .farming-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .countdown-timer {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }

        .token-animation {
            position: fixed;
            font-size: 20px;
            font-weight: 700;
            color: #4facfe;
            pointer-events: none;
            z-index: 1000;
            animation: tokenFloat 2s ease-out forwards;
        }

        @keyframes tokenFloat {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }

        .task-list {
            padding: 20px;
        }

        .task-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .task-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            object-fit: cover;
        }

        .task-info {
            flex: 1;
        }

        .task-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .task-reward {
            font-size: 14px;
            color: #4facfe;
            font-weight: 600;
        }

        .task-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .task-button:hover:not(:disabled) {
            transform: scale(1.05);
        }

        .task-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .leaderboard-list {
            padding: 20px;
        }

        .leaderboard-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .rank-number {
            width: 30px;
            height: 30px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .rank-number.gold {
            background: var(--warning-gradient);
        }

        .rank-number.silver {
            background: linear-gradient(135deg, #c0c0c0, #808080);
        }

        .rank-number.bronze {
            background: linear-gradient(135deg, #cd7f32, #8b4513);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 3px;
        }

        .user-balance {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .user-level {
            font-size: 12px;
            color: #4facfe;
            font-weight: 600;
        }

        .profile-section {
            padding: 20px;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
            border: 3px solid var(--primary-gradient);
        }

        .profile-name {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .profile-stats {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stat-row:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .wallet-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .wallet-button {
            width: 100%;
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }

        .wallet-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .wallet-button.connected {
            background: var(--success-gradient);
        }

        .wallet-address {
            font-size: 12px;
            color: var(--text-secondary);
            word-break: break-all;
            margin-bottom: 10px;
        }

        .wallet-actions {
            display: flex;
            gap: 10px;
        }

        .wallet-action-btn {
            flex: 1;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 8px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .wallet-action-btn:hover {
            background: var(--primary-gradient);
            color: white;
        }

        .referral-section {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .referral-link {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .referral-link-text {
            flex: 1;
            font-size: 12px;
            color: var(--text-secondary);
            word-break: break-all;
        }

        .copy-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-button:hover {
            transform: scale(1.05);
        }

        .referral-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .stat-card-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .stat-card-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .referrals-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .referral-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .referral-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
        }

        .referral-info {
            flex: 1;
        }

        .referral-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .referral-earned {
            font-size: 12px;
            color: #4facfe;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 10px 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .nav-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 10px;
        }

        .nav-button:hover {
            background: var(--bg-card);
        }

        .nav-button.active {
            color: #667eea;
        }

        .nav-button.home {
            background: var(--primary-gradient);
            color: white;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            padding: 0;
            margin-top: -30px;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .nav-button.home:hover {
            transform: scale(1.1);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
        }

        .nav-button.home .nav-icon {
            width: 30px;
            height: 30px;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }

        .nav-button.home .nav-label {
            display: none;
        }

        .settings-section {
            padding: 20px;
        }

        .setting-item {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .setting-label {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--primary-gradient);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .toggle-switch.active::after {
            left: 26px;
        }

        .ads-section {
            padding: 20px;
            text-align: center;
        }

        .ads-button {
            background: var(--secondary-gradient);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow-color);
            margin: 10px 0;
        }

        .ads-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--shadow-color);
        }

        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 15px;
            padding: 15px 25px;
            color: var(--text-primary);
            font-weight: 600;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow-color);
        }

        .toast.show {
            opacity: 1;
        }

        .success-toast {
            background: var(--success-gradient);
            color: white;
            border: none;
        }

        .error-toast {
            background: var(--secondary-gradient);
            color: white;
            border: none;
        }

        @media (max-width: 380px) {
            .balance-amount {
                font-size: 16px;
            }
            
            .main-coin {
                width: 120px;
                height: 120px;
            }
            
            .nav-button {
                padding: 5px 8px;
            }
            
            .nav-label {
                font-size: 10px;
            }
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="background-animation"></div>
    
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="Loading" class="coin-loader">
        <div class="loading-text">Loading Trimint...</div>
        <div class="referral-welcome" id="referralWelcome"></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="balance-container">
                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM" class="balance-coin">
                <span class="balance-amount" id="balance">0</span>
            </div>
            <div class="level-badge" id="levelBadge">BRONZE</div>
            <button class="theme-toggle" id="themeToggle">
                <span id="themeIcon">ðŸŒ™</span>
            </button>
        </div>
    </header>

    <!-- Content Area -->
    <main class="content-area">
        <!-- Home Page -->
        <div class="page active" id="homePage">
            <div class="farming-section">
                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="Farm Coin" class="main-coin" id="mainCoin">
                <div class="countdown-timer" id="countdownTimer">Start Farming</div>
                <button class="farming-button" id="farmingButton">Start Farming</button>
                <div style="color: var(--text-secondary); font-size: 14px; margin-top: 10px;">
                    Earn 0.001 TRM per second for 12 hours
                </div>
            </div>
        </div>

        <!-- Tasks Page -->
        <div class="page" id="tasksPage">
            <div class="task-list" id="taskList">
                <!-- Tasks will be loaded here -->
            </div>
            <div class="ads-section">
                <button class="ads-button" id="watchAdsBtn">ðŸ“º Watch Ads (Earn 1 TRM)</button>
            </div>
        </div>

        <!-- Leaderboard Page -->
        <div class="page" id="leaderboardPage">
            <div class="leaderboard-list" id="leaderboardList">
                <!-- Leaderboard will be loaded here -->
            </div>
        </div>

        <!-- Profile Page -->
        <div class="page" id="profilePage">
            <div class="profile-section">
                <div class="profile-header">
                    <img src="https://via.placeholder.com/80" alt="Profile" class="profile-avatar" id="profileAvatar">
                    <div class="profile-name" id="profileName">Loading...</div>
                </div>

                <div class="profile-stats">
                    <div class="stat-row">
                        <span class="stat-label">Level</span>
                        <span class="stat-value" id="profileLevel">BRONZE</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Balance</span>
                        <span class="stat-value" id="profileBalance">0 TRM</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Friends</span>
                        <span class="stat-value" id="totalFriends">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Total Earned</span>
                        <span class="stat-value" id="totalEarned">0 TRM</span>
                    </div>
                </div>

                <div class="wallet-section">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">TON Wallet</h3>
                    <button class="wallet-button" id="walletButton">Connect TON Wallet</button>
                    <div class="wallet-address" id="walletAddress" style="display: none;"></div>
                    <div class="wallet-actions" id="walletActions" style="display: none;">
                        <button class="wallet-action-btn" id="copyAddressBtn">ðŸ“‹ Copy</button>
                        <button class="wallet-action-btn" id="disconnectWalletBtn">ðŸ”Œ Disconnect</button>
                    </div>
                </div>

                <div class="referral-section">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">Referral Program</h3>
                    <div class="referral-link">
                        <span class="referral-link-text" id="referralLink">Loading...</span>
                        <button class="copy-button" id="copyReferralBtn">Copy</button>
                    </div>
                    <div class="referral-stats">
                        <div class="stat-card">
                            <div class="stat-card-value" id="referralCount">0</div>
                            <div class="stat-card-label">Total Referrals</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="referralEarned">0</div>
                            <div class="stat-card-label">Referral Earned</div>
                        </div>
                    </div>
                    <div class="referrals-list" id="referralsList">
                        <!-- Referrals will be loaded here -->
                    </div>
                </div>

                <div class="settings-section">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);">Settings</h3>
                    <div class="setting-item">
                        <span class="setting-label">Notifications</span>
                        <div class="toggle-switch active" id="notificationsToggle"></div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Sound Effects</span>
                        <div class="toggle-switch active" id="soundToggle"></div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Vibration</span>
                        <div class="toggle-switch" id="vibrationToggle"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-container">
            <button class="nav-button home active" id="homeNav">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span class="nav-label">Home</span>
            </button>
            <button class="nav-button" id="tasksNav">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
                <span class="nav-label">Tasks</span>
            </button>
            <button class="nav-button" id="leaderboardNav">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M7.5 21L2 12h5.5l2.5 3 2.5-3H18l-5.5 9H7.5zm10.5-9H22L12.5 3H12l3.5 5.5L11 13h7z"/>
                </svg>
                <span class="nav-label">Leaderboard</span>
            </button>
            <button class="nav-button" id="profileNav">
                <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <span class="nav-label">Profile</span>
            </button>
        </div>
    </nav>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
            authDomain: "msc-by-shawon.firebaseapp.com",
            projectId: "msc-by-shawon",
            storageBucket: "msc-by-shawon.firebasestorage.app",
            messagingSenderId: "432753389120",
            appId: "1:432753389120:web:dcbb46ca39408a405579a5",
            measurementId: "G-8LHGLJSSEE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const analytics = firebase.analytics();

        // Global Variables
        let currentUser = null;
        let userData = null;
        let farmingInterval = null;
        let farmingEndTime = null;
        let tonConnectUI = null;
        let isDarkTheme = true;

        // Telegram Bot API
        const telegramBotToken = "8099896534:AAFmOTkOjLC8RSSJy-dXtjPQotF3hJlyXTQ";

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            initializeTonConnect();
            loadUserSettings();
        });

        async function initializeApp() {
            try {
                // Initialize Telegram Web App
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.ready();
                    window.Telegram.WebApp.expand();
                    
                    // Get user data from Telegram
                    const telegramUser = window.Telegram.WebApp.initDataUnsafe?.user;
                    if (telegramUser) {
                        currentUser = {
                            id: telegramUser.id,
                            name: telegramUser.first_name + (telegramUser.last_name ? ' ' + telegramUser.last_name : ''),
                            username: telegramUser.username || '',
                            photo_url: telegramUser.photo_url || ''
                        };
                    }
                }

                // Fallback for testing without Telegram
                if (!currentUser) {
                    const urlParams = new URLSearchParams(window.location.search);
                    const startParam = urlParams.get('startapp');
                    
                    if (startParam) {
                        // User came from referral link
                        currentUser = {
                            id: Math.floor(Math.random() * 1000000),
                            name: 'Test User',
                            username: 'testuser',
                            photo_url: ''
                        };
                        handleReferral(startParam);
                    } else {
                        currentUser = {
                            id: Math.floor(Math.random() * 1000000),
                            name: 'Test User',
                            username: 'testuser',
                            photo_url: ''
                        };
                    }
                }

                await loadUserData();
                updateUI();
                hideLoadingScreen();
                
                // Load tasks and leaderboard
                loadTasks();
                loadLeaderboard();
                
            } catch (error) {
                console.error('App initialization error:', error);
                showToast('Error initializing app', 'error');
                hideLoadingScreen();
            }
        }

        async function loadUserData() {
            try {
                const userRef = database.ref('users/' + currentUser.id);
                const snapshot = await userRef.once('value');
                
                if (snapshot.exists()) {
                    userData = snapshot.val();
                } else {
                    // Create new user
                    userData = {
                        id: currentUser.id,
                        name: currentUser.name,
                        username: currentUser.username,
                        photo_url: currentUser.photo_url,
                        balance: 0,
                        level: 'BRONZE',
                        totalEarned: 0,
                        referrals: 0,
                        referralEarned: 0,
                        referralsList: [],
                        farmingEndTime: null,
                        completedTasks: [],
                        walletConnected: false,
                        walletAddress: null,
                        joinedAt: Date.now(),
                        lastActive: Date.now()
                    };
                    await userRef.set(userData);
                }
                
                // Update last active
                userData.lastActive = Date.now();
                await userRef.update({ lastActive: Date.now() });
                
            } catch (error) {
                console.error('Error loading user data:', error);
                showToast('Error loading user data', 'error');
            }
        }

        async function saveUserData() {
            try {
                if (userData && currentUser) {
                    await database.ref('users/' + currentUser.id).set(userData);
                }
            } catch (error) {
                console.error('Error saving user data:', error);
            }
        }

        function updateUI() {
            if (!userData) return;
            
            // Update balance
            document.getElementById('balance').textContent = userData.balance.toFixed(3);
            document.getElementById('profileBalance').textContent = userData.balance.toFixed(3) + ' TRM';
            
            // Update level
            const level = calculateLevel(userData.balance);
            userData.level = level;
            document.getElementById('levelBadge').textContent = level;
            document.getElementById('profileLevel').textContent = level;
            
            // Update profile info
            document.getElementById('profileName').textContent = userData.name;
            if (userData.photo_url) {
                document.getElementById('profileAvatar').src = userData.photo_url;
            }
            
            // Update referral stats
            document.getElementById('totalFriends').textContent = userData.referrals;
            document.getElementById('referralCount').textContent = userData.referrals;
            document.getElementById('referralEarned').textContent = userData.referralEarned.toFixed(0);
            document.getElementById('totalEarned').textContent = userData.totalEarned.toFixed(3);
            
            // Update referral link
            const referralLink = `https://t.me/TrimintBot/open?startapp=${currentUser.id}`;
            document.getElementById('referralLink').textContent = referralLink;
            
            // Update farming status
            if (userData.farmingEndTime && userData.farmingEndTime > Date.now()) {
                startFarmingDisplay();
            } else {
                resetFarmingDisplay();
            }
            
            // Load referrals
            loadReferrals();
        }

        function calculateLevel(balance) {
            if (balance >= 50000) return 'DIAMOND';
            if (balance >= 10000) return 'GOLD';
            return 'BRONZE';
        }

        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.classList.add('hidden');
        }

        function setupEventListeners() {
            // Navigation
            document.getElementById('homeNav').addEventListener('click', () => showPage('home'));
            document.getElementById('tasksNav').addEventListener('click', () => showPage('tasks'));
            document.getElementById('leaderboardNav').addEventListener('click', () => showPage('leaderboard'));
            document.getElementById('profileNav').addEventListener('click', () => showPage('profile'));
            
            // Farming
            document.getElementById('farmingButton').addEventListener('click', toggleFarming);
            document.getElementById('mainCoin').addEventListener('click', () => {
                if (farmingInterval) {
                    createTokenAnimation();
                }
            });
            
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Wallet
            document.getElementById('walletButton').addEventListener('click', connectWallet);
            document.getElementById('copyAddressBtn').addEventListener('click', copyWalletAddress);
            document.getElementById('disconnectWalletBtn').addEventListener('click', disconnectWallet);
            
            // Referral
            document.getElementById('copyReferralBtn').addEventListener('click', copyReferralLink);
            
            // Settings
            document.getElementById('notificationsToggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            document.getElementById('soundToggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            document.getElementById('vibrationToggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            // Ads
            document.getElementById('watchAdsBtn').addEventListener('click', watchAd);
        }

        function showPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageName + 'Page').classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (pageName === 'home') {
                document.getElementById('homeNav').classList.add('active');
            } else {
                document.getElementById(pageName + 'Nav').classList.add('active');
            }
        }

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            document.body.classList.toggle('light-theme');
            document.getElementById('themeIcon').textContent = isDarkTheme ? 'ðŸŒ™' : 'â˜€ï¸';
            localStorage.setItem('theme', isDarkTheme ? 'dark' : 'light');
        }

        function loadUserSettings() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                isDarkTheme = false;
                document.body.classList.add('light-theme');
                document.getElementById('themeIcon').textContent = 'â˜€ï¸';
            }
        }

        // Farming Functions
        async function toggleFarming() {
            if (farmingInterval) {
                stopFarming();
            } else {
                startFarming();
            }
        }

        async function startFarming() {
            if (userData.farmingEndTime && userData.farmingEndTime > Date.now()) {
                showToast('Farming is already in progress!', 'error');
                return;
            }
            
            farmingEndTime = Date.now() + (12 * 60 * 60 * 1000); // 12 hours
            userData.farmingEndTime = farmingEndTime;
            await saveUserData();
            
            startFarmingDisplay();
            showToast('Farming started! Earn 0.001 TRM per second', 'success');
        }

        function startFarmingDisplay() {
            if (!userData.farmingEndTime) return;
            
            const button = document.getElementById('farmingButton');
            const timer = document.getElementById('countdownTimer');
            const coin = document.getElementById('mainCoin');
            
            button.textContent = 'Farming...';
            button.disabled = true;
            coin.classList.add('farming');
            
            farmingInterval = setInterval(() => {
                const now = Date.now();
                const remaining = Math.max(0, userData.farmingEndTime - now);
                
                if (remaining > 0) {
                    const hours = Math.floor(remaining / (1000 * 60 * 60));
                    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                    
                    timer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Add 0.001 TRM every second
                    userData.balance += 0.001;
                    userData.totalEarned += 0.001;
                    updateUI();
                    
                } else {
                    stopFarming();
                }
            }, 1000);
        }

        async function stopFarming() {
            if (farmingInterval) {
                clearInterval(farmingInterval);
                farmingInterval = null;
            }
            
            userData.farmingEndTime = null;
            await saveUserData();
            
            resetFarmingDisplay();
            showToast('Farming completed! Start again to earn more', 'success');
        }

        function resetFarmingDisplay() {
            const button = document.getElementById('farmingButton');
            const timer = document.getElementById('countdownTimer');
            const coin = document.getElementById('mainCoin');
            
            button.textContent = 'Start Farming';
            button.disabled = false;
            timer.textContent = 'Start Farming';
            coin.classList.remove('farming');
        }

        function createTokenAnimation() {
            const coin = document.getElementById('mainCoin');
            const rect = coin.getBoundingClientRect();
            
            const token = document.createElement('div');
            token.className = 'token-animation';
            token.textContent = '+0.001 TRM';
            token.style.left = rect.left + rect.width / 2 + 'px';
            token.style.top = rect.top + 'px';
            
            document.body.appendChild(token);
            
            setTimeout(() => {
                token.remove();
            }, 2000);
        }

        // TON Wallet Functions
        function initializeTonConnect() {
            try {
                tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: 'https://trimint.vercel.app/tonconnect-manifest.json',
                    buttonRootId: null
                });
                
                tonConnectUI.onStatusChange(wallet => {
                    handleWalletStatusChange(wallet);
                });
            } catch (error) {
                console.error('Error initializing TON Connect:', error);
            }
        }

        async function connectWallet() {
            if (!tonConnectUI) {
                showToast('TON Connect not initialized', 'error');
                return;
            }
            
            try {
                await tonConnectUI.connectWallet();
            } catch (error) {
                console.error('Error connecting wallet:', error);
                showToast('Error connecting wallet', 'error');
            }
        }

        function handleWalletStatusChange(wallet) {
            const button = document.getElementById('walletButton');
            const address = document.getElementById('walletAddress');
            const actions = document.getElementById('walletActions');
            
            if (wallet && wallet.account) {
                const walletAddress = wallet.account.address;
                const shortAddress = walletAddress.slice(0, 6) + '...' + walletAddress.slice(-4);
                
                button.textContent = 'Connected';
                button.classList.add('connected');
                button.disabled = true;
                
                address.textContent = `Address: ${walletAddress}`;
                address.style.display = 'block';
                actions.style.display = 'flex';
                
                userData.walletConnected = true;
                userData.walletAddress = walletAddress;
                saveUserData();
                
                showToast('Wallet connected successfully', 'success');
            } else {
                button.textContent = 'Connect TON Wallet';
                button.classList.remove('connected');
                button.disabled = false;
                
                address.style.display = 'none';
                actions.style.display = 'none';
                
                userData.walletConnected = false;
                userData.walletAddress = null;
                saveUserData();
            }
        }

        async function disconnectWallet() {
            if (tonConnectUI) {
                await tonConnectUI.disconnect();
                showToast('Wallet disconnected', 'success');
            }
        }

        function copyWalletAddress() {
            if (userData.walletAddress) {
                navigator.clipboard.writeText(userData.walletAddress);
                showToast('Wallet address copied', 'success');
            }
        }

        function copyReferralLink() {
            const referralLink = `https://t.me/TrimintBot/open?startapp=${currentUser.id}`;
            navigator.clipboard.writeText(referralLink);
            showToast('Referral link copied', 'success');
        }

        // Referral Functions
        async function handleReferral(referrerId) {
            if (!currentUser || !userData || referrerId == currentUser.id) return;
            
            try {
                const referrerRef = database.ref('users/' + referrerId);
                const referrerSnapshot = await referrerRef.once('value');
                
                if (referrerSnapshot.exists()) {
                    const referrerData = referrerSnapshot.val();
                    
                    // Add referral to referrer
                    if (!referrerData.referralsList) {
                        referrerData.referralsList = [];
                    }
                    
                    // Check if already referred
                    const alreadyReferred = referrerData.referralsList.some(ref => ref.id === currentUser.id);
                    if (!alreadyReferred) {
                        referrerData.referralsList.push({
                            id: currentUser.id,
                            name: currentUser.name,
                            username: currentUser.username,
                            photo_url: currentUser.photo_url,
                            joinedAt: Date.now(),
                            earned: 5000
                        });
                        
                        referrerData.referrals += 1;
                        referrerData.referralEarned += 5000;
                        referrerData.balance += 5000;
                        referrerData.totalEarned += 5000;
                        
                        await referrerRef.update(referrerData);
                        
                        // Show referrer name on loading screen
                        document.getElementById('referralWelcome').textContent = `Referred by ${referrerData.name}`;
                    }
                }
            } catch (error) {
                console.error('Error handling referral:', error);
            }
        }

        async function loadReferrals() {
            const referralsList = document.getElementById('referralsList');
            referralsList.innerHTML = '';
            
            if (userData.referralsList && userData.referralsList.length > 0) {
                userData.referralsList.forEach(referral => {
                    const referralItem = document.createElement('div');
                    referralItem.className = 'referral-item';
                    referralItem.innerHTML = `
                        <img src="${referral.photo_url || 'https://via.placeholder.com/35'}" alt="${referral.name}" class="referral-avatar">
                        <div class="referral-info">
                            <div class="referral-name">${referral.name}</div>
                            <div class="referral-earned">Earned: ${referral.earned} TRM</div>
                        </div>
                    `;
                    referralsList.appendChild(referralItem);
                });
            } else {
                referralsList.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No referrals yet</div>';
            }
        }

        // Tasks Functions
        async function loadTasks() {
            try {
                const tasksRef = database.ref('tasks');
                const snapshot = await tasksRef.once('value');
                const tasks = snapshot.val() || {};
                
                const taskList = document.getElementById('taskList');
                taskList.innerHTML = '';
                
                // Add default "Watch Ads" task
                const defaultTask = {
                    name: 'Watch Ads',
                    description: 'Watch advertisements to earn TRM tokens',
                    reward: 1,
                    icon: 'https://via.placeholder.com/50x50/4facfe/ffffff?text=ADS',
                    link: '#'
                };
                
                // Display default task
                const defaultTaskElement = createTaskElement(defaultTask, 'default_ads');
                taskList.appendChild(defaultTaskElement);
                
                // Display other tasks
                Object.entries(tasks).forEach(([taskId, task]) => {
                    const taskElement = createTaskElement(task, taskId);
                    taskList.appendChild(taskElement);
                });
                
            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }

        function createTaskElement(task, taskId) {
            const isCompleted = userData.completedTasks && userData.completedTasks.includes(taskId);
            const isProcessing = userData.processingTasks && userData.processingTasks.includes(taskId);
            
            const taskItem = document.createElement('div');
            taskItem.className = 'task-item';
            taskItem.innerHTML = `
                <img src="${task.icon || 'https://via.placeholder.com/50x50'}" alt="${task.name}" class="task-icon">
                <div class="task-info">
                    <div class="task-name">${task.name}</div>
                    <div class="task-reward">Reward: ${task.reward} TRM</div>
                </div>
                <button class="task-button" 
                        data-task-id="${taskId}" 
                        data-task-reward="${task.reward}" 
                        data-task-link="${task.link || '#'}"
                        ${isCompleted ? 'disabled' : ''}>
                    ${isCompleted ? 'Completed' : isProcessing ? 'Processing...' : 'OPEN'}
                </button>
            `;
            
            // Add click event listener
            const button = taskItem.querySelector('.task-button');
            button.addEventListener('click', () => handleTaskClick(taskId, task));
            
            return taskItem;
        }

        async function handleTaskClick(taskId, task) {
            if (userData.completedTasks && userData.completedTasks.includes(taskId)) {
                // Task already completed, but still redirect to link
                if (task.link && task.link !== '#') {
                    window.open(task.link, '_blank');
                }
                return;
            }
            
            const button = document.querySelector(`[data-task-id="${taskId}"]`);
            button.textContent = 'Processing...';
            button.disabled = true;
            
            // Add to processing tasks
            if (!userData.processingTasks) {
                userData.processingTasks = [];
            }
            userData.processingTasks.push(taskId);
            await saveUserData();
            
            // Open task link
            if (task.link && task.link !== '#') {
                window.open(task.link, '_blank');
            }
            
            // Simulate task completion (10 seconds)
            setTimeout(async () => {
                // Add to completed tasks
                if (!userData.completedTasks) {
                    userData.completedTasks = [];
                }
                userData.completedTasks.push(taskId);
                
                // Remove from processing tasks
                userData.processingTasks = userData.processingTasks.filter(id => id !== taskId);
                
                // Add reward
                userData.balance += task.reward;
                userData.totalEarned += task.reward;
                
                await saveUserData();
                updateUI();
                
                // Update button
                button.textContent = 'Completed';
                
                showToast(`Task completed! Earned ${task.reward} TRM`, 'success');
            }, 10000);
        }

        async function watchAd() {
            const button = document.getElementById('watchAdsBtn');
            button.disabled = true;
            button.textContent = 'Loading ad...';
            
            try {
                // Show Monetag ad
                if (window.libtl) {
                    window.libtl.showAd();
                    
                    // Wait for ad to complete (simulate)
                    setTimeout(async () => {
                        userData.balance += 1;
                        userData.totalEarned += 1;
                        await saveUserData();
                        updateUI();
                        
                        button.disabled = false;
                        button.textContent = 'ðŸ“º Watch Ads (Earn 1 TRM)';
                        
                        showToast('Ad watched! Earned 1 TRM', 'success');
                    }, 3000);
                } else {
                    // Fallback if ad SDK not loaded
                    setTimeout(async () => {
                        userData.balance += 1;
                        userData.totalEarned += 1;
                        await saveUserData();
                        updateUI();
                        
                        button.disabled = false;
                        button.textContent = 'ðŸ“º Watch Ads (Earn 1 TRM)';
                        
                        showToast('Ad watched! Earned 1 TRM', 'success');
                    }, 2000);
                }
            } catch (error) {
                console.error('Error showing ad:', error);
                button.disabled = false;
                button.textContent = 'ðŸ“º Watch Ads (Earn 1 TRM)';
                showToast('Error loading ad', 'error');
            }
        }

        // Leaderboard Functions
        async function loadLeaderboard() {
            try {
                const usersRef = database.ref('users');
                const snapshot = await usersRef.once('value');
                const users = snapshot.val() || {};
                
                // Convert to array and sort by balance
                const leaderboardArray = Object.values(users)
                    .filter(user => user.balance > 0)
                    .sort((a, b) => b.balance - a.balance)
                    .slice(0, 25);
                
                const leaderboardList = document.getElementById('leaderboardList');
                leaderboardList.innerHTML = '';
                
                if (leaderboardArray.length === 0) {
                    leaderboardList.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No users on leaderboard yet</div>';
                    return;
                }
                
                leaderboardArray.forEach((user, index) => {
                    const rankNumber = index + 1;
                    let rankClass = '';
                    
                    if (rankNumber === 1) rankClass = 'gold';
                    else if (rankNumber === 2) rankClass = 'silver';
                    else if (rankNumber === 3) rankClass = 'bronze';
                    
                    const leaderboardItem = document.createElement('div');
                    leaderboardItem.className = 'leaderboard-item';
                    leaderboardItem.innerHTML = `
                        <div class="rank-number ${rankClass}">${rankNumber}</div>
                        <img src="${user.photo_url || 'https://via.placeholder.com/40'}" alt="${user.name}" class="user-avatar">
                        <div class="user-info">
                            <div class="user-name">${user.name}</div>
                            <div class="user-balance">${user.balance.toFixed(3)} TRM</div>
                        </div>
                        <div class="user-level">${calculateLevel(user.balance)}</div>
                    `;
                    leaderboardList.appendChild(leaderboardItem);
                });
                
            } catch (error) {
                console.error('Error loading leaderboard:', error);
            }
        }

        // Toast Notification Function
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + type + '-toast';
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Auto-save user data periodically
        setInterval(async () => {
            if (userData) {
                await saveUserData();
            }
        }, 30000); // Save every 30 seconds

        // Update leaderboard periodically
        setInterval(() => {
            loadLeaderboard();
        }, 60000); // Update every minute
    </script>
</body>
</html>
