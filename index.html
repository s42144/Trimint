<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimint - TRM Token Mining</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4A6FFF;
            --secondary-color: #FFD700;
            --background-color: #F5F7FA;
            --card-background: #FFFFFF;
            --text-color: #333333;
            --text-secondary: #6C757D;
            --border-color: #E1E4E8;
            --success-color: #28A745;
            --danger-color: #DC3545;
            --warning-color: #FFC107;
            --info-color: #17A2B8;
            --dark-background: #1A1D29;
            --dark-card: #232937;
            --dark-text: #E1E4E8;
            --dark-border: #2D3748;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] {
            --background-color: var(--dark-background);
            --card-background: var(--dark-card);
            --text-color: var(--dark-text);
            --text-secondary: #B0B3B8;
            --border-color: var(--dark-border);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 80px;
        }

        .container {
            max-width: 100%;
            padding: 15px;
            margin: 0 auto;
            width: 100%;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .logo img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        .balance-container {
            display: flex;
            align-items: center;
            background-color: var(--card-background);
            padding: 10px 15px;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .balance-container img {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }

        .balance {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .theme-toggle:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        .content {
            flex: 1;
            display: none;
        }

        .content.active {
            display: block;
        }

        .card {
            background-color: var(--card-background);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .home-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .coin-container {
            position: relative;
            margin: 20px 0;
        }

        .coin {
            width: 150px;
            height: 150px;
            animation: float 3s ease-in-out infinite;
        }

        .coin.farming {
            animation: rotate 3s linear infinite, float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0); }
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .farming-timer {
            margin: 15px 0;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .farming-rate {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            background-color: #3A5FEF;
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #E6C300;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #C82333;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-full {
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .profile-info {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            border: 3px solid var(--primary-color);
        }

        .profile-details {
            flex: 1;
        }

        .profile-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-level {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .level-bronze {
            background-color: #CD7F32;
            color: white;
        }

        .level-gold {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .level-diamond {
            background-color: #B9F2FF;
            color: var(--text-color);
        }

        .wallet-section {
            margin-top: 20px;
        }

        .wallet-address {
            font-family: monospace;
            font-size: 0.9rem;
            background-color: rgba(0, 0, 0, 0.05);
            padding: 10px;
            border-radius: 8px;
            word-break: break-all;
            margin: 10px 0;
        }

        .wallet-buttons {
            display: flex;
            gap: 10px;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            background-color: var(--card-background);
            box-shadow: var(--shadow);
            transition: transform 0.2s;
        }

        .task-item:hover {
            transform: translateY(-3px);
        }

        .task-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            margin-right: 15px;
            object-fit: cover;
        }

        .task-details {
            flex: 1;
        }

        .task-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .task-reward {
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .task-reward img {
            width: 16px;
            height: 16px;
            margin-right: 5px;
        }

        .task-button {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            background-color: var(--card-background);
            box-shadow: var(--shadow);
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 15px;
        }

        .rank-1 {
            background-color: #FFD700;
            color: var(--text-color);
        }

        .rank-2 {
            background-color: #C0C0C0;
            color: var(--text-color);
        }

        .rank-3 {
            background-color: #CD7F32;
            color: white;
        }

        .leaderboard-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .leaderboard-details {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .leaderboard-balance {
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .leaderboard-balance img {
            width: 16px;
            height: 16px;
            margin-right: 5px;
        }

        .referral-link {
            background-color: rgba(0, 0, 0, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            word-break: break-all;
            position: relative;
        }

        .referral-link-text {
            font-family: monospace;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .referral-stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .referral-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            background-color: var(--card-background);
            box-shadow: var(--shadow);
        }

        .referral-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .referral-details {
            flex: 1;
        }

        .referral-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .referral-earned {
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .referral-earned img {
            width: 16px;
            height: 16px;
            margin-right: 5px;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-background);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            cursor: pointer;
            transition: color 0.3s;
            padding: 5px;
            border-radius: 10px;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-item i {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .nav-item.home i {
            font-size: 2rem;
        }

        .nav-item span {
            font-size: 0.8rem;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--background-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-logo {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            animation: rotate 2s linear infinite;
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .referral-info {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background-color: #ccc;
            border-radius: 13px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background-color: var(--primary-color);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow-hover);
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .ads-container {
            margin: 20px 0;
            text-align: center;
        }

        .ads-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .watch-ads-btn {
            background-color: var(--secondary-color);
            color: var(--text-color);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }

        .watch-ads-btn i {
            margin-right: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1002;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-background);
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-hover);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="Loading" class="loading-logo">
        <div class="loading-text">Loading Trimint...</div>
        <div id="referralInfo" class="referral-info" style="display: none;">
            <div>You were referred by: <span id="referralName"></span></div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <div class="container">
        <div class="header">
            <div class="logo">
                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="Trimint">
                <span>Trimint</span>
            </div>
            <div class="balance-container">
                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
                <span class="balance" id="userBalance">0 TRM</span>
            </div>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>

        <!-- Home Section -->
        <div class="content active" id="homeContent">
            <div class="card home-content">
                <h2 class="card-title">TRM Farming</h2>
                <div class="coin-container">
                    <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM Coin" class="coin" id="coin">
                </div>
                <div class="farming-timer" id="farmingTimer">Start farming to earn TRM</div>
                <div class="farming-rate">Rate: 0.001 TRM per second</div>
                <button class="btn btn-full" id="startFarmingBtn">Start Farming</button>
            </div>

            <div class="card">
                <h3 class="card-title">Daily Bonus</h3>
                <p>Claim your daily bonus of 100 TRM</p>
                <button class="btn btn-full" id="claimDailyBtn">Claim Daily Bonus</button>
            </div>

            <div class="ads-container">
                <div class="ads-title">Watch Ads for TRM</div>
                <button class="watch-ads-btn" id="watchAdsBtn">
                    <i class="fas fa-play-circle"></i> Watch Ads (Earn 1 TRM)
                </button>
                <div id="adsContainer"></div>
            </div>
        </div>

        <!-- Profile Section -->
        <div class="content" id="profileContent">
            <div class="card">
                <h2 class="card-title">Profile</h2>
                <div class="profile-info">
                    <img src="https://via.placeholder.com/80" alt="Profile" class="profile-avatar" id="profileAvatar">
                    <div class="profile-details">
                        <div class="profile-name" id="profileName">User Name</div>
                        <div class="profile-level level-bronze" id="profileLevel">Bronze</div>
                        <div class="profile-id">ID: <span id="profileId">123456789</span></div>
                    </div>
                </div>

                <div class="card-title">Statistics</div>
                <div class="referral-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalFriends">0</div>
                        <div class="stat-label">Total Friends</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="totalEarned">0</div>
                        <div class="stat-label">Total Earned</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="farmingHours">0</div>
                        <div class="stat-label">Farming Hours</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">TON Wallet</h3>
                <div id="walletInfo">
                    <p>Connect your TON wallet to manage your TRM tokens</p>
                    <button class="btn btn-full" id="connectWalletBtn">Connect TON Wallet</button>
                </div>
                <div id="walletConnected" style="display: none;">
                    <div class="wallet-address" id="walletAddress"></div>
                    <div class="wallet-buttons">
                        <button class="btn btn-small" id="copyAddressBtn">Copy Address</button>
                        <button class="btn btn-danger btn-small" id="disconnectWalletBtn">Disconnect</button>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Settings</h3>
                <div class="settings-item">
                    <span>Push Notifications</span>
                    <div class="toggle-switch" id="notificationToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-item">
                    <span>Sound Effects</span>
                    <div class="toggle-switch active" id="soundToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
                <div class="settings-item">
                    <span>Auto Farming</span>
                    <div class="toggle-switch" id="autoFarmingToggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks Section -->
        <div class="content" id="tasksContent">
            <div class="card">
                <h2 class="card-title">Tasks</h2>
                <div id="tasksList">
                    <!-- Tasks will be loaded from Firebase -->
                </div>
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div class="content" id="leaderboardContent">
            <div class="card">
                <h2 class="card-title">Leaderboard</h2>
                <div id="leaderboardList">
                    <!-- Leaderboard will be loaded from Firebase -->
                </div>
            </div>
        </div>

        <!-- Friends Section -->
        <div class="content" id="friendsContent">
            <div class="card">
                <h2 class="card-title">Referral Program</h2>
                <div class="referral-link">
                    <div class="referral-link-text" id="referralLink">https://t.me/TrimintBot/mine?startapp=123456789</div>
                    <button class="copy-button" id="copyReferralBtn">Copy</button>
                </div>

                <div class="referral-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalReferrals">0</div>
                        <div class="stat-label">Total Referrals</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="referralEarned">0</div>
                        <div class="stat-label">Referral Earned</div>
                    </div>
                </div>

                <h3 class="card-title">Your Referrals</h3>
                <div id="referralsList">
                    <!-- Referrals will be loaded from Firebase -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item home active" data-page="home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" data-page="profile">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </div>
        <div class="nav-item" data-page="tasks">
            <i class="fas fa-tasks"></i>
            <span>Tasks</span>
        </div>
        <div class="nav-item" data-page="leaderboard">
            <i class="fas fa-trophy"></i>
            <span>Leaderboard</span>
        </div>
        <div class="nav-item" data-page="friends">
            <i class="fas fa-user-friends"></i>
            <span>Friends</span>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Modal Title</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                Modal content goes here
            </div>
            <div class="modal-footer">
                <button class="btn" id="modalCancel">Cancel</button>
                <button class="btn btn-primary" id="modalConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10290264' data-sdk='show_10290264'></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
            authDomain: "msc-by-shawon.firebaseapp.com",
            projectId: "msc-by-shawon",
            storageBucket: "msc-by-shawon.firebasestorage.app",
            messagingSenderId: "432753389120",
            appId: "1:432753389120:web:dcbb46ca39408a405579a5",
            measurementId: "G-8LHGLJSSEE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Telegram Bot API
        const telegramBotToken = "8099896534:AAFmOTkOjLC8RSSJy-dXtjPQotF3hJlyXTQ";
        let telegramUser = null;
        let referralId = null;

        // Global variables
        let userBalance = 0;
        let farmingActive = false;
        let farmingStartTime = null;
        let farmingEndTime = null;
        let farmingInterval = null;
        let walletConnected = false;
        let walletAddress = null;
        let userTasks = [];
        let completedTasks = [];
        let userReferrals = [];
        let darkMode = false;

        // DOM elements
        const loadingScreen = document.getElementById('loadingScreen');
        const themeToggle = document.getElementById('themeToggle');
        const userBalanceEl = document.getElementById('userBalance');
        const startFarmingBtn = document.getElementById('startFarmingBtn');
        const farmingTimer = document.getElementById('farmingTimer');
        const coin = document.getElementById('coin');
        const claimDailyBtn = document.getElementById('claimDailyBtn');
        const watchAdsBtn = document.getElementById('watchAdsBtn');
        const adsContainer = document.getElementById('adsContainer');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileLevel = document.getElementById('profileLevel');
        const profileId = document.getElementById('profileId');
        const totalFriends = document.getElementById('totalFriends');
        const totalEarned = document.getElementById('totalEarned');
        const farmingHours = document.getElementById('farmingHours');
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const walletInfo = document.getElementById('walletInfo');
        const walletConnected = document.getElementById('walletConnected');
        const walletAddressEl = document.getElementById('walletAddress');
        const copyAddressBtn = document.getElementById('copyAddressBtn');
        const disconnectWalletBtn = document.getElementById('disconnectWalletBtn');
        const notificationToggle = document.getElementById('notificationToggle');
        const soundToggle = document.getElementById('soundToggle');
        const autoFarmingToggle = document.getElementById('autoFarmingToggle');
        const tasksList = document.getElementById('tasksList');
        const leaderboardList = document.getElementById('leaderboardList');
        const referralLink = document.getElementById('referralLink');
        const copyReferralBtn = document.getElementById('copyReferralBtn');
        const totalReferrals = document.getElementById('totalReferrals');
        const referralEarned = document.getElementById('referralEarned');
        const referralsList = document.getElementById('referralsList');
        const referralInfo = document.getElementById('referralInfo');
        const referralName = document.getElementById('referralName');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const modalClose = document.getElementById('modalClose');
        const modalCancel = document.getElementById('modalCancel');
        const modalConfirm = document.getElementById('modalConfirm');
        const notification = document.getElementById('notification');

        // Initialize Telegram Web App
        function initTelegramApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();

                telegramUser = tg.initDataUnsafe?.user;
                if (telegramUser) {
                    profileName.textContent = telegramUser.first_name + ' ' + (telegramUser.last_name || '');
                    profileId.textContent = telegramUser.id;
                    profileAvatar.src = telegramUser.photo_url || 'https://via.placeholder.com/80';

                    // Check for referral ID
                    const urlParams = new URLSearchParams(window.location.search);
                    referralId = urlParams.get('startapp');
                    
                    if (referralId && referralId !== telegramUser.id.toString()) {
                        processReferral(referralId);
                    }

                    // Generate referral link
                    referralLink.textContent = `https://t.me/TrimintBot/mine?startapp=${telegramUser.id}`;

                    // Load user data from Firebase
                    loadUserData();
                } else {
                    // For testing without Telegram
                    profileName.textContent = "Test User";
                    profileId.textContent = "123456789";
                    profileAvatar.src = 'https://via.placeholder.com/80';
                    referralLink.textContent = `https://t.me/TrimintBot/mine?startapp=123456789`;
                    
                    // Load user data from Firebase
                    loadUserData();
                }
            } else {
                // For testing without Telegram
                profileName.textContent = "Test User";
                profileId.textContent = "123456789";
                profileAvatar.src = 'https://via.placeholder.com/80';
                referralLink.textContent = `https://t.me/TrimintBot/mine?startapp=123456789`;
                
                // Load user data from Firebase
                loadUserData();
            }
        }

        // Process referral
        function processReferral(refId) {
            const referrerId = refId;
            const currentUserId = telegramUser ? telegramUser.id : "123456789";
            
            // Check if this user has already been referred
            database.ref('users/' + currentUserId).once('value').then((snapshot) => {
                const userData = snapshot.val();
                if (!userData || !userData.referredBy) {
                    // Mark this user as referred by the referrer
                    database.ref('users/' + currentUserId + '/referredBy').set(referrerId);
                    
                    // Add referral bonus to referrer
                    database.ref('users/' + referrerId + '/balance').transaction((balance) => {
                        return (balance || 0) + 5000;
                    });
                    
                    // Add to referrer's referrals list
                    database.ref('users/' + referrerId + '/referrals/' + currentUserId).set({
                        name: profileName.textContent,
                        avatar: profileAvatar.src,
                        joinedAt: firebase.database.ServerValue.TIMESTAMP,
                        earned: 0
                    });
                    
                    // Show referral info on loading screen
                    database.ref('users/' + referrerId + '/name').once('value').then((snapshot) => {
                        const referrerName = snapshot.val();
                        if (referrerName) {
                            referralName.textContent = referrerName;
                            referralInfo.style.display = 'block';
                        }
                    });
                }
            });
        }

        // Load user data from Firebase
        function loadUserData() {
            const userId = telegramUser ? telegramUser.id : "123456789";
            
            database.ref('users/' + userId).once('value').then((snapshot) => {
                const userData = snapshot.val();
                
                if (userData) {
                    userBalance = userData.balance || 0;
                    updateBalance();
                    
                    // Update user level based on balance
                    updateUserLevel();
                    
                    // Check if farming is active
                    if (userData.farmingActive && userData.farmingEndTime) {
                        const now = new Date().getTime();
                        const endTime = new Date(userData.farmingEndTime).getTime();
                        
                        if (now < endTime) {
                            farmingActive = true;
                            farmingStartTime = new Date(userData.farmingStartTime).getTime();
                            farmingEndTime = endTime;
                            startFarmingAnimation();
                        } else {
                            // Farming period ended, reset
                            database.ref('users/' + userId + '/farmingActive').set(false);
                        }
                    }
                    
                    // Load wallet info
                    if (userData.walletConnected && userData.walletAddress) {
                        walletConnected = true;
                        walletAddress = userData.walletAddress;
                        updateWalletUI();
                    }
                    
                    // Load completed tasks
                    if (userData.completedTasks) {
                        completedTasks = Object.keys(userData.completedTasks);
                    }
                    
                    // Load referrals
                    if (userData.referrals) {
                        userReferrals = userData.referrals;
                        updateReferralUI();
                    }
                    
                    // Load settings
                    if (userData.settings) {
                        if (userData.settings.darkMode) {
                            darkMode = userData.settings.darkMode;
                            toggleTheme();
                        }
                        
                        if (userData.settings.notifications) {
                            notificationToggle.classList.add('active');
                        }
                        
                        if (userData.settings.sound) {
                            soundToggle.classList.add('active');
                        }
                        
                        if (userData.settings.autoFarming) {
                            autoFarmingToggle.classList.add('active');
                        }
                    }
                } else {
                    // Create new user
                    database.ref('users/' + userId).set({
                        name: profileName.textContent,
                        avatar: profileAvatar.src,
                        balance: 0,
                        level: 'Bronze',
                        farmingActive: false,
                        walletConnected: false,
                        completedTasks: {},
                        referrals: {},
                        totalEarned: 0,
                        farmingHours: 0,
                        settings: {
                            darkMode: false,
                            notifications: false,
                            sound: true,
                            autoFarming: false
                        }
                    });
                }
                
                // Hide loading screen
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 2000);
                
                // Load tasks
                loadTasks();
                
                // Load leaderboard
                loadLeaderboard();
            });
        }

        // Update balance display
        function updateBalance() {
            userBalanceEl.textContent = userBalance.toFixed(3) + ' TRM';
            
            // Save to Firebase
            const userId = telegramUser ? telegramUser.id : "123456789";
            database.ref('users/' + userId + '/balance').set(userBalance);
            
            // Update user level
            updateUserLevel();
        }

        // Update user level based on balance
        function updateUserLevel() {
            const userId = telegramUser ? telegramUser.id : "123456789";
            let level = 'Bronze';
            let levelClass = 'level-bronze';
            
            if (userBalance >= 50000) {
                level = 'Diamond';
                levelClass = 'level-diamond';
            } else if (userBalance >= 10000) {
                level = 'Gold';
                levelClass = 'level-gold';
            }
            
            profileLevel.textContent = level;
            profileLevel.className = 'profile-level ' + levelClass;
            
            // Save to Firebase
            database.ref('users/' + userId + '/level').set(level);
        }

        // Start farming animation
        function startFarmingAnimation() {
            const userId = telegramUser ? telegramUser.id : "123456789";
            
            if (farmingActive) {
                coin.classList.add('farming');
                startFarmingBtn.textContent = 'Farming...';
                startFarmingBtn.disabled = true;
                
                farmingInterval = setInterval(() => {
                    const now = new Date().getTime();
                    
                    if (now >= farmingEndTime) {
                        // Farming completed
                        clearInterval(farmingInterval);
                        farmingActive = false;
                        coin.classList.remove('farming');
                        startFarmingBtn.textContent = 'Start Farming';
                        startFarmingBtn.disabled = false;
                        farmingTimer.textContent = 'Start farming to earn TRM';
                        
                        // Update farming hours
                        database.ref('users/' + userId + '/farmingHours').transaction((hours) => {
                            return (hours || 0) + 12;
                        });
                        
                        // Update farming status in Firebase
                        database.ref('users/' + userId + '/farmingActive').set(false);
                        
                        showNotification('Farming completed! You earned 43.2 TRM');
                    } else {
                        // Update timer
                        const remaining = farmingEndTime - now;
                        const hours = Math.floor(remaining / (1000 * 60 * 60));
                        const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                        
                        farmingTimer.textContent = `Farming: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                        
                        // Add to balance
                        userBalance += 0.001;
                        updateBalance();
                    }
                }, 1000);
            }
        }

        // Update wallet UI
        function updateWalletUI() {
            if (walletConnected) {
                walletInfo.style.display = 'none';
                walletConnected.style.display = 'block';
                walletAddressEl.textContent = walletAddress;
                connectWalletBtn.textContent = 'Connected';
                connectWalletBtn.disabled = true;
            } else {
                walletInfo.style.display = 'block';
                walletConnected.style.display = 'none';
                connectWalletBtn.textContent = 'Connect TON Wallet';
                connectWalletBtn.disabled = false;
            }
        }

        // Update referral UI
        function updateReferralUI() {
            const userId = telegramUser ? telegramUser.id : "123456789";
            
            // Update referral stats
            const referralCount = Object.keys(userReferrals).length;
            totalReferrals.textContent = referralCount;
            
            // Calculate referral earnings
            let referralEarnings = 0;
            for (const refId in userReferrals) {
                referralEarnings += userReferrals[refId].earned || 0;
            }
            referralEarned.textContent = referralEarnings;
            
            // Update total friends
            totalFriends.textContent = referralCount;
            
            // Clear referrals list
            referralsList.innerHTML = '';
            
            // Add referrals to list
            for (const refId in userReferrals) {
                const referral = userReferrals[refId];
                const referralItem = document.createElement('div');
                referralItem.className = 'referral-item';
                referralItem.innerHTML = `
                    <img src="${referral.avatar || 'https://via.placeholder.com/50'}" alt="${referral.name}" class="referral-avatar">
                    <div class="referral-details">
                        <div class="referral-name">${referral.name}</div>
                        <div class="referral-earned">
                            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
                            ${referral.earned || 0} TRM
                        </div>
                    </div>
                `;
                referralsList.appendChild(referralItem);
            }
        }

        // Load tasks from Firebase
        function loadTasks() {
            database.ref('tasks').once('value').then((snapshot) => {
                const tasks = snapshot.val();
                
                // Clear tasks list
                tasksList.innerHTML = '';
                
                // Add Watch Ads task
                const watchAdsTask = document.createElement('div');
                watchAdsTask.className = 'task-item';
                watchAdsTask.innerHTML = `
                    <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="Watch Ads" class="task-icon">
                    <div class="task-details">
                        <div class="task-name">Watch Ads</div>
                        <div class="task-reward">
                            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
                            1 TRM
                        </div>
                    </div>
                    <button class="btn task-button" id="watchAdsTaskBtn">Watch</button>
                `;
                tasksList.appendChild(watchAdsTask);
                
                document.getElementById('watchAdsTaskBtn').addEventListener('click', () => {
                    showAd();
                });
                
                // Add tasks from Firebase
                if (tasks) {
                    for (const taskId in tasks) {
                        const task = tasks[taskId];
                        const taskItem = document.createElement('div');
                        taskItem.className = 'task-item';
                        
                        let buttonState = 'OPEN';
                        let buttonClass = 'btn task-button';
                        let buttonDisabled = false;
                        
                        if (completedTasks.includes(taskId)) {
                            buttonState = 'COMPLETED';
                            buttonClass = 'btn task-button btn-success';
                        }
                        
                        taskItem.innerHTML = `
                            <img src="${task.image || 'https://via.placeholder.com/50'}" alt="${task.name}" class="task-icon">
                            <div class="task-details">
                                <div class="task-name">${task.name}</div>
                                <div class="task-reward">
                                    <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
                                    ${task.reward} TRM
                                </div>
                            </div>
                            <button class="${buttonClass}" id="task-${taskId}" ${buttonDisabled ? 'disabled' : ''}>${buttonState}</button>
                        `;
                        
                        tasksList.appendChild(taskItem);
                        
                        // Add event listener to task button
                        document.getElementById(`task-${taskId}`).addEventListener('click', () => {
                            if (!completedTasks.includes(taskId)) {
                                openTask(taskId, task.link, task.reward);
                            } else {
                                window.open(task.link, '_blank');
                            }
                        });
                    }
                }
            });
        }

        // Open task
        function openTask(taskId, taskLink, taskReward) {
            const taskButton = document.getElementById(`task-${taskId}`);
            taskButton.textContent = 'PROCESSING';
            taskButton.disabled = true;
            
            // Open task link
            window.open(taskLink, '_blank');
            
            // Simulate task completion after 10 seconds
            setTimeout(() => {
                const userId = telegramUser ? telegramUser.id : "123456789";
                
                // Mark task as completed
                completedTasks.push(taskId);
                database.ref('users/' + userId + '/completedTasks/' + taskId).set(true);
                
                // Add reward to balance
                userBalance += taskReward;
                updateBalance();
                
                // Update total earned
                database.ref('users/' + userId + '/totalEarned').transaction((total) => {
                    return (total || 0) + taskReward;
                });
                
                // Update button
                taskButton.textContent = 'COMPLETED';
                taskButton.className = 'btn task-button btn-success';
                taskButton.disabled = false;
                
                // Show notification
                showNotification(`Task completed! You earned ${taskReward} TRM`);
            }, 10000);
        }

        // Load leaderboard from Firebase
        function loadLeaderboard() {
            database.ref('users').orderByChild('balance').limitToLast(25).once('value').then((snapshot) => {
                const users = snapshot.val();
                const leaderboard = [];
                
                // Convert to array and sort by balance
                for (const userId in users) {
                    leaderboard.push({
                        id: userId,
                        ...users[userId]
                    });
                }
                
                leaderboard.sort((a, b) => b.balance - a.balance);
                
                // Clear leaderboard list
                leaderboardList.innerHTML = '';
                
                // Add users to leaderboard
                leaderboard.forEach((user, index) => {
                    const leaderboardItem = document.createElement('div');
                    leaderboardItem.className = 'leaderboard-item';
                    
                    let rankClass = '';
                    if (index === 0) rankClass = 'rank-1';
                    else if (index === 1) rankClass = 'rank-2';
                    else if (index === 2) rankClass = 'rank-3';
                    
                    leaderboardItem.innerHTML = `
                        <div class="leaderboard-rank ${rankClass}">${index + 1}</div>
                        <img src="${user.avatar || 'https://via.placeholder.com/50'}" alt="${user.name}" class="leaderboard-avatar">
                        <div class="leaderboard-details">
                            <div class="leaderboard-name">${user.name}</div>
                            <div class="leaderboard-balance">
                                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
                                ${user.balance ? user.balance.toFixed(3) : '0.000'} TRM
                            </div>
                        </div>
                    `;
                    
                    leaderboardList.appendChild(leaderboardItem);
                });
            });
        }

        // Show notification
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Toggle theme
        function toggleTheme() {
            darkMode = !darkMode;
            
            if (darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.documentElement.removeAttribute('data-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
            
            // Save to Firebase
            const userId = telegramUser ? telegramUser.id : "123456789";
            database.ref('users/' + userId + '/settings/darkMode').set(darkMode);
        }

        // Show ad
        function showAd() {
            // Show Monetag ad
            if (window.show_10290264) {
                window.show_10290264();
            }
            
            // Add reward after ad is shown
            setTimeout(() => {
                userBalance += 1;
                updateBalance();
                showNotification('You earned 1 TRM from watching ads!');
            }, 2000);
        }

        // Event listeners
        themeToggle.addEventListener('click', toggleTheme);

        startFarmingBtn.addEventListener('click', () => {
            if (!farmingActive) {
                const userId = telegramUser ? telegramUser.id : "123456789";
                
                farmingActive = true;
                farmingStartTime = new Date().getTime();
                farmingEndTime = farmingStartTime + (12 * 60 * 60 * 1000); // 12 hours
                
                // Update farming status in Firebase
                database.ref('users/' + userId + '/farmingActive').set(true);
                database.ref('users/' + userId + '/farmingStartTime').set(new Date(farmingStartTime).toISOString());
                database.ref('users/' + userId + '/farmingEndTime').set(new Date(farmingEndTime).toISOString());
                
                startFarmingAnimation();
            }
        });

        claimDailyBtn.addEventListener('click', () => {
            const userId = telegramUser ? telegramUser.id : "123456789";
            const today = new Date().toDateString();
            
            // Check if daily bonus already claimed
            database.ref('users/' + userId + '/lastDailyClaim').once('value').then((snapshot) => {
                const lastClaim = snapshot.val();
                
                if (!lastClaim || lastClaim !== today) {
                    // Add daily bonus
                    userBalance += 100;
                    updateBalance();
                    
                    // Update total earned
                    database.ref('users/' + userId + '/totalEarned').transaction((total) => {
                        return (total || 0) + 100;
                    });
                    
                    // Update last claim date
                    database.ref('users/' + userId + '/lastDailyClaim').set(today);
                    
                    // Disable button for today
                    claimDailyBtn.textContent = 'Claimed Today';
                    claimDailyBtn.disabled = true;
                    
                    showNotification('Daily bonus claimed! You earned 100 TRM');
                } else {
                    showNotification('You already claimed your daily bonus today');
                }
            });
        });

        watchAdsBtn.addEventListener('click', showAd);

        connectWalletBtn.addEventListener('click', () => {
            // Connect to TON wallet
            window.open('https://trimint.vercel.app/', '_blank');
            
            // Simulate wallet connection (in a real app, this would involve actual wallet integration)
            setTimeout(() => {
                walletConnected = true;
                walletAddress = 'EQD...'; // In a real app, this would be the actual wallet address
                
                const userId = telegramUser ? telegramUser.id : "123456789";
                
                // Update wallet status in Firebase
                database.ref('users/' + userId + '/walletConnected').set(true);
                database.ref('users/' + userId + '/walletAddress').set(walletAddress);
                
                updateWalletUI();
                showNotification('TON wallet connected successfully!');
            }, 3000);
        });

        copyAddressBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(walletAddress);
            showNotification('Wallet address copied to clipboard!');
        });

        disconnectWalletBtn.addEventListener('click', () => {
            const userId = telegramUser ? telegramUser.id : "123456789";
            
            // Update wallet status in Firebase
            database.ref('users/' + userId + '/walletConnected').set(false);
            database.ref('users/' + userId + '/walletAddress').set(null);
            
            walletConnected = false;
            walletAddress = null;
            updateWalletUI();
            showNotification('TON wallet disconnected');
        });

        notificationToggle.addEventListener('click', () => {
            notificationToggle.classList.toggle('active');
            
            const userId = telegramUser ? telegramUser.id : "123456789";
            const isActive = notificationToggle.classList.contains('active');
            
            database.ref('users/' + userId + '/settings/notifications').set(isActive);
        });

        soundToggle.addEventListener('click', () => {
            soundToggle.classList.toggle('active');
            
            const userId = telegramUser ? telegramUser.id : "123456789";
            const isActive = soundToggle.classList.contains('active');
            
            database.ref('users/' + userId + '/settings/sound').set(isActive);
        });

        autoFarmingToggle.addEventListener('click', () => {
            autoFarmingToggle.classList.toggle('active');
            
            const userId = telegramUser ? telegramUser.id : "123456789";
            const isActive = autoFarmingToggle.classList.contains('active');
            
            database.ref('users/' + userId + '/settings/autoFarming').set(isActive);
        });

        copyReferralBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(referralLink.textContent);
            showNotification('Referral link copied to clipboard!');
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.getAttribute('data-page');
                
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(navItem => {
                    navItem.classList.remove('active');
                });
                item.classList.add('active');
                
                // Update active content
                document.querySelectorAll('.content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${page}Content`).classList.add('active');
                
                // Load page-specific data
                if (page === 'leaderboard') {
                    loadLeaderboard();
                } else if (page === 'tasks') {
                    loadTasks();
                }
            });
        });

        // Modal
        modalClose.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        modalCancel.addEventListener('click', () => {
            modal.classList.remove('active');
        });

        // Initialize app
        initTelegramApp();
    </script>
</body>
</html>
