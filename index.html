<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trimint - Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='10290264' data-sdk='show_10290264'></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .user-info:hover {
            transform: scale(1.02);
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
        }

        .user-details h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .user-details p {
            font-size: 12px;
            opacity: 0.8;
        }

        .balance-display {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .main-content {
            padding: 20px;
            min-height: calc(100vh - 140px);
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .coin-container {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }

        .coin {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            position: relative;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .coin:hover {
            transform: scale(1.05);
        }

        .coin.farming {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .coin-amount {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .farming-info {
            margin-top: 20px;
            text-align: center;
        }

        .farming-timer {
            font-size: 18px;
            font-weight: 600;
            margin: 10px 0;
        }

        .farming-rate {
            font-size: 14px;
            opacity: 0.8;
            animation: fadeInOut 1s infinite;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .start-farming-btn {
            background: linear-gradient(135deg, #00C851, #00ff88);
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 200, 81, 0.3);
        }

        .start-farming-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 200, 81, 0.4);
        }

        .start-farming-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }

        .quiz-card, .task-card, .blog-post {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }

        .quiz-card:hover, .task-card:hover, .blog-post:hover {
            transform: translateY(-2px);
        }

        .quiz-question {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .quiz-option {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .quiz-option.selected {
            background: rgba(0, 200, 81, 0.3);
            border-color: #00C851;
        }

        .quiz-option.correct {
            background: rgba(0, 200, 81, 0.5);
            border-color: #00C851;
        }

        .quiz-option.incorrect {
            background: rgba(255, 59, 48, 0.5);
            border-color: #FF3B30;
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
        }

        .task-reward {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }

        .task-description {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .task-btn {
            background: linear-gradient(135deg, #007AFF, #0056CC);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .task-btn:hover {
            transform: translateY(-1px);
        }

        .task-btn.processing {
            background: #666;
        }

        .task-btn.completed {
            background: #00C851;
        }

        .blog-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }

        .blog-author {
            font-size: 14px;
            font-weight: 600;
        }

        .blog-timestamp {
            font-size: 12px;
            opacity: 0.7;
        }

        .blog-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .blog-actions {
            display: flex;
            gap: 15px;
        }

        .blog-action {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .blog-action:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .blog-action.liked {
            background: rgba(255, 59, 48, 0.5);
        }

        .referral-section {
            text-align: center;
            margin: 20px 0;
        }

        .referral-link {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin: 15px 0;
            word-break: break-all;
        }

        .copy-btn {
            background: linear-gradient(135deg, #007AFF, #0056CC);
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
        }

        .leaderboard-list {
            margin-top: 20px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            backdrop-filter: blur(10px);
        }

        .leaderboard-rank {
            font-size: 20px;
            font-weight: bold;
            width: 30px;
            text-align: center;
        }

        .leaderboard-user {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .leaderboard-username {
            font-size: 12px;
            opacity: 0.7;
        }

        .leaderboard-balance {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #333;
            padding: 5px 10px;
            border-radius: 15px;
            font-weight: 600;
            font-size: 14px;
        }

        .navigation {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 10px;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .nav-label {
            font-size: 11px;
        }

        .connect-wallet-btn {
            background: linear-gradient(135deg, #0088CC, #005580);
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0, 136, 204, 0.3);
        }

        .connect-wallet-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 136, 204, 0.4);
        }

        .wallet-status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin: 10px 0;
            text-align: center;
        }

        .floating-animation {
            position: fixed;
            pointer-events: none;
            font-size: 14px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }

        .comment-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .comment-input {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .comment-input input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
        }

        .comment-input button {
            background: linear-gradient(135deg, #007AFF, #0056CC);
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            cursor: pointer;
        }

        .comment {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .comment-author {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 1000;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="app-container">
        <div class="header" onclick="showProfile()">
            <div class="user-info">
                <img class="user-avatar" id="userAvatar" src="https://via.placeholder.com/45">
                <div class="user-details">
                    <h3 id="userName">Loading...</h3>
                    <p id="userLevel">Level 1</p>
                </div>
            </div>
            <div class="balance-display">
                <span id="userBalance">0</span> TRM
            </div>
        </div>

        <div class="main-content">
            <!-- Home Section -->
            <div id="homeSection" class="section active">
                <div class="coin-container">
                    <div class="coin" id="mainCoin">
                        <img src="https://github.com/s42144/Trimint/blob/458d3d743b279877c11199b833cc212dffb5ef45/main.png?raw=true" 
                             alt="TRM Coin" style="width: 100%; height: 100%; border-radius: 50%;">
                        <div class="coin-amount" id="coinAmount">0.001</div>
                    </div>
                    <div class="farming-info">
                        <div class="farming-timer" id="farmingTimer">Start Farming</div>
                        <div class="farming-rate" id="farmingRate">Earn 0.001 TRM per second</div>
                        <button class="start-farming-btn" id="startFarmingBtn" onclick="toggleFarming()">
                            Start Farming
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalEarned">0</div>
                        <div class="stat-label">Total Earned</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedQuizzes">0</div>
                        <div class="stat-label">Quizzes Done</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalFriends">0</div>
                        <div class="stat-label">Friends</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="tasksCompleted">0</div>
                        <div class="stat-label">Tasks Done</div>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profileSection" class="section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="profileLevel">1</div>
                        <div class="stat-label">Current Level</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileQuizzes">0</div>
                        <div class="stat-label">Completed Quizzes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileFriends">0</div>
                        <div class="stat-label">Friends Invited</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profileTasks">0</div>
                        <div class="stat-label">Tasks Completed</div>
                    </div>
                </div>

                <div class="wallet-status" id="walletStatus">
                    <p>No wallet connected</p>
                </div>

                <button class="connect-wallet-btn" onclick="connectTONWallet()">
                    Connect TON Wallet
                </button>

                <div class="leaderboard-list">
                    <h3 style="margin-bottom: 15px;">Top 25 Leaderboard</h3>
                    <div id="leaderboardList"></div>
                </div>
            </div>

            <!-- Quiz Section -->
            <div id="quizSection" class="section">
                <h2 style="margin-bottom: 20px;">TON Network Quizzes</h2>
                <div id="quizList"></div>
            </div>

            <!-- Blog Section -->
            <div id="blogSection" class="section">
                <h2 style="margin-bottom: 20px;">Community Blog</h2>
                <button class="task-btn" onclick="createBlogPost()" style="margin-bottom: 20px;">
                    Create New Post
                </button>
                <div id="blogList"></div>
            </div>

            <!-- Tasks Section -->
            <div id="tasksSection" class="section">
                <h2 style="margin-bottom: 20px;">Daily Tasks</h2>
                <div id="tasksList"></div>
            </div>

            <!-- Friends Section -->
            <div id="friendsSection" class="section">
                <div class="referral-section">
                    <h2>Invite Friends</h2>
                    <p style="margin: 10px 0;">Share your referral link and earn 5000 TRM for each friend!</p>
                    <div class="referral-link" id="referralLink">
                        Loading...
                    </div>
                    <button class="copy-btn" onclick="copyReferralLink()">Copy Referral Link</button>
                </div>

                <div style="margin: 30px 0;">
                    <h3 style="margin-bottom: 15px;">Your Referrals</h3>
                    <div id="referralsList"></div>
                </div>
            </div>
        </div>

        <div class="navigation">
            <div class="nav-item active" onclick="showSection('home')">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span class="nav-label">Home</span>
            </div>
            <div class="nav-item" onclick="showSection('quiz')">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                </svg>
                <span class="nav-label">Quiz</span>
            </div>
            <div class="nav-item" onclick="showSection('blog')">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                </svg>
                <span class="nav-label">Blog</span>
            </div>
            <div class="nav-item" onclick="showSection('tasks')">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                </svg>
                <span class="nav-label">Tasks</span>
            </div>
            <div class="nav-item" onclick="showSection('friends')">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <span class="nav-label">Friends</span>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
            authDomain: "msc-by-shawon.firebaseapp.com",
            projectId: "msc-by-shawon",
            storageBucket: "msc-by-shawon.firebasestorage.app",
            messagingSenderId: "432753389120",
            appId: "1:432753389120:web:dcbb46ca39408a405579a5",
            measurementId: "G-8LHGLJSSEE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Telegram WebApp Initialization
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // Global Variables
        let currentUser = null;
        let userData = {
            balance: 0,
            level: 1,
            completedQuizzes: [],
            completedTasks: [],
            referrals: [],
            totalEarned: 0,
            farming: {
                isActive: false,
                startTime: null,
                endTime: null,
                currentAmount: 0
            },
            tonWallet: null,
            blogPosts: [],
            likes: [],
            comments: []
        };

        // Quiz Data
        const quizzes = [
            {
                id: 1,
                question: "What is the native cryptocurrency of The Open Network?",
                options: ["Bitcoin", "Ethereum", "TON", "Cardano"],
                correct: 2,
                reward: 1500
            },
            {
                id: 2,
                question: "Who founded Telegram?",
                options: ["Mark Zuckerberg", "Pavel Durov", "Elon Musk", "Jack Dorsey"],
                correct: 1,
                reward: 1500
            },
            {
                id: 3,
                question: "What is TON's consensus mechanism?",
                options: ["Proof of Work", "Proof of Stake", "Delegated Proof of Stake", "Proof of Authority"],
                correct: 2,
                reward: 1500
            },
            {
                id: 4,
                question: "What is the block time in TON?",
                options: ["5 seconds", "10 seconds", "3 seconds", "15 seconds"],
                correct: 0,
                reward: 1500
            },
            {
                id: 5,
                question: "What programming language is used for TON smart contracts?",
                options: ["Solidity", "Rust", "FunC", "Python"],
                correct: 2,
                reward: 1500
            },
            {
                id: 6,
                question: "What is TON's maximum TPS (transactions per second)?",
                options: ["1,000", "10,000", "100,000", "1,000,000"],
                correct: 2,
                reward: 1500
            },
            {
                id: 7,
                question: "What is the name of TON's virtual machine?",
                options: ["EVM", "TVM", "WASM", "NEO"],
                correct: 1,
                reward: 1500
            },
            {
                id: 8,
                question: "When was TON originally launched?",
                options: ["2018", "2019", "2020", "2021"],
                correct: 0,
                reward: 1500
            },
            {
                id: 9,
                question: "What is TON's sharding technology called?",
                options: ["Sharding", "Dynamic Sharding", "Multi-chain", "Layer 2"],
                correct: 1,
                reward: 1500
            },
            {
                id: 10,
                question: "What is the governance token of TON?",
                options: ["TON", "GRAM", "TELE", "XTON"],
                correct: 0,
                reward: 1500
            }
        ];

        // Tasks Data
        const defaultTasks = [
            {
                id: 1,
                title: "Watch Ads",
                description: "Watch advertisements to earn TRM tokens",
                reward: 1,
                link: "#showAds",
                button: "OPEN"
            }
        ];

        // Initialize App
        function initializeApp() {
            currentUser = tg.initDataUnsafe.user;
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.first_name + ' ' + (currentUser.last_name || '');
                document.getElementById('userAvatar').src = currentUser.photo_url || 'https://via.placeholder.com/45';
                loadUserData();
                generateReferralLink();
                loadTasks();
                loadBlogPosts();
                loadLeaderboard();
            }
        }

        // Load User Data
        function loadUserData() {
            const userId = currentUser.id;
            database.ref('users/' + userId).once('value', (snapshot) => {
                if (snapshot.exists()) {
                    userData = { ...userData, ...snapshot.val() };
                } else {
                    // Create new user
                    database.ref('users/' + userId).set(userData);
                }
                updateUserInterface();
                checkFarmingStatus();
            });
        }

        // Update User Interface
        function updateUserInterface() {
            document.getElementById('userBalance').textContent = userData.balance.toFixed(3);
            document.getElementById('userLevel').textContent = 'Level ' + userData.level;
            document.getElementById('totalEarned').textContent = userData.totalEarned.toFixed(3);
            document.getElementById('completedQuizzes').textContent = userData.completedQuizzes.length;
            document.getElementById('totalFriends').textContent = userData.referrals.length;
            document.getElementById('tasksCompleted').textContent = userData.completedTasks.length;
            
            // Update profile section
            document.getElementById('profileLevel').textContent = userData.level;
            document.getElementById('profileQuizzes').textContent = userData.completedQuizzes.length;
            document.getElementById('profileFriends').textContent = userData.referrals.length;
            document.getElementById('profileTasks').textContent = userData.completedTasks.length;
            
            // Update wallet status
            if (userData.tonWallet) {
                document.getElementById('walletStatus').innerHTML = `
                    <p>Connected: ${userData.tonWallet.address.slice(0, 6)}...${userData.tonWallet.address.slice(-4)}</p>
                `;
                document.querySelector('.connect-wallet-btn').textContent = 'Disconnect Wallet';
            }
        }

        // Show Section
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Load section-specific data
            if (sectionName === 'quiz') {
                loadQuizzes();
            } else if (sectionName === 'blog') {
                loadBlogPosts();
            } else if (sectionName === 'tasks') {
                loadTasks();
            } else if (sectionName === 'friends') {
                loadReferrals();
            } else if (sectionName === 'profile') {
                loadLeaderboard();
            }
        }

        // Show Profile
        function showProfile() {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('profileSection').classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            loadLeaderboard();
        }

        // Farming Functions
        function toggleFarming() {
            if (userData.farming.isActive) {
                stopFarming();
            } else {
                startFarming();
            }
        }

        function startFarming() {
            const now = Date.now();
            const endTime = now + (12 * 60 * 60 * 1000); // 12 hours
            
            userData.farming = {
                isActive: true,
                startTime: now,
                endTime: endTime,
                currentAmount: 0
            };
            
            saveUserData();
            updateFarmingInterface();
            
            // Start farming animation
            document.getElementById('mainCoin').classList.add('farming');
            
            // Start interval
            farmingInterval = setInterval(() => {
                updateFarming();
            }, 1000);
            
            showToast('Farming started! Earn 0.001 TRM per second');
        }

        function stopFarming() {
            userData.farming.isActive = false;
            userData.farming.startTime = null;
            userData.farming.endTime = null;
            userData.farming.currentAmount = 0;
            
            saveUserData();
            updateFarmingInterface();
            
            // Stop farming animation
            document.getElementById('mainCoin').classList.remove('farming');
            
            // Clear interval
            if (farmingInterval) {
                clearInterval(farmingInterval);
                farmingInterval = null;
            }
            
            showToast('Farming stopped');
        }

        function updateFarming() {
            if (!userData.farming.isActive) return;
            
            const now = Date.now();
            const elapsed = now - userData.farming.startTime;
            const remaining = userData.farming.endTime - now;
            
            if (remaining <= 0) {
                // Farming completed
                stopFarming();
                showToast('Farming completed! You earned 43.2 TRM');
                return;
            }
            
            // Add tokens
            userData.balance += 0.001;
            userData.totalEarned += 0.001;
            userData.farming.currentAmount += 0.001;
            
            // Update interface
            updateUserInterface();
            updateFarmingTimer(remaining);
            
            // Show floating animation
            showFloatingAnimation('+0.001 TRM');
        }

        function updateFarmingInterface() {
            const btn = document.getElementById('startFarmingBtn');
            const timer = document.getElementById('farmingTimer');
            
            if (userData.farming.isActive) {
                btn.textContent = 'Stop Farming';
                btn.style.background = 'linear-gradient(135deg, #FF3B30, #FF6B60)';
            } else {
                btn.textContent = 'Start Farming';
                btn.style.background = 'linear-gradient(135deg, #00C851, #00ff88)';
                timer.textContent = 'Start Farming';
            }
        }

        function updateFarmingTimer(remaining) {
            const hours = Math.floor(remaining / (1000 * 60 * 60));
            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
            
            document.getElementById('farmingTimer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function checkFarmingStatus() {
            if (userData.farming.isActive) {
                const now = Date.now();
                const remaining = userData.farming.endTime - now;
                
                if (remaining <= 0) {
                    stopFarming();
                } else {
                    updateFarmingInterface();
                    updateFarmingTimer(remaining);
                    document.getElementById('mainCoin').classList.add('farming');
                    farmingInterval = setInterval(() => {
                        updateFarming();
                    }, 1000);
                }
            }
        }

        function showFloatingAnimation(text) {
            const animation = document.createElement('div');
            animation.className = 'floating-animation';
            animation.textContent = text;
            animation.style.left = '50%';
            animation.style.top = '50%';
            document.body.appendChild(animation);
            
            setTimeout(() => {
                animation.remove();
            }, 2000);
        }

        // Quiz Functions
        function loadQuizzes() {
            const quizList = document.getElementById('quizList');
            quizList.innerHTML = '';
            
            quizzes.forEach((quiz, index) => {
                const isCompleted = userData.completedQuizzes.includes(quiz.id);
                
                const quizCard = document.createElement('div');
                quizCard.className = 'quiz-card';
                quizCard.innerHTML = `
                    <div class="quiz-question">Q${index + 1}: ${quiz.question}</div>
                    <div class="quiz-options">
                        ${quiz.options.map((option, i) => `
                            <div class="quiz-option ${isCompleted && i === quiz.correct ? 'correct' : ''}" 
                                 onclick="selectQuizOption(${quiz.id}, ${i})" 
                                 data-quiz="${quiz.id}" data-option="${i}">
                                ${option}
                            </div>
                        `).join('')}
                    </div>
                    ${isCompleted ? '<p style="text-align: center; margin-top: 10px; color: #00C851;">‚úÖ Completed - Earned ' + quiz.reward + ' TRM</p>' : ''}
                `;
                
                quizList.appendChild(quizCard);
            });
        }

        function selectQuizOption(quizId, optionIndex) {
            if (userData.completedQuizzes.includes(quizId)) {
                showToast('You already completed this quiz!');
                return;
            }
            
            const quiz = quizzes.find(q => q.id === quizId);
            const options = document.querySelectorAll(`[data-quiz="${quizId}"]`);
            
            // Remove previous selections
            options.forEach(option => option.classList.remove('selected', 'correct', 'incorrect'));
            
            // Mark selected option
            options[optionIndex].classList.add('selected');
            
            setTimeout(() => {
                if (optionIndex === quiz.correct) {
                    // Correct answer
                    options[optionIndex].classList.remove('selected');
                    options[optionIndex].classList.add('correct');
                    
                    // Add reward
                    userData.balance += quiz.reward;
                    userData.totalEarned += quiz.reward;
                    userData.completedQuizzes.push(quizId);
                    
                    // Level up check
                    if (userData.completedQuizzes.length % 5 === 0) {
                        userData.level++;
                        showToast(`üéâ Level Up! You are now level ${userData.level}`);
                    }
                    
                    saveUserData();
                    updateUserInterface();
                    showToast(`‚úÖ Correct! You earned ${quiz.reward} TRM`);
                    
                    // Reload quizzes after delay
                    setTimeout(() => loadQuizzes(), 2000);
                } else {
                    // Incorrect answer
                    options[optionIndex].classList.remove('selected');
                    options[optionIndex].classList.add('incorrect');
                    options[quiz.correct].classList.add('correct');
                    
                    showToast('‚ùå Incorrect answer. Try again!');
                    
                    // Remove highlights after delay
                    setTimeout(() => {
                        options.forEach(option => {
                            option.classList.remove('selected', 'correct', 'incorrect');
                        });
                    }, 2000);
                }
            }, 500);
        }

        // Blog Functions
        function loadBlogPosts() {
            const blogList = document.getElementById('blogList');
            blogList.innerHTML = '';
            
            database.ref('blogPosts').orderByChild('timestamp').limitToLast(20).once('value', (snapshot) => {
                const posts = [];
                snapshot.forEach((childSnapshot) => {
                    posts.unshift({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                
                posts.forEach(post => {
                    const blogPost = document.createElement('div');
                    blogPost.className = 'blog-post';
                    
                    const isLiked = userData.likes.includes(post.id);
                    const isOwner = post.userId === currentUser.id;
                    
                    blogPost.innerHTML = `
                        <div class="blog-header">
                            <div>
                                <div class="blog-author">${post.authorName}</div>
                                <div class="blog-timestamp">${new Date(post.timestamp).toLocaleDateString()}</div>
                            </div>
                            ${isOwner ? `<button class="blog-action" onclick="deleteBlogPost('${post.id}')">Delete</button>` : ''}
                        </div>
                        <div class="blog-content">${post.content}</div>
                        <div class="blog-actions">
                            <button class="blog-action ${isLiked ? 'liked' : ''}" onclick="toggleBlogLike('${post.id}')">
                                ‚ù§Ô∏è ${post.likes || 0}
                            </button>
                            <button class="blog-action" onclick="toggleComments('${post.id}')">
                                üí¨ ${post.comments ? Object.keys(post.comments).length : 0}
                            </button>
                        </div>
                        <div class="comment-section" id="comments-${post.id}" style="display: none;">
                            <div class="comment-input">
                                <input type="text" placeholder="Write a comment..." id="commentInput-${post.id}">
                                <button onclick="addComment('${post.id}')">Send</button>
                            </div>
                            <div id="commentsList-${post.id}"></div>
                        </div>
                    `;
                    
                    blogList.appendChild(blogPost);
                    
                    // Load comments
                    if (post.comments) {
                        loadComments(post.id, post.comments);
                    }
                });
            });
        }

        function createBlogPost() {
            const content = prompt('Write your blog post:');
            if (!content || content.trim() === '') return;
            
            const post = {
                userId: currentUser.id,
                authorName: currentUser.first_name + ' ' + (currentUser.last_name || ''),
                content: content,
                timestamp: Date.now(),
                likes: 0,
                comments: {}
            };
            
            database.ref('blogPosts').push(post);
            showToast('Blog post created successfully!');
            loadBlogPosts();
        }

        function deleteBlogPost(postId) {
            if (confirm('Are you sure you want to delete this post?')) {
                database.ref('blogPosts/' + postId).remove();
                showToast('Post deleted successfully!');
                loadBlogPosts();
            }
        }

        function toggleBlogLike(postId) {
            const index = userData.likes.indexOf(postId);
            
            if (index === -1) {
                // Add like
                userData.likes.push(postId);
                database.ref('blogPosts/' + postId + '/likes').transaction((likes) => {
                    return (likes || 0) + 1;
                });
            } else {
                // Remove like
                userData.likes.splice(index, 1);
                database.ref('blogPosts/' + postId + '/likes').transaction((likes) => {
                    return Math.max((likes || 0) - 1, 0);
                });
            }
            
            saveUserData();
            loadBlogPosts();
        }

        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            commentsSection.style.display = commentsSection.style.display === 'none' ? 'block' : 'none';
        }

        function addComment(postId) {
            const input = document.getElementById(`commentInput-${postId}`);
            const content = input.value.trim();
            
            if (!content) return;
            
            const comment = {
                userId: currentUser.id,
                authorName: currentUser.first_name + ' ' + (currentUser.last_name || ''),
                content: content,
                timestamp: Date.now()
            };
            
            database.ref('blogPosts/' + postId + '/comments').push(comment);
            input.value = '';
            
            showToast('Comment added!');
            loadBlogPosts();
        }

        function loadComments(postId, comments) {
            const commentsList = document.getElementById(`commentsList-${postId}`);
            if (!commentsList) return;
            
            commentsList.innerHTML = '';
            
            Object.values(comments).forEach(comment => {
                const commentDiv = document.createElement('div');
                commentDiv.className = 'comment';
                commentDiv.innerHTML = `
                    <div class="comment-author">${comment.authorName}</div>
                    <div>${comment.content}</div>
                `;
                commentsList.appendChild(commentDiv);
            });
        }

        // Tasks Functions
        function loadTasks() {
            const tasksList = document.getElementById('tasksList');
            tasksList.innerHTML = '';
            
            // Load custom tasks from Firebase
            database.ref('tasks').once('value', (snapshot) => {
                const tasks = [];
                snapshot.forEach((childSnapshot) => {
                    tasks.push({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                
                // Add default tasks
                defaultTasks.forEach(task => {
                    if (!tasks.find(t => t.id === task.id)) {
                        tasks.push(task);
                    }
                });
                
                tasks.forEach(task => {
                    const isCompleted = userData.completedTasks.includes(task.id);
                    let buttonText = task.button;
                    let buttonClass = '';
                    
                    if (isCompleted) {
                        buttonText = 'Completed';
                        buttonClass = 'completed';
                    }
                    
                    const taskCard = document.createElement('div');
                    taskCard.className = 'task-card';
                    taskCard.innerHTML = `
                        <div class="task-header">
                            <div class="task-title">${task.title}</div>
                            <div class="task-reward">${task.reward} TRM</div>
                        </div>
                        <div class="task-description">${task.description}</div>
                        <button class="task-btn ${buttonClass}" onclick="handleTaskClick('${task.id}', '${task.link}', ${task.reward})">
                            ${buttonText}
                        </button>
                    `;
                    
                    tasksList.appendChild(taskCard);
                });
            });
        }

        function handleTaskClick(taskId, link, reward) {
            if (userData.completedTasks.includes(taskId)) {
                // Still redirect to link even if completed
                if (link === '#showAds') {
                    showAds();
                } else {
                    window.open(link, '_blank');
                }
                return;
            }
            
            const button = event.currentTarget;
            button.textContent = 'Processing...';
            button.classList.add('processing');
            button.disabled = true;
            
            if (link === '#showAds') {
                showAds();
            } else {
                window.open(link, '_blank');
            }
            
            setTimeout(() => {
                // Add reward
                userData.balance += reward;
                userData.totalEarned += reward;
                userData.completedTasks.push(taskId);
                
                saveUserData();
                updateUserInterface();
                
                button.textContent = 'Completed';
                button.classList.remove('processing');
                button.classList.add('completed');
                button.disabled = false;
                
                showToast(`‚úÖ Task completed! Earned ${reward} TRM`);
            }, 10000);
        }

        function showAds() {
            // Trigger Monetag ads
            if (window.libtl && window.libtl.showAd) {
                window.libtl.showAd();
                
                // Add 1 TRM for watching ads
                userData.balance += 1;
                userData.totalEarned += 1;
                saveUserData();
                updateUserInterface();
                
                showToast('‚úÖ Ad watched! Earned 1 TRM');
            } else {
                showToast('Ad service not available');
            }
        }

        // Friends Functions
        function generateReferralLink() {
            const referralLink = `http://t.me/TrimintBot/open?startapp=${currentUser.id}`;
            document.getElementById('referralLink').textContent = referralLink;
        }

        function copyReferralLink() {
            const referralLink = document.getElementById('referralLink').textContent;
            navigator.clipboard.writeText(referralLink).then(() => {
                showToast('Referral link copied to clipboard!');
            });
        }

        function loadReferrals() {
            const referralsList = document.getElementById('referralsList');
            referralsList.innerHTML = '';
            
            if (userData.referrals.length === 0) {
                referralsList.innerHTML = '<p style="text-align: center; opacity: 0.7;">No referrals yet</p>';
                return;
            }
            
            userData.referrals.forEach(referralId => {
                database.ref('users/' + referralId).once('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const referral = snapshot.val();
                        const referralDiv = document.createElement('div');
                        referralDiv.className = 'leaderboard-item';
                        referralDiv.innerHTML = `
                            <img class="user-avatar" src="${referral.photoUrl || 'https://via.placeholder.com/40'}" style="width: 40px; height: 40px;">
                            <div class="leaderboard-user">
                                <div class="leaderboard-name">${referral.name}</div>
                                <div class="leaderboard-username">Level ${referral.level || 1}</div>
                            </div>
                            <div class="leaderboard-balance">+5000 TRM</div>
                        `;
                        referralsList.appendChild(referralDiv);
                    }
                });
            });
        }

        // Leaderboard Functions
        function loadLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = '';
            
            database.ref('users').orderByChild('balance').limitToLast(25).once('value', (snapshot) => {
                const users = [];
                snapshot.forEach((childSnapshot) => {
                    users.push({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                
                // Sort by balance (descending)
                users.sort((a, b) => b.balance - a.balance);
                
                users.forEach((user, index) => {
                    const isCurrentUser = user.id === currentUser.id;
                    const leaderboardItem = document.createElement('div');
                    leaderboardItem.className = 'leaderboard-item';
                    if (isCurrentUser) {
                        leaderboardItem.style.background = 'rgba(255, 215, 0, 0.2)';
                    }
                    
                    leaderboardItem.innerHTML = `
                        <div class="leaderboard-rank">${index + 1}</div>
                        <img class="user-avatar" src="${user.photoUrl || 'https://via.placeholder.com/40'}" style="width: 40px; height: 40px;">
                        <div class="leaderboard-user">
                            <div class="leaderboard-name">${user.name}</div>
                            <div class="leaderboard-username">Level ${user.level || 1}</div>
                        </div>
                        <div class="leaderboard-balance">${user.balance.toFixed(3)} TRM</div>
                    `;
                    
                    leaderboardList.appendChild(leaderboardItem);
                });
            });
        }

        // TON Wallet Functions
        function connectTONWallet() {
            if (userData.tonWallet) {
                // Disconnect wallet
                userData.tonWallet = null;
                saveUserData();
                updateUserInterface();
                showToast('Wallet disconnected');
                return;
            }
            
            // Open TON wallet connection
            const tonConnectUrl = 'https://trimint.vercel.app/';
            window.open(tonConnectUrl, '_blank');
            
            // For demo purposes, simulate wallet connection
            setTimeout(() => {
                userData.tonWallet = {
                    address: 'EQD' + Math.random().toString(36).substr(2, 9).toUpperCase() + '...' + Math.random().toString(36).substr(2, 9).toUpperCase()
                };
                saveUserData();
                updateUserInterface();
                showToast('TON wallet connected successfully!');
            }, 3000);
        }

        // Utility Functions
        function saveUserData() {
            const userId = currentUser.id;
            const dataToSave = {
                ...userData,
                name: currentUser.first_name + ' ' + (currentUser.last_name || ''),
                photoUrl: currentUser.photo_url
            };
            database.ref('users/' + userId).set(dataToSave);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Handle referral from start parameter
        function handleReferral() {
            const params = new URLSearchParams(window.location.search);
            const referrerId = params.get('startapp');
            
            if (referrerId && referrerId !== currentUser.id.toString()) {
                // Add referrer to user's referrals and give bonus
                if (!userData.referrals.includes(referrerId)) {
                    userData.referrals.push(referrerId);
                    userData.balance += 5000;
                    userData.totalEarned += 5000;
                    saveUserData();
                    updateUserInterface();
                    showToast('Welcome! You received 5000 TRM from referral!');
                }
            }
        }

        // Initialize on load
        let farmingInterval = null;
        
        window.onload = function() {
            initializeApp();
            handleReferral();
        };

        // Prevent back navigation in Telegram
        window.addEventListener('popstate', function(e) {
            e.preventDefault();
            return false;
        });
    </script>
</body>
</html>
