<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimint - TON Network Mining App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src='//libtl.com/sdk.js' data-zone='10290264' data-sdk='show_10290264'></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .coin-container {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 0 auto;
        }
        
        .coin-circle {
            width: 250px;
            height: 250px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF8C00);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.4);
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .coin-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 70px rgba(255, 215, 0, 0.6);
        }
        
        .coin-circle.farming {
            animation: rotate 2s linear infinite, float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .token-animation {
            position: absolute;
            color: #FFD700;
            font-weight: bold;
            font-size: 18px;
            pointer-events: none;
            animation: rise 2s ease-out forwards;
        }
        
        @keyframes rise {
            0% { 
                opacity: 1; 
                transform: translateY(0px);
            }
            100% { 
                opacity: 0; 
                transform: translateY(-100px);
            }
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(30, 60, 114, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }
        
        .content-area {
            padding-bottom: 80px;
            min-height: 100vh;
        }
        
        .quiz-card {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            transition: all 0.3s ease;
        }
        
        .quiz-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(30, 60, 114, 0.4);
        }
        
        .task-card {
            background: linear-gradient(135deg, #3a6186 0%, #89253e 100%);
            transition: all 0.3s ease;
        }
        
        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(137, 37, 62, 0.4);
        }
        
        .blog-post {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .blog-post:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }
        
        .section-hidden {
            display: none;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .ton-connect-btn {
            background: linear-gradient(45deg, #0088CC, #0066AA);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .ton-connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 136, 204, 0.3);
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .level-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            display: inline-block;
        }
        
        .bronze {
            background: linear-gradient(45deg, #CD7F32, #B87333);
            color: white;
        }
        
        .gold {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #333;
        }
        
        .diamond {
            background: linear-gradient(45deg, #B9F2FF, #50C8E6);
            color: #333;
        }
        
        .quiz-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .quiz-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .quiz-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .attempts-badge {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .congratulations {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .congratulations-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
    </style>
    <script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <h2 class="text-white text-2xl font-bold mb-4">Loading Trimint...</h2>
        <div id="referralInfo" class="text-white text-center hidden">
            <p class="mb-2">You were referred by:</p>
            <p id="referralName" class="text-yellow-400 text-xl font-bold"></p>
        </div>
    </div>

    <div id="app" class="min-h-screen">
        <!-- Header -->
        <header class="glass-effect p-4 sticky top-0 z-50">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold gradient-text">Trimint</h1>
                <div id="userBalance" class="text-white font-semibold flex items-center">
                    <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM" class="w-6 h-6 mr-2">
                    <span id="balanceAmount">0</span> TRM
                </div>
            </div>
        </header>

        <!-- Home Section -->
        <section id="homeSection" class="content-area">
            <!-- User Info -->
            <div class="container mx-auto p-4">
                <div class="glass-effect rounded-2xl p-4 mb-6 cursor-pointer" onclick="showProfile()">
                    <div class="flex items-center space-x-4">
                        <img id="userPhoto" src="https://picsum.photos/seed/user/60/60" alt="User" class="w-16 h-16 rounded-full border-2 border-yellow-400">
                        <div class="flex-1">
                            <h3 id="userName" class="text-white font-semibold text-lg">Loading...</h3>
                            <p class="text-white/70 text-sm">Click to view profile â†’</p>
                        </div>
                        <div class="text-right">
                            <p class="text-white/70 text-sm">Level</p>
                            <p id="userLevel" class="text-white font-bold">
                                <span id="userLevelBadge" class="level-badge bronze">Bronze</span>
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Farming Section -->
                <div class="glass-effect rounded-2xl p-6 mb-6">
                    <div class="coin-container mb-4">
                        <div id="coinCircle" class="coin-circle" onclick="toggleFarming()">
                            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM Coin" class="w-40 h-40 rounded-full">
                        </div>
                    </div>
                    <div class="text-center">
                        <button id="farmButton" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-4 rounded-full font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 pulse-animation" onclick="toggleFarming()">
                            <i class="fas fa-seedling mr-2"></i>Start Farming
                        </button>
                        <div id="farmingStatus" class="mt-4 text-white hidden">
                            <p class="text-sm">Farming Progress</p>
                            <p id="farmingTime" class="text-2xl font-bold">12:00:00</p>
                            <p class="text-sm mt-2">Rate: 0.001 TRM/sec</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profileSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <button onclick="showHome()" class="mb-4 text-white/70 hover:text-white">
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </button>
                
                <div class="glass-effect rounded-2xl p-6 mb-6">
                    <div class="text-center">
                        <img id="profilePhoto" src="https://picsum.photos/seed/profile/120/120" alt="Profile" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-yellow-400">
                        <h2 id="profileName" class="text-white text-2xl font-bold mb-2">Loading...</h2>
                        <p class="text-white/70 mb-4">Premium Member</p>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="text-center">
                                <p class="text-white/70 text-sm">Level</p>
                                <p id="profileLevel" class="text-white text-2xl font-bold">
                                    <span id="profileLevelBadge" class="level-badge bronze">Bronze</span>
                                </p>
                            </div>
                            <div class="text-center">
                                <p class="text-white/70 text-sm">Balance</p>
                                <p id="profileBalance" class="text-yellow-400 text-2xl font-bold">0 TRM</p>
                            </div>
                            <div class="text-center">
                                <p class="text-white/70 text-sm">Quiz Completed</p>
                                <p id="quizCompleted" class="text-white text-2xl font-bold">0</p>
                            </div>
                            <div class="text-center">
                                <p class="text-white/70 text-sm">Friends Invited</p>
                                <p id="friendsInvited" class="text-white text-2xl font-bold">0</p>
                            </div>
                        </div>
                        
                        <div id="tonWalletInfo" class="bg-white/10 rounded-xl p-4 mb-4 hidden">
                            <p class="text-white/70 text-sm mb-2">Connected TON Wallet</p>
                            <div class="flex items-center justify-between">
                                <p id="tonWalletAddress" class="text-white font-mono text-sm truncate flex-1 mr-2"></p>
                                <button onclick="copyWalletAddress()" class="bg-white/20 text-white px-3 py-1 rounded-full text-sm">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                            <button onclick="disconnectWallet()" class="bg-red-500 text-white px-4 py-2 rounded-full mt-3 w-full">
                                <i class="fas fa-unlink mr-2"></i>Disconnect Wallet
                            </button>
                        </div>
                        
                        <button id="tonConnectBtn" class="ton-connect-btn w-full" onclick="toggleTonConnect()">
                            <i class="fas fa-wallet mr-2"></i>Connect TON Wallet
                        </button>
                    </div>
                </div>

                <!-- Leaderboard Preview -->
                <div class="glass-effect rounded-2xl p-4">
                    <h3 class="text-white font-bold text-lg mb-4">
                        <i class="fas fa-trophy text-yellow-400 mr-2"></i>Your Ranking
                    </h3>
                    <div class="space-y-3">
                        <div class="leaderboard-item rounded-xl p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <span class="text-yellow-400 font-bold">#1</span>
                                    <img src="https://picsum.photos/seed/top1/40/40" alt="User" class="w-10 h-10 rounded-full">
                                    <div>
                                        <p class="text-white font-semibold">You</p>
                                        <p class="text-white/70 text-sm">Level <span id="profileLevelSmall">Bronze</span></p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-yellow-400 font-bold">0 TRM</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quizSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-question-circle text-blue-400 mr-2"></i>TON Network Quiz
                </h2>
                <div id="quizContainer" class="quiz-container">
                    <!-- Quiz items will be loaded here -->
                </div>
                <div id="quizQuestionContainer" class="glass-effect rounded-2xl p-6 mt-6 hidden">
                    <h3 id="quizQuestionTitle" class="text-white text-xl font-bold mb-4"></h3>
                    <div id="quizQuestionOptions" class="space-y-3">
                        <!-- Quiz options will be loaded here -->
                    </div>
                    <div id="quizAttempts" class="mt-4 text-white/70 text-sm">
                        Attempts remaining: <span id="attemptsCount">3</span>
                    </div>
                </div>
                <div id="quizResult" class="glass-effect rounded-2xl p-6 mt-6 hidden">
                    <h3 class="text-white text-xl font-bold mb-4">Quiz Completed!</h3>
                    <p class="text-green-400 text-lg">You earned <span id="quizReward">1500</span> TRM tokens!</p>
                    <button onclick="backToQuizzes()" class="bg-blue-500 text-white px-6 py-2 rounded-full mt-4">Back to Quizzes</button>
                </div>
            </div>
        </section>

        <!-- Leaderboard Section -->
        <section id="leaderboardSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-trophy text-yellow-400 mr-2"></i>Top 25 Leaders
                </h2>
                <div id="leaderboardList" class="space-y-3">
                    <!-- Leaderboard will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Tasks Section -->
        <section id="tasksSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-tasks text-green-400 mr-2"></i>Earn Tasks
                </h2>
                
                <!-- Watch Ads Task (Always on top) -->
                <div class="task-card rounded-2xl p-4 mb-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="bg-white/20 p-3 rounded-xl">
                                <i class="fas fa-ad text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-white font-bold">Watch Ads</h3>
                                <p class="text-white/70 text-sm">Earn 1 TRM per ad</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-yellow-400 font-bold">1 TRM</p>
                            <button onclick="watchAd()" class="bg-white/20 text-white px-4 py-2 rounded-full text-sm mt-1">
                                Watch
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="tasksContainer" class="space-y-4">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Friends Section -->
        <section id="friendsSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-user-friends text-blue-400 mr-2"></i>Invite Friends
                </h2>
                
                <div class="glass-effect rounded-2xl p-6 mb-6">
                    <div class="text-center">
                        <p class="text-white/70 mb-4">Invite friends and earn 5000 TRM each!</p>
                        <div class="bg-white/10 rounded-xl p-4 mb-4">
                            <p class="text-white text-sm mb-2">Your referral link:</p>
                            <p id="referralLink" class="text-yellow-400 font-mono text-sm break-all">https://t.me/TrimintBot/mine?ref=12345</p>
                        </div>
                        <button onclick="copyReferralLink()" class="bg-blue-500 text-white px-6 py-3 rounded-full font-semibold w-full">
                            <i class="fas fa-copy mr-2"></i>Copy Link
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mt-6">
                        <div class="text-center">
                            <p class="text-white/70 text-sm">Total Referrals</p>
                            <p id="totalReferrals" class="text-white text-2xl font-bold">0</p>
                        </div>
                        <div class="text-center">
                            <p class="text-white/70 text-sm">Earned from Referrals</p>
                            <p id="referralEarnings" class="text-yellow-400 text-2xl font-bold">0 TRM</p>
                        </div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-2xl p-4">
                    <h3 class="text-white font-bold mb-4">Your Referrals</h3>
                    <div id="referralsList" class="space-y-3">
                        <!-- Referrals will be listed here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="container mx-auto">
                <div class="grid grid-cols-5 gap-1">
                    <button onclick="showHome()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-home text-xl mb-1" style="color: #FFD700;"></i>
                        <p class="text-xs font-medium">Home</p>
                    </button>
                    <button onclick="showQuiz()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-question-circle text-xl mb-1" style="color: #4A90E2;"></i>
                        <p class="text-xs font-medium">Quiz</p>
                    </button>
                    <button onclick="showLeaderboard()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-trophy text-xl mb-1" style="color: #FFD700;"></i>
                        <p class="text-xs font-medium">Leaderboard</p>
                    </button>
                    <button onclick="showTasks()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-tasks text-xl mb-1" style="color: #4CAF50;"></i>
                        <p class="text-xs font-medium">Tasks</p>
                    </button>
                    <button onclick="showFriends()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-user-friends text-xl mb-1" style="color: #2196F3;"></i>
                        <p class="text-xs font-medium">Friends</p>
                    </button>
                </div>
            </div>
        </nav>
    </div>

    <!-- Congratulations Modal -->
    <div id="congratulationsModal" class="congratulations hidden">
        <div class="congratulations-content">
            <i class="fas fa-trophy text-yellow-400 text-6xl mb-4"></i>
            <h2 class="text-white text-3xl font-bold mb-4">Congratulations!</h2>
            <p class="text-white text-lg mb-6">You've completed the quiz and earned <span id="congratsReward" class="text-yellow-400 font-bold">1500</span> TRM!</p>
            <button onclick="closeCongratulations()" class="bg-blue-500 text-white px-6 py-3 rounded-full font-semibold">
                Continue
            </button>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
            authDomain: "msc-by-shawon.firebaseapp.com",
            projectId: "msc-by-shawon",
            storageBucket: "msc-by-shawon.firebasestorage.app",
            messagingSenderId: "432753389120",
            appId: "1:432753389120:web:dcbb46ca39408a405579a5",
            measurementId: "G-8LHGLJSSEE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Initialize TON Connect
        let tonConnectUI;
        let isWalletConnected = false;

        // Initialize Telegram Web App
        let telegramUser = null;
        let userData = {
            userId: null,
            balance: 0,
            level: 'Bronze',
            quizCompleted: 0,
            friendsInvited: 0,
            completedTasks: 0,
            referrals: [],
            farming: false,
            farmingEndTime: null,
            tonWallet: null,
            quizAttempts: {}
        };

        // Quiz Data
        const quizData = [
            {
                id: 1,
                title: "TON Basics",
                questions: [
                    {
                        question: "What is TON?",
                        options: ["The Open Network", "Telegram Only Network", "Token Operating Network", "Trust On Network"],
                        correct: 0,
                        reward: 1500
                    },
                    {
                        question: "Who created TON?",
                        options: ["Vitalik Buterin", "Pavel Durov", "Satoshi Nakamoto", "Charles Hoskinson"],
                        correct: 1,
                        reward: 1500
                    },
                    {
                        question: "What is the native token of TON?",
                        options: ["ETH", "TON", "BTC", "TRM"],
                        correct: 1,
                        reward: 1500
                    },
                    {
                        question: "What is TON's consensus mechanism?",
                        options: ["Proof of Work", "Proof of Stake", "Delegated Proof of Stake", "Proof of Authority"],
                        correct: 2,
                        reward: 1500
                    },
                    {
                        question: "What is Telegram's role in TON?",
                        options: ["Full control", "No involvement", "Initial creator, now independent", "Mining operator"],
                        correct: 2,
                        reward: 1500
                    },
                    {
                        question: "What is TON's block time?",
                        options: ["5 seconds", "10 seconds", "30 seconds", "1 minute"],
                        correct: 0,
                        reward: 1500
                    },
                    {
                        question: "What is TON's transaction fee model?",
                        options: ["Fixed fee", "Dynamic fee", "No fee", "Gas-based fee"],
                        correct: 1,
                        reward: 1500
                    },
                    {
                        question: "What is TON's smart contract language?",
                        options: ["Solidity", "Rust", "FunC", "Go"],
                        correct: 2,
                        reward: 1500
                    },
                    {
                        question: "What is TON's sharding approach?",
                        options: ["No sharding", "Dynamic sharding", "Static sharding", "Hybrid sharding"],
                        correct: 1,
                        reward: 1500
                    },
                    {
                        question: "What is TON's maximum supply?",
                        options: ["1 billion", "5 billion", "10 billion", "Unlimited"],
                        correct: 1,
                        reward: 1500
                    }
                ]
            },
            {
                id: 2,
                title: "TON Advanced",
                questions: [
                    {
                        question: "What is TON's virtual machine called?",
                        options: ["TON VM", "TVM", "TON EVM", "TON WASM"],
                        correct: 1,
                        reward: 1500
                    },
                    {
                        question: "What is TON's storage fee model?",
                        options: ["Fixed fee", "Per-byte fee", "No fee", "Subscription-based"],
                        correct: 1,
                        reward: 1500
                    },
                    {
                        question: "What is TON's cross-chain bridge called?",
                        options: ["TON Bridge", "TON Link", "TON Connect", "TON Bridge"],
                        correct: 0,
                        reward: 1500
                    },
                    {
                        question: "What is TON's NFT standard?",
                        options: ["TON NFT", "TIP-62", "TON-721", "TON-1155"],
                        correct: 1,
                        reward: 1500
                    },
                    {
                        question: "What is TON's DeFi ecosystem called?",
                        options: ["TON DeFi", "TON Finance", "TON Swap", "TON DeFi"],
                        correct: 0,
                        reward: 1500
                    },
                    {
                        question: "What is TON's DEX called?",
                        options: ["TON Swap", "TON DEX", "TON Exchange", "TON Swap"],
                        correct: 0,
                        reward: 1500
                    },
                    {
                        question: "What is TON's stablecoin called?",
                        options: ["TON USD", "TON Stable", "TON USDT", "TON USD"],
                        correct: 0,
                        reward: 1500
                    },
                    {
                        question: "What is TON's oracle solution?",
                        options: ["TON Oracle", "TON Link", "TON Feed", "TON Oracle"],
                        correct: 0,
                        reward: 1500
                    },
                    {
                        question: "What is TON's governance model?",
                        options: ["TON DAO", "TON Governance", "TON Vote", "TON DAO"],
                        correct: 0,
                        reward: 1500
                    },
                    {
                        question: "What is TON's privacy solution?",
                        options: ["TON Privacy", "TON Mix", "TON Secret", "TON Privacy"],
                        correct: 0,
                        reward: 1500
                    }
                ]
            }
        ];

        let currentQuizId = null;
        let currentQuestionIndex = 0;
        let currentAttempts = 3;

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadTasks();
            loadLeaderboard();
        });

        function initializeApp() {
            // Initialize Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                telegramUser = tg.initDataUnsafe?.user;
                
                if (telegramUser) {
                    userData.userId = telegramUser.id;
                    document.getElementById('userName').textContent = telegramUser.first_name + ' ' + (telegramUser.last_name || '');
                    document.getElementById('profileName').textContent = telegramUser.first_name + ' ' + (telegramUser.last_name || '');
                    document.getElementById('userPhoto').src = telegramUser.photo_url || `https://picsum.photos/seed/${telegramUser.id}/60/60`;
                    document.getElementById('profilePhoto').src = telegramUser.photo_url || `https://picsum.photos/seed/${telegramUser.id}/120/120`;
                    
                    // Generate referral link
                    document.getElementById('referralLink').textContent = `https://t.me/TrimintBot/mine?ref=${telegramUser.id}`;
                    
                    // Load user data from Firebase
                    loadUserData();
                }
                
                tg.ready();
                tg.expand();
            }

            // Initialize TON Connect
            tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://trimint.vercel.app/tonconnect-manifest.json',
                buttonRootId: null
            });

            tonConnectUI.onStatusChange(wallet => {
                if (wallet) {
                    isWalletConnected = true;
                    document.getElementById('tonConnectBtn').innerHTML = '<i class="fas fa-wallet mr-2"></i>Connected';
                    document.getElementById('tonWalletInfo').classList.remove('hidden');
                    document.getElementById('tonWalletAddress').textContent = wallet.account.address.substring(0, 6) + '...' + wallet.account.address.substring(wallet.account.address.length - 4);
                    userData.tonWallet = wallet.account.address;
                    updateUserData();
                } else {
                    isWalletConnected = false;
                    document.getElementById('tonConnectBtn').innerHTML = '<i class="fas fa-wallet mr-2"></i>Connect TON Wallet';
                    document.getElementById('tonWalletInfo').classList.add('hidden');
                    userData.tonWallet = null;
                }
            });

            // Check for referral in URL
            checkReferral();

            // Hide loading screen after a short delay
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
            }, 2000);
        }

        function loadUserData() {
            if (!userData.userId) return;
            
            db.collection('users').doc(userData.userId.toString()).get()
                .then(doc => {
                    if (doc.exists) {
                        userData = { ...userData, ...doc.data() };
                        updateUI();
                        
                        // Check if farming is active
                        if (userData.farming && userData.farmingEndTime) {
                            startFarmingCountdown();
                        }
                    } else {
                        // Create new user document
                        saveUserData();
                    }
                })
                .catch(error => {
                    console.error('Error loading user data:', error);
                });
        }

        function saveUserData() {
            if (!userData.userId) return;
            
            db.collection('users').doc(userData.userId.toString()).set(userData)
                .then(() => {
                    console.log('User data saved');
                })
                .catch(error => {
                    console.error('Error saving user data:', error);
                });
        }

        function updateUserData() {
            saveUserData();
            updateUI();
        }

        function updateUI() {
            document.getElementById('balanceAmount').textContent = userData.balance.toLocaleString();
            
            // Update level based on balance
            let level = 'Bronze';
            let levelClass = 'bronze';
            
            if (userData.balance >= 50000) {
                level = 'Diamond';
                levelClass = 'diamond';
            } else if (userData.balance >= 10000) {
                level = 'Gold';
                levelClass = 'gold';
            }
            
            userData.level = level;
            
            // Update level badges
            const userLevelBadge = document.getElementById('userLevelBadge');
            const profileLevelBadge = document.getElementById('profileLevelBadge');
            const profileLevelSmall = document.getElementById('profileLevelSmall');
            
            userLevelBadge.textContent = level;
            userLevelBadge.className = `level-badge ${levelClass}`;
            
            profileLevelBadge.textContent = level;
            profileLevelBadge.className = `level-badge ${levelClass}`;
            
            profileLevelSmall.textContent = level;
            
            document.getElementById('profileBalance').textContent = userData.balance.toLocaleString() + ' TRM';
            document.getElementById('quizCompleted').textContent = userData.quizCompleted;
            document.getElementById('friendsInvited').textContent = userData.friendsInvited;
            document.getElementById('completedTasks').textContent = userData.completedTasks;
            document.getElementById('totalReferrals').textContent = userData.friendsInvited;
            document.getElementById('referralEarnings').textContent = (userData.friendsInvited * 5000).toLocaleString() + ' TRM';
            
            loadReferrals();
        }

        // Farming Functions
        let farmingInterval = null;
        let tokenAnimationInterval = null;

        function toggleFarming() {
            if (userData.farming) {
                stopFarming();
            } else {
                startFarming();
            }
        }

        function startFarming() {
            userData.farming = true;
            userData.farmingEndTime = Date.now() + (12 * 60 * 60 * 1000); // 12 hours from now
            updateUserData();
            
            document.getElementById('farmButton').innerHTML = '<i class="fas fa-stop mr-2"></i>Stop Farming';
            document.getElementById('farmingStatus').classList.remove('hidden');
            document.getElementById('coinCircle').classList.add('farming');
            
            startFarmingCountdown();
            startTokenAnimation();
        }

        function stopFarming() {
            userData.farming = false;
            userData.farmingEndTime = null;
            updateUserData();
            
            document.getElementById('farmButton').innerHTML = '<i class="fas fa-seedling mr-2"></i>Start Farming';
            document.getElementById('farmingStatus').classList.add('hidden');
            document.getElementById('coinCircle').classList.remove('farming');
            
            if (farmingInterval) {
                clearInterval(farmingInterval);
            }
            if (tokenAnimationInterval) {
                clearInterval(tokenAnimationInterval);
            }
        }

        function startFarmingCountdown() {
            if (farmingInterval) {
                clearInterval(farmingInterval);
            }
            
            farmingInterval = setInterval(() => {
                if (userData.farming && userData.farmingEndTime) {
                    const now = Date.now();
                    const remaining = userData.farmingEndTime - now;
                    
                    if (remaining <= 0) {
                        stopFarming();
                        return;
                    }
                    
                    const hours = Math.floor(remaining / (1000 * 60 * 60));
                    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                    
                    document.getElementById('farmingTime').textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Add tokens every second
                    userData.balance += 0.001;
                    updateUI();
                }
            }, 1000);
        }

        function startTokenAnimation() {
            if (tokenAnimationInterval) {
                clearInterval(tokenAnimationInterval);
            }
            
            tokenAnimationInterval = setInterval(() => {
                createTokenAnimation();
            }, 1000);
        }

        function createTokenAnimation() {
            const coinContainer = document.querySelector('.coin-container');
            const animation = document.createElement('div');
            animation.className = 'token-animation';
            animation.textContent = '+0.001 TRM';
            animation.style.left = Math.random() * 100 + 'px';
            animation.style.top = '50%';
            
            coinContainer.appendChild(animation);
            
            setTimeout(() => {
                animation.remove();
            }, 2000);
        }

        // TON Connect Functions
        function toggleTonConnect() {
            if (isWalletConnected) {
                // Wallet is already connected, do nothing
                return;
            } else {
                tonConnectUI.connectWallet();
            }
        }

        function copyWalletAddress() {
            if (userData.tonWallet) {
                navigator.clipboard.writeText(userData.tonWallet).then(() => {
                    alert('Wallet address copied to clipboard!');
                });
            }
        }

        function disconnectWallet() {
            if (tonConnectUI) {
                tonConnectUI.disconnect();
            }
        }

        // Navigation Functions
        function showHome() {
            hideAllSections();
            document.getElementById('homeSection').classList.remove('section-hidden');
        }

        function showProfile() {
            hideAllSections();
            document.getElementById('profileSection').classList.remove('section-hidden');
        }

        function showQuiz() {
            hideAllSections();
            document.getElementById('quizSection').classList.remove('section-hidden');
            loadQuizzes();
        }

        function showLeaderboard() {
            hideAllSections();
            document.getElementById('leaderboardSection').classList.remove('section-hidden');
            loadLeaderboard();
        }

        function showTasks() {
            hideAllSections();
            document.getElementById('tasksSection').classList.remove('section-hidden');
        }

        function showFriends() {
            hideAllSections();
            document.getElementById('friendsSection').classList.remove('section-hidden');
        }

        function hideAllSections() {
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('section-hidden');
            });
        }

        // Quiz Functions
        function loadQuizzes() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';
            
            quizData.forEach(quiz => {
                const quizCard = document.createElement('div');
                quizCard.className = 'quiz-item';
                
                // Check if user has attempts left for this quiz
                const attemptsLeft = userData.quizAttempts[quiz.id] ? 3 - userData.quizAttempts[quiz.id] : 3;
                
                quizCard.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-white font-bold text-lg">${quiz.title}</h3>
                        <span class="attempts-badge">${attemptsLeft} attempts left</span>
                    </div>
                    <p class="text-white/70 mb-4">${quiz.questions.length} questions</p>
                    <button onclick="startQuiz(${quiz.id})" class="bg-blue-500 text-white px-4 py-2 rounded-full w-full">
                        Start Quiz
                    </button>
                `;
                container.appendChild(quizCard);
            });
        }

        function startQuiz(quizId) {
            currentQuizId = quizId;
            currentQuestionIndex = 0;
            
            // Check if user has attempts left
            const attemptsUsed = userData.quizAttempts[quizId] || 0;
            currentAttempts = 3 - attemptsUsed;
            
            if (currentAttempts <= 0) {
                alert('You have no attempts left for this quiz!');
                return;
            }
            
            // Hide quiz list and show question container
            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('quizQuestionContainer').classList.remove('hidden');
            document.getElementById('attemptsCount').textContent = currentAttempts;
            
            // Load first question
            loadQuestion();
        }

        function loadQuestion() {
            const quiz = quizData.find(q => q.id === currentQuizId);
            if (!quiz || currentQuestionIndex >= quiz.questions.length) {
                // Quiz completed
                completeQuiz();
                return;
            }
            
            const question = quiz.questions[currentQuestionIndex];
            
            document.getElementById('quizQuestionTitle').textContent = `Question ${currentQuestionIndex + 1}: ${question.question}`;
            
            const optionsContainer = document.getElementById('quizQuestionOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = 'w-full bg-white/20 p-4 rounded-xl text-left hover:bg-white/30 transition-all text-white';
                optionButton.textContent = option;
                optionButton.onclick = () => checkAnswer(index);
                optionsContainer.appendChild(optionButton);
            });
        }

        function checkAnswer(answerIndex) {
            const quiz = quizData.find(q => q.id === currentQuizId);
            if (!quiz) return;
            
            const question = quiz.questions[currentQuestionIndex];
            
            if (answerIndex === question.correct) {
                // Correct answer
                userData.balance += question.reward;
                userData.quizCompleted++;
                updateUserData();
                
                // Move to next question
                currentQuestionIndex++;
                loadQuestion();
            } else {
                // Wrong answer
                currentAttempts--;
                document.getElementById('attemptsCount').textContent = currentAttempts;
                
                if (currentAttempts <= 0) {
                    // No attempts left, deduct penalty
                    userData.balance -= 500;
                    updateUserData();
                    
                    alert('You have no attempts left! 500 TRM has been deducted from your balance.');
                    backToQuizzes();
                } else {
                    alert(`Wrong answer! You have ${currentAttempts} attempts left.`);
                }
            }
        }

        function completeQuiz() {
            // Show congratulations modal
            document.getElementById('congratsReward').textContent = '1500';
            document.getElementById('congratulationsModal').classList.remove('hidden');
            
            // Update quiz attempts
            userData.quizAttempts[currentQuizId] = (userData.quizAttempts[currentQuizId] || 0) + 1;
            updateUserData();
        }

        function backToQuizzes() {
            document.getElementById('quizContainer').classList.remove('hidden');
            document.getElementById('quizQuestionContainer').classList.add('hidden');
            document.getElementById('quizResult').classList.add('hidden');
            loadQuizzes();
        }

        function closeCongratulations() {
            document.getElementById('congratulationsModal').classList.add('hidden');
            backToQuizzes();
        }

        // Tasks Functions
        function loadTasks() {
            // Load tasks from Firebase
            db.collection('tasks').orderBy('order').get()
                .then(querySnapshot => {
                    const tasks = [];
                    querySnapshot.forEach(doc => {
                        tasks.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    displayTasks(tasks);
                })
                .catch(error => {
                    console.error('Error loading tasks:', error);
                    // If Firebase fails, load sample tasks
                    const sampleTasks = [
                        {
                            id: 'sample1',
                            name: "Join TON Community",
                            description: "Join our official TON community group",
                            reward: 1000,
                            link: "https://t.me/toncoin",
                            photo: "https://picsum.photos/seed/task1/60/60",
                            completed: false
                        },
                        {
                            id: 'sample2',
                            name: "Follow us on X",
                            description: "Follow our official X account",
                            reward: 500,
                            link: "https://twitter.com/ton_blockchain",
                            photo: "https://picsum.photos/seed/task2/60/60",
                            completed: false
                        }
                    ];
                    displayTasks(sampleTasks);
                });
        }

        function displayTasks(tasks) {
            const container = document.getElementById('tasksContainer');
            container.innerHTML = '';
            
            tasks.forEach(task => {
                const taskCard = document.createElement('div');
                taskCard.className = 'task-card rounded-2xl p-4';
                
                // Check if user has completed this task
                const isCompleted = userData.completedTasksList && userData.completedTasksList.includes(task.id);
                
                taskCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <img src="${task.photo || 'https://picsum.photos/seed/task/60/60'}" alt="${task.name}" class="w-12 h-12 rounded-xl">
                            <div>
                                <h3 class="text-white font-bold">${task.name}</h3>
                                <p class="text-white/70 text-sm">${task.description}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-yellow-400 font-bold">${task.reward} TRM</p>
                            <button id="taskBtn${task.id}" onclick="completeTask('${task.id}', '${task.link}', ${task.reward})" class="bg-white/20 text-white px-4 py-2 rounded-full text-sm mt-1">
                                ${isCompleted ? 'Completed' : 'Open'}
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(taskCard);
            });
        }

        function completeTask(taskId, link, reward) {
            // Check if task is already completed
            if (userData.completedTasksList && userData.completedTasksList.includes(taskId)) {
                window.open(link, '_blank');
                return;
            }
            
            window.open(link, '_blank');
            const button = document.getElementById(`taskBtn${taskId}`);
            button.textContent = 'Processing...';
            
            setTimeout(() => {
                userData.balance += reward;
                userData.completedTasks++;
                
                // Add task to completed tasks list
                if (!userData.completedTasksList) {
                    userData.completedTasksList = [];
                }
                userData.completedTasksList.push(taskId);
                
                updateUserData();
                button.textContent = 'Completed';
            }, 10000);
        }

        function watchAd() {
            // Show ads using Monetag
            if (window.libtl) {
                window.libtl.showAd();
            }
            
            // Add 1 TRM after watching ad
            setTimeout(() => {
                userData.balance += 1;
                updateUserData();
                alert('You earned 1 TRM!');
            }, 5000);
        }

        // Friends Functions
        function copyReferralLink() {
            const link = document.getElementById('referralLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('Referral link copied to clipboard!');
            });
        }

        function loadReferrals() {
            // In real app, load from Firebase
            const referralsList = document.getElementById('referralsList');
            
            if (userData.referrals && userData.referrals.length > 0) {
                referralsList.innerHTML = '';
                
                userData.referrals.forEach(referralId => {
                    // Get referral data from Firebase
                    db.collection('users').doc(referralId.toString()).get()
                        .then(doc => {
                            if (doc.exists) {
                                const referralData = doc.data();
                                const referralCard = document.createElement('div');
                                referralCard.className = 'leaderboard-item rounded-xl p-3';
                                referralCard.innerHTML = `
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <img src="${referralData.photoUrl || `https://picsum.photos/seed/${referralId}/40/40`}" alt="${referralData.name}" class="w-10 h-10 rounded-full">
                                            <div>
                                                <p class="text-white font-semibold">${referralData.name}</p>
                                                <p class="text-white/70 text-sm">ID: ${referralId}</p>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-yellow-400 font-bold">${referralData.balance.toLocaleString()} TRM</p>
                                            <p class="text-white/70 text-sm">Earned: ${(referralData.balance * 0.1).toLocaleString()} TRM</p>
                                        </div>
                                    </div>
                                `;
                                referralsList.appendChild(referralCard);
                            }
                        })
                        .catch(error => {
                            console.error('Error loading referral data:', error);
                        });
                });
            } else {
                referralsList.innerHTML = '<p class="text-white/70 text-center">No referrals yet</p>';
            }
        }

        function processReferral(referrerId) {
            if (userData.userId && referrerId && userData.userId.toString() !== referrerId) {
                // Check if this user was already referred
                // In real app, check Firebase
                userData.balance += 5000;
                
                // Add user to referrer's referrals list
                db.collection('users').doc(referrerId.toString()).get()
                    .then(doc => {
                        if (doc.exists) {
                            const referrerData = doc.data();
                            if (!referrerData.referrals) {
                                referrerData.referrals = [];
                            }
                            referrerData.referrals.push(userData.userId);
                            referrerData.friendsInvited = referrerData.referrals.length;
                            
                            db.collection('users').doc(referrerId.toString()).update(referrerData);
                        }
                    })
                    .catch(error => {
                        console.error('Error updating referrer data:', error);
                    });
                
                updateUserData();
                
                // Show referral info on loading screen
                db.collection('users').doc(referrerId.toString()).get()
                    .then(doc => {
                        if (doc.exists) {
                            const referrerData = doc.data();
                            document.getElementById('referralInfo').classList.remove('hidden');
                            document.getElementById('referralName').textContent = referrerData.name || 'Unknown';
                        }
                    })
                    .catch(error => {
                        console.error('Error loading referrer name:', error);
                    });
            }
        }

        // Leaderboard Functions
        function loadLeaderboard() {
            // Load top 25 users from Firebase
            db.collection('users').orderBy('balance', 'desc').limit(25).get()
                .then(querySnapshot => {
                    const leaderboard = [];
                    querySnapshot.forEach(doc => {
                        leaderboard.push({
                            id: doc.id,
                            ...doc.data()
                        });
                    });
                    displayLeaderboard(leaderboard);
                })
                .catch(error => {
                    console.error('Error loading leaderboard:', error);
                    // If Firebase fails, load sample data
                    const sampleLeaderboard = [
                        { rank: 1, name: "Alice", balance: 50000, level: "Diamond", photoUrl: "https://picsum.photos/seed/alice/40/40" },
                        { rank: 2, name: "Bob", balance: 45000, level: "Gold", photoUrl: "https://picsum.photos/seed/bob/40/40" },
                        { rank: 3, name: "Charlie", balance: 40000, level: "Gold", photoUrl: "https://picsum.photos/seed/charlie/40/40" }
                    ];
                    displayLeaderboard(sampleLeaderboard);
                });
        }

        function displayLeaderboard(leaderboard) {
            const container = document.getElementById('leaderboardList');
            container.innerHTML = '';
            
            leaderboard.forEach((user, index) => {
                const userCard = document.createElement('div');
                userCard.className = 'leaderboard-item rounded-xl p-3';
                
                // Determine level class
                let levelClass = 'bronze';
                if (user.level === 'Gold') {
                    levelClass = 'gold';
                } else if (user.level === 'Diamond') {
                    levelClass = 'diamond';
                }
                
                userCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="text-yellow-400 font-bold">#${index + 1}</span>
                            <img src="${user.photoUrl || `https://picsum.photos/seed/${user.id}/40/40`}" alt="${user.name}" class="w-10 h-10 rounded-full">
                            <div>
                                <p class="text-white font-semibold">${user.name}</p>
                                <p class="text-white/70 text-sm">Level <span class="level-badge ${levelClass}">${user.level}</span></p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-yellow-400 font-bold">${user.balance.toLocaleString()} TRM</p>
                        </div>
                    </div>
                `;
                container.appendChild(userCard);
            });
        }

        // Check for referral in URL
        function checkReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const referrerId = urlParams.get('ref');
            if (referrerId) {
                processReferral(referrerId);
            }
        }

        // Initialize referral check
        checkReferral();
    </script>
</body>
</html>
