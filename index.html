<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimint - TON Network Mining App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src='//libtl.com/sdk.js' data-zone='10290264' data-sdk='show_10290264'></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-text {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .coin-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto;
        }
        
        .coin-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(45deg, #FFD700, #FFA500, #FF8C00);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 20px 60px rgba(255, 215, 0, 0.4);
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .coin-circle:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 70px rgba(255, 215, 0, 0.6);
        }
        
        .coin-circle.farming {
            animation: rotate 2s linear infinite, float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .token-animation {
            position: absolute;
            color: #FFD700;
            font-weight: bold;
            font-size: 18px;
            pointer-events: none;
            animation: rise 2s ease-out forwards;
        }
        
        @keyframes rise {
            0% { 
                opacity: 1; 
                transform: translateY(0px);
            }
            100% { 
                opacity: 0; 
                transform: translateY(-100px);
            }
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .content-area {
            padding-bottom: 80px;
            min-height: 100vh;
        }
        
        .quiz-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .quiz-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
        }
        
        .task-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            transition: all 0.3s ease;
        }
        
        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(245, 87, 108, 0.4);
        }
        
        .blog-post {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .blog-post:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .leaderboard-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateX(5px);
        }
        
        .section-hidden {
            display: none;
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .ton-connect-btn {
            background: linear-gradient(45deg, #0088CC, #0066AA);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .ton-connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 136, 204, 0.3);
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div id="app" class="min-h-screen">
        <!-- Header -->
        <header class="glass-effect p-4 sticky top-0 z-50">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold gradient-text">Trimint</h1>
                <div id="userBalance" class="text-white font-semibold">
                    <i class="fas fa-coins text-yellow-400"></i>
                    <span id="balanceAmount">0</span> TRM
                </div>
            </div>
        </header>

        <!-- Home Section -->
        <section id="homeSection" class="content-area">
            <!-- User Info -->
            <div class="container mx-auto p-4">
                <div class="glass-effect rounded-2xl p-4 mb-6 cursor-pointer" onclick="showProfile()">
                    <div class="flex items-center space-x-4">
                        <img id="userPhoto" src="https://picsum.photos/seed/user/60/60" alt="User" class="w-16 h-16 rounded-full border-2 border-yellow-400">
                        <div class="flex-1">
                            <h3 id="userName" class="text-white font-semibold text-lg">Loading...</h3>
                            <p class="text-white/70 text-sm">Click to view profile â†’</p>
                        </div>
                        <div class="text-right">
                            <p class="text-white/70 text-sm">Level</p>
                            <p id="userLevel" class="text-white font-bold">1</p>
                        </div>
                    </div>
                </div>

                <!-- Farming Section -->
                <div class="glass-effect rounded-2xl p-6 mb-6">
                    <div class="coin-container mb-4">
                        <div id="coinCircle" class="coin-circle" onclick="toggleFarming()">
                            <img src="https://raw.githubusercontent.com/s42144/Trimint/main.png" alt="TRM Coin" class="w-32 h-32 rounded-full">
                        </div>
                    </div>
                    <div class="text-center">
                        <button id="farmButton" class="bg-gradient-to-r from-green-500 to-green-600 text-white px-8 py-4 rounded-full font-bold text-lg shadow-lg hover:shadow-xl transition-all duration-300 pulse-animation" onclick="toggleFarming()">
                            <i class="fas fa-seedling mr-2"></i>Start Farming
                        </button>
                        <div id="farmingStatus" class="mt-4 text-white hidden">
                            <p class="text-sm">Farming Progress</p>
                            <p id="farmingTime" class="text-2xl font-bold">12:00:00</p>
                            <p class="text-sm mt-2">Rate: 0.001 TRM/sec</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="glass-effect rounded-xl p-4 text-center">
                        <i class="fas fa-trophy text-yellow-400 text-2xl mb-2"></i>
                        <p class="text-white/70 text-sm">Rank</p>
                        <p id="userRank" class="text-white font-bold">#1</p>
                    </div>
                    <div class="glass-effect rounded-xl p-4 text-center">
                        <i class="fas fa-users text-blue-400 text-2xl mb-2"></i>
                        <p class="text-white/70 text-sm">Friends</p>
                        <p id="referralCount" class="text-white font-bold">0</p>
                    </div>
                    <div class="glass-effect rounded-xl p-4 text-center">
                        <i class="fas fa-check-circle text-green-400 text-2xl mb-2"></i>
                        <p class="text-white/70 text-sm">Completed</p>
                        <p id="completedTasks" class="text-white font-bold">0</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profileSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <button onclick="showHome()" class="mb-4 text-white/70 hover:text-white">
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </button>
                
                <div class="glass-effect rounded-2xl p-6 mb-6">
                    <div class="text-center">
                        <img id="profilePhoto" src="https://picsum.photos/seed/profile/120/120" alt="Profile" class="w-32 h-32 rounded-full mx-auto mb-4 border-4 border-yellow-400">
                        <h2 id="profileName" class="text-white text-2xl font-bold mb-2">Loading...</h2>
                        <p class="text-white/70 mb-4">Premium Member</p>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="text-center">
                                <p class="text-white/70 text-sm">Level</p>
                                <p id="profileLevel" class="text-white text-2xl font-bold">1</p>
                            </div>
                            <div class="text-center">
                                <p class="text-white/70 text-sm">Balance</p>
                                <p id="profileBalance" class="text-yellow-400 text-2xl font-bold">0 TRM</p>
                            </div>
                            <div class="text-center">
                                <p class="text-white/70 text-sm">Quiz Completed</p>
                                <p id="quizCompleted" class="text-white text-2xl font-bold">0</p>
                            </div>
                            <div class="text-center">
                                <p class="text-white/70 text-sm">Friends Invited</p>
                                <p id="friendsInvited" class="text-white text-2xl font-bold">0</p>
                            </div>
                        </div>
                        
                        <button id="tonConnectBtn" class="ton-connect-btn w-full mb-4" onclick="toggleTonConnect()">
                            <i class="fas fa-wallet mr-2"></i>Connect TON Wallet
                        </button>
                    </div>
                </div>

                <!-- Leaderboard Preview -->
                <div class="glass-effect rounded-2xl p-4">
                    <h3 class="text-white font-bold text-lg mb-4">
                        <i class="fas fa-trophy text-yellow-400 mr-2"></i>Your Ranking
                    </h3>
                    <div class="space-y-3">
                        <div class="leaderboard-item rounded-xl p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <span class="text-yellow-400 font-bold">#1</span>
                                    <img src="https://picsum.photos/seed/top1/40/40" alt="User" class="w-10 h-10 rounded-full">
                                    <div>
                                        <p class="text-white font-semibold">You</p>
                                        <p class="text-white/70 text-sm">Level 1</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-yellow-400 font-bold">0 TRM</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quiz Section -->
        <section id="quizSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-question-circle text-blue-400 mr-2"></i>TON Network Quiz
                </h2>
                <div id="quizContainer" class="space-y-4">
                    <!-- Quiz questions will be loaded here -->
                </div>
                <div id="quizResult" class="glass-effect rounded-2xl p-6 mt-6 hidden">
                    <h3 class="text-white text-xl font-bold mb-4">Quiz Completed!</h3>
                    <p class="text-green-400 text-lg">You earned <span id="quizReward">1500</span> TRM tokens!</p>
                    <button onclick="nextQuiz()" class="bg-blue-500 text-white px-6 py-2 rounded-full mt-4">Next Quiz</button>
                </div>
            </div>
        </section>

        <!-- Blog Section -->
        <section id="blogSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-blog text-purple-400 mr-2"></i>Community Blog
                </h2>
                <button onclick="createBlogPost()" class="bg-purple-500 text-white px-6 py-3 rounded-full mb-6 w-full font-semibold">
                    <i class="fas fa-plus mr-2"></i>Create New Post
                </button>
                <div id="blogContainer" class="space-y-4">
                    <!-- Blog posts will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Tasks Section -->
        <section id="tasksSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-tasks text-green-400 mr-2"></i>Earn Tasks
                </h2>
                
                <!-- Watch Ads Task (Always on top) -->
                <div class="task-card rounded-2xl p-4 mb-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="bg-white/20 p-3 rounded-xl">
                                <i class="fas fa-ad text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-white font-bold">Watch Ads</h3>
                                <p class="text-white/70 text-sm">Earn 1 TRM per ad</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-yellow-400 font-bold">1 TRM</p>
                            <button onclick="watchAd()" class="bg-white/20 text-white px-4 py-2 rounded-full text-sm mt-1">
                                Watch
                            </button>
                        </div>
                    </div>
                </div>
                
                <div id="tasksContainer" class="space-y-4">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Friends Section -->
        <section id="friendsSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-user-friends text-blue-400 mr-2"></i>Invite Friends
                </h2>
                
                <div class="glass-effect rounded-2xl p-6 mb-6">
                    <div class="text-center">
                        <p class="text-white/70 mb-4">Invite friends and earn 5000 TRM each!</p>
                        <div class="bg-white/10 rounded-xl p-4 mb-4">
                            <p class="text-white text-sm mb-2">Your referral link:</p>
                            <p id="referralLink" class="text-yellow-400 font-mono text-sm break-all">http://t.me/TrimintBot/open?ref=12345</p>
                        </div>
                        <button onclick="copyReferralLink()" class="bg-blue-500 text-white px-6 py-3 rounded-full font-semibold w-full">
                            <i class="fas fa-copy mr-2"></i>Copy Link
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mt-6">
                        <div class="text-center">
                            <p class="text-white/70 text-sm">Total Referrals</p>
                            <p id="totalReferrals" class="text-white text-2xl font-bold">0</p>
                        </div>
                        <div class="text-center">
                            <p class="text-white/70 text-sm">Earned from Referrals</p>
                            <p id="referralEarnings" class="text-yellow-400 text-2xl font-bold">0 TRM</p>
                        </div>
                    </div>
                </div>
                
                <div class="glass-effect rounded-2xl p-4">
                    <h3 class="text-white font-bold mb-4">Your Referrals</h3>
                    <div id="referralsList" class="space-y-3">
                        <!-- Referrals will be listed here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Leaderboard Section -->
        <section id="leaderboardSection" class="content-area section-hidden">
            <div class="container mx-auto p-4">
                <h2 class="text-white text-2xl font-bold mb-6">
                    <i class="fas fa-trophy text-yellow-400 mr-2"></i>Top 25 Leaders
                </h2>
                <div id="leaderboardList" class="space-y-3">
                    <!-- Leaderboard will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="container mx-auto">
                <div class="grid grid-cols-5 gap-1">
                    <button onclick="showHome()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-home text-xl mb-1" style="color: #667eea;"></i>
                        <p class="text-xs font-medium">Home</p>
                    </button>
                    <button onclick="showQuiz()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-question-circle text-xl mb-1" style="color: #764ba2;"></i>
                        <p class="text-xs font-medium">Quiz</p>
                    </button>
                    <button onclick="showBlog()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-blog text-xl mb-1" style="color: #f093fb;"></i>
                        <p class="text-xs font-medium">Blog</p>
                    </button>
                    <button onclick="showTasks()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-tasks text-xl mb-1" style="color: #f5576c;"></i>
                        <p class="text-xs font-medium">Tasks</p>
                    </button>
                    <button onclick="showFriends()" class="nav-btn p-3 text-center hover:bg-gray-100 transition-colors rounded-t-lg">
                        <i class="fas fa-user-friends text-xl mb-1" style="color: #4facfe;"></i>
                        <p class="text-xs font-medium">Friends</p>
                    </button>
                </div>
            </div>
        </nav>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
            authDomain: "msc-by-shawon.firebaseapp.com",
            projectId: "msc-by-shawon",
            storageBucket: "msc-by-shawon.firebasestorage.app",
            messagingSenderId: "432753389120",
            appId: "1:432753389120:web:dcbb46ca39408a405579a5",
            measurementId: "G-8LHGLJSSEE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Initialize TON Connect
        let tonConnectUI;
        let isWalletConnected = false;

        // Initialize Telegram Web App
        let telegramUser = null;
        let userData = {
            userId: null,
            balance: 0,
            level: 1,
            quizCompleted: 0,
            friendsInvited: 0,
            completedTasks: 0,
            referrals: [],
            farming: false,
            farmingEndTime: null,
            tonWallet: null
        };

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadTasks();
            loadBlogPosts();
            loadLeaderboard();
        });

        function initializeApp() {
            // Initialize Telegram Web App
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                telegramUser = tg.initDataUnsafe?.user;
                
                if (telegramUser) {
                    userData.userId = telegramUser.id;
                    document.getElementById('userName').textContent = telegramUser.first_name + ' ' + (telegramUser.last_name || '');
                    document.getElementById('profileName').textContent = telegramUser.first_name + ' ' + (telegramUser.last_name || '');
                    document.getElementById('userPhoto').src = telegramUser.photo_url || `https://picsum.photos/seed/${telegramUser.id}/60/60`;
                    document.getElementById('profilePhoto').src = telegramUser.photo_url || `https://picsum.photos/seed/${telegramUser.id}/120/120`;
                    
                    // Generate referral link
                    document.getElementById('referralLink').textContent = `http://t.me/TrimintBot/open?ref=${telegramUser.id}`;
                    
                    // Load user data from Firebase
                    loadUserData();
                }
                
                tg.ready();
                tg.expand();
            }

            // Initialize TON Connect
            tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://trimint.vercel.app/tonconnect-manifest.json',
                buttonRootId: null
            });

            tonConnectUI.onStatusChange(wallet => {
                if (wallet) {
                    isWalletConnected = true;
                    document.getElementById('tonConnectBtn').innerHTML = '<i class="fas fa-wallet mr-2"></i>Disconnect Wallet';
                    userData.tonWallet = wallet.account.address;
                    updateUserData();
                } else {
                    isWalletConnected = false;
                    document.getElementById('tonConnectBtn').innerHTML = '<i class="fas fa-wallet mr-2"></i>Connect TON Wallet';
                    userData.tonWallet = null;
                }
            });
        }

        function loadUserData() {
            if (!userData.userId) return;
            
            db.collection('users').doc(userData.userId.toString()).get()
                .then(doc => {
                    if (doc.exists) {
                        userData = { ...userData, ...doc.data() };
                        updateUI();
                        
                        // Check if farming is active
                        if (userData.farming && userData.farmingEndTime) {
                            startFarmingCountdown();
                        }
                    } else {
                        // Create new user document
                        saveUserData();
                    }
                })
                .catch(error => {
                    console.error('Error loading user data:', error);
                });
        }

        function saveUserData() {
            if (!userData.userId) return;
            
            db.collection('users').doc(userData.userId.toString()).set(userData)
                .then(() => {
                    console.log('User data saved');
                })
                .catch(error => {
                    console.error('Error saving user data:', error);
                });
        }

        function updateUserData() {
            saveUserData();
            updateUI();
        }

        function updateUI() {
            document.getElementById('balanceAmount').textContent = userData.balance.toLocaleString();
            document.getElementById('userLevel').textContent = userData.level;
            document.getElementById('profileLevel').textContent = userData.level;
            document.getElementById('profileBalance').textContent = userData.balance.toLocaleString() + ' TRM';
            document.getElementById('quizCompleted').textContent = userData.quizCompleted;
            document.getElementById('friendsInvited').textContent = userData.friendsInvited;
            document.getElementById('completedTasks').textContent = userData.completedTasks;
            document.getElementById('referralCount').textContent = userData.friendsInvited;
            document.getElementById('totalReferrals').textContent = userData.friendsInvited;
            document.getElementById('referralEarnings').textContent = (userData.friendsInvited * 5000).toLocaleString() + ' TRM';
            
            loadReferrals();
        }

        // Farming Functions
        let farmingInterval = null;
        let tokenAnimationInterval = null;

        function toggleFarming() {
            if (userData.farming) {
                stopFarming();
            } else {
                startFarming();
            }
        }

        function startFarming() {
            userData.farming = true;
            userData.farmingEndTime = Date.now() + (12 * 60 * 60 * 1000); // 12 hours from now
            updateUserData();
            
            document.getElementById('farmButton').innerHTML = '<i class="fas fa-stop mr-2"></i>Stop Farming';
            document.getElementById('farmingStatus').classList.remove('hidden');
            document.getElementById('coinCircle').classList.add('farming');
            
            startFarmingCountdown();
            startTokenAnimation();
        }

        function stopFarming() {
            userData.farming = false;
            userData.farmingEndTime = null;
            updateUserData();
            
            document.getElementById('farmButton').innerHTML = '<i class="fas fa-seedling mr-2"></i>Start Farming';
            document.getElementById('farmingStatus').classList.add('hidden');
            document.getElementById('coinCircle').classList.remove('farming');
            
            if (farmingInterval) {
                clearInterval(farmingInterval);
            }
            if (tokenAnimationInterval) {
                clearInterval(tokenAnimationInterval);
            }
        }

        function startFarmingCountdown() {
            if (farmingInterval) {
                clearInterval(farmingInterval);
            }
            
            farmingInterval = setInterval(() => {
                if (userData.farming && userData.farmingEndTime) {
                    const now = Date.now();
                    const remaining = userData.farmingEndTime - now;
                    
                    if (remaining <= 0) {
                        stopFarming();
                        return;
                    }
                    
                    const hours = Math.floor(remaining / (1000 * 60 * 60));
                    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                    
                    document.getElementById('farmingTime').textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Add tokens every second
                    userData.balance += 0.001;
                    updateUI();
                }
            }, 1000);
        }

        function startTokenAnimation() {
            if (tokenAnimationInterval) {
                clearInterval(tokenAnimationInterval);
            }
            
            tokenAnimationInterval = setInterval(() => {
                createTokenAnimation();
            }, 1000);
        }

        function createTokenAnimation() {
            const coinContainer = document.querySelector('.coin-container');
            const animation = document.createElement('div');
            animation.className = 'token-animation';
            animation.textContent = '+0.001 TRM';
            animation.style.left = Math.random() * 100 + 'px';
            animation.style.top = '50%';
            
            coinContainer.appendChild(animation);
            
            setTimeout(() => {
                animation.remove();
            }, 2000);
        }

        // TON Connect Functions
        function toggleTonConnect() {
            if (isWalletConnected) {
                tonConnectUI.disconnect();
            } else {
                tonConnectUI.connectWallet();
            }
        }

        // Navigation Functions
        function showHome() {
            hideAllSections();
            document.getElementById('homeSection').classList.remove('section-hidden');
        }

        function showProfile() {
            hideAllSections();
            document.getElementById('profileSection').classList.remove('section-hidden');
        }

        function showQuiz() {
            hideAllSections();
            document.getElementById('quizSection').classList.remove('section-hidden');
            loadQuiz();
        }

        function showBlog() {
            hideAllSections();
            document.getElementById('blogSection').classList.remove('section-hidden');
        }

        function showTasks() {
            hideAllSections();
            document.getElementById('tasksSection').classList.remove('section-hidden');
        }

        function showFriends() {
            hideAllSections();
            document.getElementById('friendsSection').classList.remove('section-hidden');
        }

        function showLeaderboard() {
            hideAllSections();
            document.getElementById('leaderboardSection').classList.remove('section-hidden');
        }

        function hideAllSections() {
            document.querySelectorAll('section').forEach(section => {
                section.classList.add('section-hidden');
            });
        }

        // Quiz Functions
        const quizQuestions = [
            {
                question: "What is TON?",
                options: ["The Open Network", "Telegram Only Network", "Token Operating Network", "Trust On Network"],
                correct: 0,
                reward: 1500
            },
            {
                question: "Who created TON?",
                options: ["Vitalik Buterin", "Pavel Durov", "Satoshi Nakamoto", "Charles Hoskinson"],
                correct: 1,
                reward: 1500
            },
            {
                question: "What is the native token of TON?",
                options: ["ETH", "TON", "BTC", "TRM"],
                correct: 1,
                reward: 1500
            },
            {
                question: "What is TON's consensus mechanism?",
                options: ["Proof of Work", "Proof of Stake", "Delegated Proof of Stake", "Proof of Authority"],
                correct: 2,
                reward: 1500
            },
            {
                question: "What is Telegram's role in TON?",
                options: ["Full control", "No involvement", "Initial creator, now independent", "Mining operator"],
                correct: 2,
                reward: 1500
            }
        ];

        let currentQuizIndex = 0;

        function loadQuiz() {
            const container = document.getElementById('quizContainer');
            container.innerHTML = '';
            
            const quiz = quizQuestions[currentQuizIndex];
            const quizCard = document.createElement('div');
            quizCard.className = 'quiz-card rounded-2xl p-6 text-white';
            quizCard.innerHTML = `
                <h3 class="text-xl font-bold mb-4">${quiz.question}</h3>
                <div class="space-y-3">
                    ${quiz.options.map((option, index) => `
                        <button onclick="answerQuiz(${index})" class="w-full bg-white/20 p-4 rounded-xl text-left hover:bg-white/30 transition-all">
                            ${option}
                        </button>
                    `).join('')}
                </div>
            `;
            container.appendChild(quizCard);
        }

        function answerQuiz(answerIndex) {
            const quiz = quizQuestions[currentQuizIndex];
            if (answerIndex === quiz.correct) {
                userData.balance += quiz.reward;
                userData.quizCompleted++;
                updateUserData();
                
                document.getElementById('quizContainer').classList.add('hidden');
                document.getElementById('quizResult').classList.remove('hidden');
                document.getElementById('quizReward').textContent = quiz.reward;
            } else {
                alert('Wrong answer! Try again.');
                loadQuiz();
            }
        }

        function nextQuiz() {
            currentQuizIndex = (currentQuizIndex + 1) % quizQuestions.length;
            document.getElementById('quizContainer').classList.remove('hidden');
            document.getElementById('quizResult').classList.add('hidden');
            loadQuiz();
        }

        // Blog Functions
        function loadBlogPosts() {
            // Sample blog posts - in real app, load from Firebase
            const samplePosts = [
                {
                    id: 1,
                    author: "John Doe",
                    content: "TON is the future of blockchain! Amazing technology and great community.",
                    likes: 15,
                    comments: 3,
                    timestamp: new Date().toISOString()
                },
                {
                    id: 2,
                    author: "Jane Smith",
                    content: "Just completed my first quiz and earned 1500 TRM! This app is awesome!",
                    likes: 23,
                    comments: 7,
                    timestamp: new Date().toISOString()
                }
            ];
            
            displayBlogPosts(samplePosts);
        }

        function displayBlogPosts(posts) {
            const container = document.getElementById('blogContainer');
            container.innerHTML = '';
            
            posts.forEach(post => {
                const postCard = document.createElement('div');
                postCard.className = 'blog-post rounded-2xl p-6';
                postCard.innerHTML = `
                    <div class="flex items-start space-x-3 mb-4">
                        <img src="https://picsum.photos/seed/${post.author}/40/40" alt="${post.author}" class="w-10 h-10 rounded-full">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${post.author}</h4>
                            <p class="text-gray-500 text-sm">${new Date(post.timestamp).toLocaleDateString()}</p>
                        </div>
                        ${post.author === telegramUser?.first_name ? `
                            <button onclick="deleteBlogPost(${post.id})" class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </div>
                    <p class="text-gray-700 mb-4">${post.content}</p>
                    <div class="flex items-center space-x-4">
                        <button onclick="likeBlogPost(${post.id})" class="flex items-center space-x-1 text-gray-600 hover:text-red-500">
                            <i class="fas fa-heart"></i>
                            <span>${post.likes}</span>
                        </button>
                        <button onclick="commentOnPost(${post.id})" class="flex items-center space-x-1 text-gray-600 hover:text-blue-500">
                            <i class="fas fa-comment"></i>
                            <span>${post.comments}</span>
                        </button>
                    </div>
                `;
                container.appendChild(postCard);
            });
        }

        function createBlogPost() {
            const content = prompt('Write your blog post:');
            if (content && telegramUser) {
                const newPost = {
                    id: Date.now(),
                    author: telegramUser.first_name,
                    content: content,
                    likes: 0,
                    comments: 0,
                    timestamp: new Date().toISOString()
                };
                
                // In real app, save to Firebase
                console.log('New blog post:', newPost);
                alert('Blog post created successfully!');
                loadBlogPosts();
            }
        }

        function deleteBlogPost(postId) {
            if (confirm('Are you sure you want to delete this post?')) {
                // In real app, delete from Firebase
                console.log('Delete post:', postId);
                alert('Post deleted successfully!');
                loadBlogPosts();
            }
        }

        function likeBlogPost(postId) {
            // In real app, update likes in Firebase
            console.log('Like post:', postId);
            loadBlogPosts();
        }

        function commentOnPost(postId) {
            const comment = prompt('Write your comment:');
            if (comment) {
                // In real app, add comment to Firebase
                console.log('Comment on post:', postId, comment);
                alert('Comment added successfully!');
            }
        }

        // Tasks Functions
        function loadTasks() {
            // Sample tasks - in real app, load from Firebase
            const sampleTasks = [
                {
                    id: 1,
                    name: "Join TON Community",
                    description: "Join our official TON community group",
                    reward: 1000,
                    link: "https://t.me/toncoin",
                    completed: false
                },
                {
                    id: 2,
                    name: "Follow us on X",
                    description: "Follow our official X account",
                    reward: 500,
                    link: "https://twitter.com/ton_blockchain",
                    completed: false
                }
            ];
            
            displayTasks(sampleTasks);
        }

        function displayTasks(tasks) {
            const container = document.getElementById('tasksContainer');
            container.innerHTML = '';
            
            tasks.forEach(task => {
                const taskCard = document.createElement('div');
                taskCard.className = 'task-card rounded-2xl p-4';
                taskCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="bg-white/20 p-3 rounded-xl">
                                <i class="fas fa-external-link-alt text-white text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-white font-bold">${task.name}</h3>
                                <p class="text-white/70 text-sm">${task.description}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-yellow-400 font-bold">${task.reward} TRM</p>
                            <button id="taskBtn${task.id}" onclick="completeTask(${task.id}, '${task.link}', ${task.reward})" class="bg-white/20 text-white px-4 py-2 rounded-full text-sm mt-1">
                                ${task.completed ? 'Completed' : 'Open'}
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(taskCard);
            });
        }

        function completeTask(taskId, link, reward) {
            const button = document.getElementById(`taskBtn${taskId}`);
            if (button.textContent === 'Completed') {
                window.open(link, '_blank');
                return;
            }
            
            window.open(link, '_blank');
            button.textContent = 'Processing...';
            
            setTimeout(() => {
                userData.balance += reward;
                userData.completedTasks++;
                updateUserData();
                button.textContent = 'Completed';
            }, 10000);
        }

        function watchAd() {
            // Show ads using Monetag
            if (window.libtl) {
                window.libtl.showAd();
            }
            
            // Add 1 TRM after watching ad
            setTimeout(() => {
                userData.balance += 1;
                updateUserData();
                alert('You earned 1 TRM!');
            }, 5000);
        }

        // Friends Functions
        function copyReferralLink() {
            const link = document.getElementById('referralLink').textContent;
            navigator.clipboard.writeText(link).then(() => {
                alert('Referral link copied to clipboard!');
            });
        }

        function loadReferrals() {
            // In real app, load from Firebase
            const referralsList = document.getElementById('referralsList');
            referralsList.innerHTML = '<p class="text-white/70 text-center">No referrals yet</p>';
        }

        function processReferral(referrerId) {
            if (userData.userId && referrerId && userData.userId.toString() !== referrerId) {
                // Check if this user was already referred
                // In real app, check Firebase
                userData.balance += 5000;
                updateUserData();
                alert('Welcome bonus! You received 5000 TRM from referral!');
            }
        }

        // Leaderboard Functions
        function loadLeaderboard() {
            // Sample leaderboard data - in real app, load from Firebase
            const sampleLeaderboard = [
                { rank: 1, name: "Alice", balance: 50000, level: 10, photo: "alice" },
                { rank: 2, name: "Bob", balance: 45000, level: 9, photo: "bob" },
                { rank: 3, name: "Charlie", balance: 40000, level: 8, photo: "charlie" }
            ];
            
            displayLeaderboard(sampleLeaderboard);
        }

        function displayLeaderboard(leaderboard) {
            const container = document.getElementById('leaderboardList');
            container.innerHTML = '';
            
            leaderboard.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'leaderboard-item rounded-xl p-3';
                userCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="text-yellow-400 font-bold">#${user.rank}</span>
                            <img src="https://picsum.photos/seed/${user.photo}/40/40" alt="${user.name}" class="w-10 h-10 rounded-full">
                            <div>
                                <p class="text-white font-semibold">${user.name}</p>
                                <p class="text-white/70 text-sm">Level ${user.level}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-yellow-400 font-bold">${user.balance.toLocaleString()} TRM</p>
                        </div>
                    </div>
                `;
                container.appendChild(userCard);
            });
        }

        // Check for referral in URL
        function checkReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const referrerId = urlParams.get('ref');
            if (referrerId) {
                processReferral(referrerId);
            }
        }

        // Initialize referral check
        checkReferral();
    </script>
</body>
</html>
