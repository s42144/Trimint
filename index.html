<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trimint - TRM Mining</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    
    <!-- Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- TON Connect -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #ec4899;
            --background-color: #1a1a2e;
            --card-color: #16213e;
            --text-color: #ffffff;
            --text-secondary: #a0a0a0;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        [data-theme="light"] {
            --primary-color: #4f46e5;
            --secondary-color: #7c3aed;
            --accent-color: #db2777;
            --background-color: #f8fafc;
            --card-color: #ffffff;
            --text-color: #1e293b;
            --text-secondary: #64748b;
            --border-radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: var(--transition);
            overflow-x: hidden;
            padding-bottom: 70px;
            min-height: 100vh;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 15px;
            position: relative;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--background-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 18px;
            color: var(--text-color);
        }

        .referral-notice {
            margin-top: 30px;
            padding: 15px;
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            text-align: center;
            max-width: 80%;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 20px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            background-color: var(--card-color);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* Balance Display */
        .balance-container {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .balance-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .balance-amount {
            display: flex;
            align-items: center;
            font-size: 28px;
            font-weight: bold;
        }

        .balance-coin {
            width: 32px;
            height: 32px;
            margin-right: 10px;
        }

        .user-level {
            margin-top: 10px;
            font-size: 14px;
            padding: 5px 10px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: inline-block;
        }

        /* Content Sections */
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Home Section - Farming */
        .farming-container {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .coin-container {
            position: relative;
            margin: 20px auto;
            width: 150px;
            height: 150px;
        }

        .coin {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: url('https://i.postimg.cc/fTQktNmX/maincoin.png') no-repeat center;
            background-size: contain;
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .coin:hover {
            transform: scale(1.05);
        }

        .coin.farming {
            animation: rotate 2s linear infinite, float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .token-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            font-size: 18px;
            color: var(--success-color);
            pointer-events: none;
            opacity: 0;
        }

        .token-animation.show {
            animation: tokenFloat 1s ease-out forwards;
        }

        @keyframes tokenFloat {
            0% { opacity: 1; transform: translate(-50%, -50%); }
            100% { opacity: 0; transform: translate(-50%, -150%); }
        }

        .farming-timer {
            margin: 20px 0;
            font-size: 18px;
            font-weight: bold;
        }

        .farming-status {
            margin: 15px 0;
            font-size: 16px;
            color: var(--text-secondary);
        }

        .farming-button {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .farming-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .farming-button:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }

        /* Tasks Section */
        .task-card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .task-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            margin-right: 15px;
            object-fit: cover;
        }

        .task-details {
            flex: 1;
        }

        .task-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .task-reward {
            display: flex;
            align-items: center;
            color: var(--success-color);
            font-size: 14px;
        }

        .task-reward img {
            width: 16px;
            height: 16px;
            margin-right: 5px;
        }

        .task-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }

        .task-button:hover {
            background-color: var(--secondary-color);
        }

        .task-button.processing {
            background-color: var(--warning-color);
        }

        .task-button.completed {
            background-color: var(--success-color);
        }

        /* Leaderboard Section */
        .leaderboard-container {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .leaderboard-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: bold;
        }

        .leaderboard-list {
            list-style: none;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            width: 30px;
            font-weight: bold;
            margin-right: 15px;
            text-align: center;
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .leaderboard-details {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .leaderboard-balance {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .leaderboard-balance img {
            width: 14px;
            height: 14px;
            margin-right: 5px;
        }

        /* Friends Section */
        .referral-container {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .referral-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .referral-link-container {
            display: flex;
            margin-bottom: 15px;
        }

        .referral-link {
            flex: 1;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            font-size: 14px;
            word-break: break-all;
            margin-right: 10px;
        }

        .copy-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-button:hover {
            background-color: var(--secondary-color);
        }

        .referral-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .referrals-list {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .referrals-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .referral-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .referral-item:last-child {
            border-bottom: none;
        }

        .referral-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
        }

        .referral-details {
            flex: 1;
        }

        .referral-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .referral-bonus {
            font-size: 14px;
            color: var(--success-color);
        }

        /* Profile Section */
        .profile-container {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .profile-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            border: 3px solid var(--primary-color);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-level {
            display: inline-block;
            padding: 5px 10px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile-stat {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
        }

        .profile-stat-value {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .profile-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .wallet-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .wallet-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .wallet-status {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .wallet-address {
            flex: 1;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            font-size: 14px;
            word-break: break-all;
            margin-right: 10px;
        }

        .wallet-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: bold;
        }

        .wallet-button:hover {
            background-color: var(--secondary-color);
        }

        .wallet-button.disconnect {
            background-color: var(--danger-color);
        }

        .settings-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .settings-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }

        .setting-label {
            font-size: 16px;
        }

        .setting-toggle {
            position: relative;
            width: 50px;
            height: 26px;
            background-color: var(--text-secondary);
            border-radius: 13px;
            cursor: pointer;
            transition: var(--transition);
        }

        .setting-toggle.active {
            background-color: var(--primary-color);
        }

        .setting-toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: var(--transition);
        }

        .setting-toggle.active::after {
            left: 27px;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--card-color);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
            padding: 5px;
            border-radius: 10px;
        }

        .nav-item.active {
            color: var(--primary-color);
        }

        .nav-item.home {
            transform: scale(1.2);
            background-color: rgba(99, 102, 241, 0.1);
            border-radius: 15px;
            padding: 5px 15px;
        }

        .nav-item i {
            font-size: 20px;
            margin-bottom: 3px;
        }

        .nav-item.home i {
            font-size: 24px;
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--card-color);
            color: var(--text-color);
            padding: 15px 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            max-width: 80%;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
        }

        .toast.success {
            background-color: var(--success-color);
        }

        .toast.error {
            background-color: var(--danger-color);
        }

        .toast.warning {
            background-color: var(--warning-color);
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .balance-amount {
                font-size: 24px;
            }
            
            .coin {
                width: 120px;
                height: 120px;
            }
            
            .coin-container {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text">Loading Trimint...</div>
        <div class="referral-notice" id="referralNotice" style="display: none;">
            <div>You were invited by <span id="referralName"></span></div>
            <div style="margin-top: 10px; color: var(--success-color);">+5000 TRM Bonus!</div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="toast" id="toast"></div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Trimint</h1>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>

        <!-- Balance Display -->
        <div class="balance-container">
            <div class="balance-label">Your Balance</div>
            <div class="balance-amount">
                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM" class="balance-coin">
                <span id="userBalance">0</span> TRM
            </div>
            <div class="user-level" id="userLevel">Bronze Level</div>
        </div>

        <!-- Home Section -->
        <div class="content-section active" id="homeSection">
            <div class="farming-container">
                <div class="coin-container">
                    <div class="coin" id="coin"></div>
                    <div class="token-animation" id="tokenAnimation">+0.001 TRM</div>
                </div>
                <div class="farming-timer" id="farmingTimer">Start farming to earn TRM</div>
                <div class="farming-status" id="farmingStatus">Each second you earn 0.001 TRM</div>
                <button class="farming-button" id="farmingButton">Start Farming</button>
            </div>
        </div>

        <!-- Tasks Section -->
        <div class="content-section" id="tasksSection">
            <div class="task-card" id="adsTask">
                <img src="https://i.postimg.cc/6QyTynDw/ads.png" alt="Watch Ads" class="task-icon">
                <div class="task-details">
                    <div class="task-name">Watch Ads</div>
                    <div class="task-reward">
                        <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
                        <span>+1 TRM</span>
                    </div>
                </div>
                <button class="task-button" id="watchAdsButton">OPEN</button>
            </div>
            <div id="tasksList"></div>
        </div>

        <!-- Leaderboard Section -->
        <div class="content-section" id="leaderboardSection">
            <div class="leaderboard-container">
                <div class="leaderboard-header">Top Miners</div>
                <ul class="leaderboard-list" id="leaderboardList">
                    <!-- Leaderboard items will be added dynamically -->
                </ul>
            </div>
        </div>

        <!-- Friends Section -->
        <div class="content-section" id="friendsSection">
            <div class="referral-container">
                <div class="referral-title">Invite Friends</div>
                <div class="referral-link-container">
                    <div class="referral-link" id="referralLink">https://t.me/TrimintBot/open?startapp=</div>
                    <button class="copy-button" id="copyReferralButton">Copy</button>
                </div>
                <div class="referral-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="totalReferrals">0</div>
                        <div class="stat-label">Total Referrals</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="referralEarnings">0</div>
                        <div class="stat-label">Referral Earnings</div>
                    </div>
                </div>
            </div>
            <div class="referrals-list">
                <div class="referrals-header">Your Referrals</div>
                <div id="referralsList">
                    <!-- Referral items will be added dynamically -->
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div class="content-section" id="profileSection">
            <div class="profile-container">
                <div class="profile-header">
                    <img src="https://i.postimg.cc/6QyTynDw/avatar.png" alt="Profile" class="profile-avatar" id="profileAvatar">
                    <div class="profile-info">
                        <div class="profile-name" id="profileName">Loading...</div>
                        <div class="profile-level" id="profileLevel">Bronze Level</div>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="totalBalance">0</div>
                        <div class="profile-stat-label">Total Balance</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="totalFriends">0</div>
                        <div class="profile-stat-label">Total Friends</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="totalTasks">0</div>
                        <div class="profile-stat-label">Tasks Completed</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="farmingHours">0</div>
                        <div class="profile-stat-label">Farming Hours</div>
                    </div>
                </div>
                <div class="wallet-section">
                    <div class="wallet-title">TON Wallet</div>
                    <div class="wallet-status" id="walletStatus">
                        <div class="wallet-address" id="walletAddress">Not connected</div>
                        <button class="wallet-button" id="walletButton">Connect Wallet</button>
                    </div>
                    <div class="wallet-actions" id="walletActions" style="display: none;">
                        <button class="wallet-button" id="copyWalletButton">Copy Address</button>
                        <button class="wallet-button disconnect" id="disconnectWalletButton">Disconnect</button>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">Settings</div>
                    <div class="setting-item">
                        <div class="setting-label">Notifications</div>
                        <div class="setting-toggle active" id="notificationsToggle"></div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Sound Effects</div>
                        <div class="setting-toggle active" id="soundToggle"></div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">Auto Farming</div>
                        <div class="setting-toggle" id="autoFarmingToggle"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item home active" data-section="home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" data-section="tasks">
            <i class="fas fa-tasks"></i>
            <span>Tasks</span>
        </div>
        <div class="nav-item" data-section="leaderboard">
            <i class="fas fa-trophy"></i>
            <span>Leaderboard</span>
        </div>
        <div class="nav-item" data-section="friends">
            <i class="fas fa-user-friends"></i>
            <span>Friends</span>
        </div>
        <div class="nav-item" data-section="profile">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </div>
    </div>

    <!-- Monetag Ads Script -->
    <script src='//libtl.com/sdk.js' data-zone='10290264' data-sdk='show_10290264'></script>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
            authDomain: "msc-by-shawon.firebaseapp.com",
            projectId: "msc-by-shawon",
            storageBucket: "msc-by-shawon.firebasestorage.app",
            messagingSenderId: "432753389120",
            appId: "1:432753389120:web:dcbb46ca39408a405579a5",
            measurementId: "G-8LHGLJSSEE"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Initialize Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // Initialize TON Connect
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://trimint.vercel.app/tonconnect-manifest.json',
            buttonRootId: null
        });

        // Global Variables
        let userData = {
            id: tg.initDataUnsafe?.user?.id || Math.floor(Math.random() * 1000000),
            firstName: tg.initDataUnsafe?.user?.first_name || 'User',
            lastName: tg.initDataUnsafe?.user?.last_name || '',
            username: tg.initDataUnsafe?.user?.username || '',
            photoUrl: tg.initDataUnsafe?.user?.photo_url || 'https://i.postimg.cc/6QyTynDw/avatar.png',
            balance: 0,
            level: 'Bronze',
            totalFriends: 0,
            totalTasks: 0,
            farmingHours: 0,
            referralEarnings: 0,
            referrals: [],
            completedTasks: [],
            walletAddress: '',
            farming: {
                isActive: false,
                startTime: null,
                endTime: null,
                totalEarned: 0
            }
        };

        let isDarkTheme = true;
        let farmingInterval = null;
        let currentSection = 'home';

        // DOM Elements
        const loadingScreen = document.getElementById('loadingScreen');
        const referralNotice = document.getElementById('referralNotice');
        const referralName = document.getElementById('referralName');
        const toast = document.getElementById('toast');
        const themeToggle = document.getElementById('themeToggle');
        const userBalance = document.getElementById('userBalance');
        const userLevel = document.getElementById('userLevel');
        const coin = document.getElementById('coin');
        const tokenAnimation = document.getElementById('tokenAnimation');
        const farmingTimer = document.getElementById('farmingTimer');
        const farmingStatus = document.getElementById('farmingStatus');
        const farmingButton = document.getElementById('farmingButton');
        const tasksList = document.getElementById('tasksList');
        const watchAdsButton = document.getElementById('watchAdsButton');
        const leaderboardList = document.getElementById('leaderboardList');
        const referralLink = document.getElementById('referralLink');
        const copyReferralButton = document.getElementById('copyReferralButton');
        const totalReferrals = document.getElementById('totalReferrals');
        const referralEarnings = document.getElementById('referralEarnings');
        const referralsList = document.getElementById('referralsList');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileLevel = document.getElementById('profileLevel');
        const totalBalance = document.getElementById('totalBalance');
        const totalFriends = document.getElementById('totalFriends');
        const totalTasks = document.getElementById('totalTasks');
        const farmingHours = document.getElementById('farmingHours');
        const walletAddress = document.getElementById('walletAddress');
        const walletButton = document.getElementById('walletButton');
        const walletActions = document.getElementById('walletActions');
        const copyWalletButton = document.getElementById('copyWalletButton');
        const disconnectWalletButton = document.getElementById('disconnectWalletButton');
        const notificationsToggle = document.getElementById('notificationsToggle');
        const soundToggle = document.getElementById('soundToggle');
        const autoFarmingToggle = document.getElementById('autoFarmingToggle');

        // Initialize App
        function initApp() {
            // Check URL parameters for referral
            const urlParams = new URLSearchParams(window.location.search);
            const referrerId = urlParams.get('startapp');
            
            if (referrerId && referrerId !== userData.id.toString()) {
                // Show referral notice
                referralName.textContent = 'a friend';
                referralNotice.style.display = 'block';
                
                // Process referral
                processReferral(referrerId);
            }
            
            // Load user data from Firebase
            loadUserData();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize UI
            updateUI();
            
            // Load tasks from Firebase
            loadTasks();
            
            // Load leaderboard from Firebase
            loadLeaderboard();
            
            // Hide loading screen after a delay
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
            }, 2000);
        }

        // Process Referral
        function processReferral(referrerId) {
            // Add referral to user data
            database.ref(`users/${userData.id}/referrer`).set(referrerId);
            
            // Add 5000 TRM to user balance
            userData.balance += 5000;
            updateUserData();
            
            // Update referrer's data
            database.ref(`users/${referrerId}`).once('value').then(snapshot => {
                if (snapshot.exists()) {
                    const referrerData = snapshot.val();
                    referrerData.referralEarnings = (referrerData.referralEarnings || 0) + 5000;
                    referrerData.balance = (referrerData.balance || 0) + 5000;
                    
                    if (!referrerData.referrals) {
                        referrerData.referrals = [];
                    }
                    
                    referrerData.referrals.push({
                        id: userData.id,
                        name: userData.firstName,
                        bonus: 5000,
                        timestamp: Date.now()
                    });
                    
                    database.ref(`users/${referrerId}`).set(referrerData);
                }
            });
        }

        // Load User Data
        function loadUserData() {
            database.ref(`users/${userData.id}`).once('value').then(snapshot => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    userData = { ...userData, ...data };
                    
                    // Check if farming was active and should continue
                    if (userData.farming && userData.farming.isActive) {
                        const now = Date.now();
                        if (now < userData.farming.endTime) {
                            // Continue farming
                            startFarming(false);
                        } else {
                            // Farming period ended
                            userData.farming.isActive = false;
                            userData.farming.startTime = null;
                            userData.farming.endTime = null;
                        }
                    }
                } else {
                    // New user, save to Firebase
                    updateUserData();
                }
                
                updateUI();
            });
        }

        // Update User Data
        function updateUserData() {
            database.ref(`users/${userData.id}`).set(userData);
            updateUI();
        }

        // Update UI
        function updateUI() {
            // Update balance and level
            userBalance.textContent = userData.balance.toFixed(3);
            updateUserLevel();
            
            // Update profile
            profileName.textContent = `${userData.firstName} ${userData.lastName}`;
            profileAvatar.src = userData.photoUrl;
            totalBalance.textContent = userData.balance.toFixed(3);
            totalFriends.textContent = userData.totalFriends || 0;
            totalTasks.textContent = userData.totalTasks || 0;
            farmingHours.textContent = userData.farmingHours || 0;
            
            // Update referral link
            referralLink.textContent = `https://t.me/TrimintBot/open?startapp=${userData.id}`;
            
            // Update referral stats
            totalReferrals.textContent = userData.referrals ? userData.referrals.length : 0;
            referralEarnings.textContent = userData.referralEarnings || 0;
            
            // Update referrals list
            updateReferralsList();
            
            // Update wallet status
            if (userData.walletAddress) {
                walletAddress.textContent = userData.walletAddress;
                walletButton.textContent = 'Connected';
                walletActions.style.display = 'flex';
            } else {
                walletAddress.textContent = 'Not connected';
                walletButton.textContent = 'Connect Wallet';
                walletActions.style.display = 'none';
            }
            
            // Update farming status
            if (userData.farming && userData.farming.isActive) {
                farmingButton.textContent = 'Farming...';
                farmingButton.disabled = true;
                coin.classList.add('farming');
            } else {
                farmingButton.textContent = 'Start Farming';
                farmingButton.disabled = false;
                coin.classList.remove('farming');
            }
        }

        // Update User Level
        function updateUserLevel() {
            if (userData.balance < 10000) {
                userData.level = 'Bronze';
            } else if (userData.balance < 50000) {
                userData.level = 'Gold';
            } else {
                userData.level = 'Diamond';
            }
            
            userLevel.textContent = `${userData.level} Level`;
            profileLevel.textContent = `${userData.level} Level`;
        }

        // Update Referrals List
        function updateReferralsList() {
            referralsList.innerHTML = '';
            
            if (!userData.referrals || userData.referrals.length === 0) {
                referralsList.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No referrals yet</div>';
                return;
            }
            
            userData.referrals.forEach(referral => {
                const referralItem = document.createElement('div');
                referralItem.className = 'referral-item';
                
                referralItem.innerHTML = `
                    <img src="https://i.postimg.cc/6QyTynDw/avatar.png" alt="${referral.name}" class="referral-avatar">
                    <div class="referral-details">
                        <div class="referral-name">${referral.name}</div>
                        <div class="referral-bonus">+${referral.bonus} TRM</div>
                    </div>
                `;
                
                referralsList.appendChild(referralItem);
            });
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', () => {
                isDarkTheme = !isDarkTheme;
                document.body.setAttribute('data-theme', isDarkTheme ? 'dark' : 'light');
                themeToggle.innerHTML = isDarkTheme ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            });
            
            // Bottom navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const section = item.getAttribute('data-section');
                    switchSection(section);
                });
            });
            
            // Farming button
            farmingButton.addEventListener('click', () => {
                if (!userData.farming.isActive) {
                    startFarming(true);
                }
            });
            
            // Watch ads button
            watchAdsButton.addEventListener('click', () => {
                if (watchAdsButton.textContent === 'OPEN') {
                    watchAdsButton.textContent = 'PROCESSING';
                    watchAdsButton.classList.add('processing');
                    
                    // Show ad
                    showAd();
                    
                    // Simulate ad watching
                    setTimeout(() => {
                        userData.balance += 1;
                        userData.totalTasks = (userData.totalTasks || 0) + 1;
                        updateUserData();
                        
                        watchAdsButton.textContent = 'COMPLETED';
                        watchAdsButton.classList.remove('processing');
                        watchAdsButton.classList.add('completed');
                        
                        showToast('You earned 1 TRM!', 'success');
                    }, 3000);
                } else {
                    // Redirect to ad
                    window.open('https://libtl.com', '_blank');
                }
            });
            
            // Copy referral link
            copyReferralButton.addEventListener('click', () => {
                navigator.clipboard.writeText(referralLink.textContent);
                showToast('Referral link copied!', 'success');
            });
            
            // Wallet button
            walletButton.addEventListener('click', async () => {
                if (!userData.walletAddress) {
                    try {
                        const wallet = await tonConnectUI.connectWallet();
                        userData.walletAddress = wallet.account.address;
                        updateUserData();
                        showToast('Wallet connected successfully!', 'success');
                    } catch (error) {
                        showToast('Failed to connect wallet', 'error');
                        console.error(error);
                    }
                }
            });
            
            // Copy wallet address
            copyWalletButton.addEventListener('click', () => {
                navigator.clipboard.writeText(userData.walletAddress);
                showToast('Wallet address copied!', 'success');
            });
            
            // Disconnect wallet
            disconnectWalletButton.addEventListener('click', async () => {
                try {
                    await tonConnectUI.disconnect();
                    userData.walletAddress = '';
                    updateUserData();
                    showToast('Wallet disconnected', 'success');
                } catch (error) {
                    showToast('Failed to disconnect wallet', 'error');
                    console.error(error);
                }
            });
            
            // Settings toggles
            notificationsToggle.addEventListener('click', () => {
                notificationsToggle.classList.toggle('active');
                userData.notifications = notificationsToggle.classList.contains('active');
                updateUserData();
            });
            
            soundToggle.addEventListener('click', () => {
                soundToggle.classList.toggle('active');
                userData.soundEffects = soundToggle.classList.contains('active');
                updateUserData();
            });
            
            autoFarmingToggle.addEventListener('click', () => {
                autoFarmingToggle.classList.toggle('active');
                userData.autoFarming = autoFarmingToggle.classList.contains('active');
                updateUserData();
            });
        }

        // Switch Section
        function switchSection(section) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-section') === section) {
                    item.classList.add('active');
                }
            });
            
            // Update content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.getElementById(`${section}Section`).classList.add('active');
            currentSection = section;
            
            // Load section-specific data
            if (section === 'leaderboard') {
                loadLeaderboard();
            } else if (section === 'tasks') {
                loadTasks();
            }
        }

        // Start Farming
        function startFarming(isNew) {
            const now = Date.now();
            const farmingDuration = 12 * 60 * 60 * 1000; // 12 hours in milliseconds
            
            if (isNew) {
                userData.farming.startTime = now;
                userData.farming.endTime = now + farmingDuration;
                userData.farming.isActive = true;
                userData.farming.totalEarned = 0;
            }
            
            userData.farmingHours = (userData.farmingHours || 0) + 12;
            updateUserData();
            
            // Update UI
            farmingButton.textContent = 'Farming...';
            farmingButton.disabled = true;
            coin.classList.add('farming');
            
            // Start farming interval
            farmingInterval = setInterval(() => {
                const currentTime = Date.now();
                
                if (currentTime >= userData.farming.endTime) {
                    // Farming completed
                    clearInterval(farmingInterval);
                    userData.farming.isActive = false;
                    userData.farming.startTime = null;
                    userData.farming.endTime = null;
                    updateUserData();
                    
                    showToast('Farming completed! Start again to earn more TRM.', 'success');
                    return;
                }
                
                // Update balance
                userData.balance += 0.001;
                userData.farming.totalEarned += 0.001;
                
                // Show token animation
                tokenAnimation.classList.add('show');
                setTimeout(() => {
                    tokenAnimation.classList.remove('show');
                }, 1000);
                
                // Update timer
                const remainingTime = userData.farming.endTime - currentTime;
                const hours = Math.floor(remainingTime / (1000 * 60 * 60));
                const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);
                
                farmingTimer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')} remaining`;
                farmingStatus.textContent = `Earned: ${userData.farming.totalEarned.toFixed(3)} TRM`;
                
                // Update UI periodically
                if (Math.floor(currentTime / 1000) % 5 === 0) {
                    updateUserData();
                }
            }, 1000);
        }

        // Show Ad
        function showAd() {
            // This would integrate with the Monetag ad SDK
            // For now, we'll just show a placeholder
            if (window.show_10290264) {
                window.show_10290264();
            }
        }

        // Load Tasks
        function loadTasks() {
            database.ref('tasks').once('value').then(snapshot => {
                tasksList.innerHTML = '';
                
                if (!snapshot.exists()) {
                    tasksList.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No tasks available</div>';
                    return;
                }
                
                const tasks = snapshot.val();
                Object.keys(tasks).forEach(taskId => {
                    const task = tasks[taskId];
                    
                    // Check if task is completed
                    const isCompleted = userData.completedTasks && userData.completedTasks.includes(taskId);
                    
                    const taskCard = document.createElement('div');
                    taskCard.className = 'task-card';
                    
                    taskCard.innerHTML = `
                        <img src="${task.icon || 'https://i.postimg.cc/6QyTynDw/task.png'}" alt="${task.name}" class="task-icon">
                        <div class="task-details">
                            <div class="task-name">${task.name}</div>
                            <div class="task-reward">
                                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
                                <span>+${task.reward} TRM</span>
                            </div>
                        </div>
                        <button class="task-button ${isCompleted ? 'completed' : ''}" data-task-id="${taskId}" data-task-link="${task.link}" data-task-reward="${task.reward}">${isCompleted ? 'COMPLETED' : 'OPEN'}</button>
                    `;
                    
                    tasksList.appendChild(taskCard);
                });
                
                // Add event listeners to task buttons
                document.querySelectorAll('.task-button').forEach(button => {
                    button.addEventListener('click', () => {
                        const taskId = button.getAttribute('data-task-id');
                        const taskLink = button.getAttribute('data-task-link');
                        const taskReward = parseFloat(button.getAttribute('data-task-reward'));
                        
                        if (button.textContent === 'OPEN') {
                            button.textContent = 'PROCESSING';
                            button.classList.add('processing');
                            
                            // Open task link
                            window.open(taskLink, '_blank');
                            
                            // Simulate task completion after 10 seconds
                            setTimeout(() => {
                                userData.balance += taskReward;
                                userData.totalTasks = (userData.totalTasks || 0) + 1;
                                
                                if (!userData.completedTasks) {
                                    userData.completedTasks = [];
                                }
                                userData.completedTasks.push(taskId);
                                
                                updateUserData();
                                
                                button.textContent = 'COMPLETED';
                                button.classList.remove('processing');
                                button.classList.add('completed');
                                
                                showToast(`You earned ${taskReward} TRM!`, 'success');
                            }, 10000);
                        } else {
                            // Redirect to task link even if completed
                            window.open(taskLink, '_blank');
                        }
                    });
                });
            });
        }

        // Load Leaderboard
        function loadLeaderboard() {
            database.ref('users').orderByChild('balance').limitToLast(25).once('value').then(snapshot => {
                leaderboardList.innerHTML = '';
                
                if (!snapshot.exists()) {
                    leaderboardList.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">No data available</div>';
                    return;
                }
                
                const users = [];
                snapshot.forEach(childSnapshot => {
                    users.push({
                        id: childSnapshot.key,
                        ...childSnapshot.val()
                    });
                });
                
                // Sort by balance (descending)
                users.sort((a, b) => b.balance - a.balance);
                
                users.forEach((user, index) => {
                    const leaderboardItem = document.createElement('li');
                    leaderboardItem.className = 'leaderboard-item';
                    
                    // Highlight current user
                    if (user.id == userData.id) {
                        leaderboardItem.style.backgroundColor = 'rgba(99, 102, 241, 0.1)';
                        leaderboardItem.style.borderRadius = '8px';
                        leaderboardItem.style.padding = '12px';
                    }
                    
                    leaderboardItem.innerHTML = `
                        <div class="leaderboard-rank">${index + 1}</div>
                        <img src="${user.photoUrl || 'https://i.postimg.cc/6QyTynDw/avatar.png'}" alt="${user.firstName}" class="leaderboard-avatar">
                        <div class="leaderboard-details">
                            <div class="leaderboard-name">${user.firstName} ${user.lastName || ''}</div>
                            <div class="leaderboard-balance">
                                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
                                <span>${user.balance.toFixed(3)} TRM</span>
                            </div>
                        </div>
                    `;
                    
                    leaderboardList.appendChild(leaderboardItem);
                });
            });
        }

        // Show Toast Notification
        function showToast(message, type = 'info') {
            toast.textContent = message;
            toast.className = 'toast show';
            
            if (type === 'success') {
                toast.classList.add('success');
            } else if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'warning') {
                toast.classList.add('warning');
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
