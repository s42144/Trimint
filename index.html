<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Trimint - Earn TRM Tokens</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    
    <!-- TON Connect SDK -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    
    <!-- Monetag Ads -->
    <script src='//libtl.com/sdk.js' data-zone='10290264' data-sdk='show_10290264'></script>
    
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-text: #f1f5f9;
            --light-bg: #f8fafc;
            --light-card: #ffffff;
            --light-text: #1e293b;
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--light-text);
            overflow-x: hidden;
            position: relative;
        }

        body.dark-mode {
            --light-bg: #0f172a;
            --light-card: #1e293b;
            --light-text: #f1f5f9;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            background: var(--light-bg);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.3);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-logo {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .referral-info {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        /* Header */
        .header {
            background: var(--light-card);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            border: 3px solid var(--primary-color);
            animation: glow 2s ease-in-out infinite;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 5px;
        }

        .user-level {
            display: inline-block;
            padding: 4px 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .balance-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: var(--border-radius);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .balance-amount {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .coin-icon {
            width: 30px;
            height: 30px;
            background: url('https://i.postimg.cc/fTQktNmX/maincoin.png') no-repeat center;
            background-size: contain;
        }

        .level-badge {
            padding: 8px 16px;
            background: linear-gradient(135deg, var(--success-color), var(--warning-color));
            color: white;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Content Sections */
        .content {
            padding: 20px;
            padding-bottom: 100px;
            min-height: calc(100vh - 180px);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Home Section */
        .home-section {
            text-align: center;
            padding: 40px 20px;
        }

        .main-coin {
            width: 200px;
            height: 200px;
            margin: 0 auto 40px;
            background: url('https://i.postimg.cc/fTQktNmX/maincoin.png') no-repeat center;
            background-size: contain;
            transition: var(--transition);
        }

        .main-coin.farming {
            animation: rotate 3s linear infinite, glow 2s ease-in-out infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes glow {
            0%, 100% {
                filter: drop-shadow(0 0 20px rgba(99, 102, 241, 0.8));
            }
            50% {
                filter: drop-shadow(0 0 40px rgba(139, 92, 246, 1));
            }
        }

        .farming-button {
            padding: 20px 40px;
            background: linear-gradient(135deg, var(--success-color), var(--primary-color));
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
            margin-bottom: 20px;
        }

        .farming-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4);
        }

        .farming-button:disabled {
            background: linear-gradient(135deg, var(--danger-color), var(--warning-color));
            cursor: not-allowed;
            opacity: 0.8;
        }

        .farming-info {
            padding: 20px;
            background: var(--light-card);
            border-radius: var(--border-radius);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .countdown {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .farming-rate {
            font-size: 14px;
            color: var(--light-text);
            opacity: 0.8;
        }

        .token-animation {
            position: fixed;
            font-size: 20px;
            font-weight: bold;
            color: var(--success-color);
            pointer-events: none;
            z-index: 1000;
            animation: floatUp 2s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px);
            }
        }

        /* Task Section */
        .task-item {
            background: var(--light-card);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .task-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .task-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .task-info {
            flex: 1;
        }

        .task-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 5px;
        }

        .task-reward {
            font-size: 14px;
            color: var(--primary-color);
            font-weight: 600;
        }

        .task-description {
            font-size: 14px;
            color: var(--light-text);
            opacity: 0.8;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .task-button {
            width: 100%;
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .task-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 20px rgba(99, 102, 241, 0.3);
        }

        .task-button:disabled {
            background: linear-gradient(135deg, var(--danger-color), var(--warning-color));
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* Profile Section */
        .profile-section {
            padding: 20px 0;
        }

        .profile-card {
            background: var(--light-card);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: white;
            border: 4px solid var(--primary-color);
        }

        .profile-name {
            font-size: 20px;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 10px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-item {
            padding: 15px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--light-text);
            opacity: 0.8;
        }

        .wallet-section {
            margin-bottom: 30px;
        }

        .wallet-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 15px;
        }

        .wallet-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #0088cc, #0066aa);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .wallet-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 136, 204, 0.3);
        }

        .wallet-button.connected {
            background: linear-gradient(135deg, var(--success-color), var(--primary-color));
        }

        .wallet-address {
            padding: 12px;
            background: var(--dark-bg);
            border-radius: 12px;
            font-size: 12px;
            color: var(--light-text);
            margin-bottom: 10px;
            word-break: break-all;
            display: none;
        }

        .wallet-address.show {
            display: block;
        }

        .wallet-actions {
            display: flex;
            gap: 10px;
        }

        .wallet-action-btn {
            flex: 1;
            padding: 10px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .wallet-action-btn:hover {
            background: var(--secondary-color);
        }

        .settings-section {
            margin-top: 30px;
        }

        .settings-header {
            font-size: 16px;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 15px;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: var(--light-card);
            border-radius: 12px;
            margin-bottom: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: var(--primary-color);
            border-radius: 30px;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: var(--transition);
        }

        .toggle-switch.active {
            background: var(--secondary-color);
        }

        .toggle-switch.active::after {
            left: 33px;
        }

        /* Leaderboard Section */
        .leaderboard-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .leaderboard-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--light-text);
            margin-bottom: 10px;
        }

        .leaderboard-subtitle {
            font-size: 14px;
            color: var(--light-text);
            opacity: 0.8;
        }

        .leaderboard-list {
            background: var(--light-card);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .leaderboard-item:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .rank-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            margin-right: 15px;
        }

        .rank-number.gold {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
        }

        .rank-number.silver {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: #333;
        }

        .rank-number.bronze {
            background: linear-gradient(135deg, #cd7f32, #e6a157);
            color: white;
        }

        .leaderboard-user {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: white;
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 3px;
        }

        .leaderboard-level {
            font-size: 12px;
            color: var(--light-text);
            opacity: 0.8;
        }

        .leaderboard-balance {
            text-align: right;
        }

        .balance-amount {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .balance-amount .coin-icon {
            width: 16px;
            height: 16px;
        }

        /* Friends Section */
        .friends-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .friends-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--light-text);
            margin-bottom: 10px;
        }

        .referral-section {
            background: var(--light-card);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .referral-link {
            padding: 12px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            font-size: 12px;
            color: var(--light-text);
            margin-bottom: 15px;
            word-break: break-all;
        }

        .copy-button {
            padding: 12px 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 20px;
        }

        .copy-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .referral-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .referral-stat {
            padding: 15px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(99, 102, 241, 0.1));
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .referral-stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--success-color);
            margin-bottom: 5px;
        }

        .referral-stat-label {
            font-size: 12px;
            color: var(--light-text);
            opacity: 0.8;
        }

        .referrals-list {
            background: var(--light-card);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .referral-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .referral-item:last-child {
            border-bottom: none;
        }

        .referral-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            color: white;
            margin-right: 12px;
        }

        .referral-info {
            flex: 1;
        }

        .referral-name {
            font-size: 14px;
            font-weight: 600;
            color: var(--light-text);
            margin-bottom: 3px;
        }

        .referral-earned {
            font-size: 12px;
            color: var(--success-color);
            font-weight: 600;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            background: var(--light-card);
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.1);
            padding: 10px 0;
            z-index: 100;
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 20px;
        }

        .nav-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            padding: 10px;
            background: none;
            border: none;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .nav-button.home {
            transform: scale(1.2);
        }

        .nav-button.active {
            color: var(--primary-color);
        }

        .nav-button:hover {
            transform: translateY(-2px);
        }

        .nav-button.home:hover {
            transform: scale(1.2) translateY(-2px);
        }

        .nav-icon {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            transition: var(--transition);
        }

        .nav-button.home .nav-icon {
            width: 50px;
            height: 50px;
            font-size: 24px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--light-text);
        }

        .nav-button.active .nav-label {
            color: var(--primary-color);
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .container {
                max-width: 100%;
                box-shadow: none;
            }
            
            .bottom-nav {
                width: 100%;
            }
            
            .nav-container {
                padding: 0 10px;
            }
            
            .nav-button.home {
                transform: scale(1.1);
            }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* Loading Animation */
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
    <div class="container">
        <!-- Loading Screen -->
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-logo">
                <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM" style="width: 100%; height: 100%; object-fit: contain;">
            </div>
            <div class="loading-text">Welcome to Trimint!</div>
            <div class="referral-info" id="referralInfo" style="display: none;">
                <div>You were referred by: <strong id="referralName"></strong></div>
                <div style="margin-top: 10px; font-size: 12px;">+5000 TRM Bonus Added!</div>
            </div>
            <div class="loading-spinner"></div>
        </div>

        <!-- Header -->
        <div class="header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">
                    <span id="avatarInitial">U</span>
                </div>
                <div class="user-details">
                    <div class="user-name" id="userName">Loading...</div>
                    <span class="user-level" id="userLevel">Bronze</span>
                </div>
            </div>
            <div class="balance-section">
                <div class="balance-amount">
                    <div class="coin-icon"></div>
                    <span id="userBalance">0</span>
                </div>
                <div class="level-badge" id="levelBadge">BRONZE</div>
            </div>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Home Section -->
            <div class="section active" id="homeSection">
                <div class="home-section">
                    <div class="main-coin" id="mainCoin"></div>
                    <button class="farming-button" id="farmingButton" onclick="toggleFarming()">
                        Start Farming
                    </button>
                    <div class="farming-info" id="farmingInfo" style="display: none;">
                        <div class="countdown" id="countdown">12:00:00</div>
                        <div class="farming-rate">
                            Earning: 0.001 TRM per second
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Section -->
            <div class="section" id="tasksSection">
                <div class="task-item">
                    <div class="task-header">
                        <div class="task-icon">üì∫</div>
                        <div class="task-info">
                            <div class="task-title">Watch Ads</div>
                            <div class="task-reward">+1 TRM Token</div>
                        </div>
                    </div>
                    <div class="task-description">
                        Watch advertisements to earn TRM tokens instantly
                    </div>
                    <button class="task-button" onclick="watchAd()">Watch Ad</button>
                </div>
                <div id="tasksList"></div>
            </div>

            <!-- Profile Section -->
            <div class="section" id="profileSection">
                <div class="profile-section">
                    <div class="profile-card">
                        <div class="profile-header">
                            <div class="profile-avatar" id="profileAvatar">
                                <span id="profileInitial">U</span>
                            </div>
                            <div class="profile-name" id="profileName">Loading...</div>
                        </div>
                        
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="totalFriends">0</div>
                                <div class="stat-label">Total Friends</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalEarned">0</div>
                                <div class="stat-label">Total Earned</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="farmingTime">0h</div>
                                <div class="stat-label">Farming Time</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="tasksCompleted">0</div>
                                <div class="stat-label">Tasks Done</div>
                            </div>
                        </div>
                    </div>

                    <div class="wallet-section">
                        <div class="wallet-header">TON Wallet</div>
                        <button class="wallet-button" id="walletButton" onclick="toggleWallet()">
                            Connect TON Wallet
                        </button>
                        <div class="wallet-address" id="walletAddress"></div>
                        <div class="wallet-actions" id="walletActions" style="display: none;">
                            <button class="wallet-action-btn" onclick="copyWalletAddress()">Copy</button>
                            <button class="wallet-action-btn" onclick="disconnectWallet()">Disconnect</button>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-header">Settings</div>
                        <div class="theme-toggle">
                            <span>Dark Mode</span>
                            <div class="toggle-switch" id="themeToggle" onclick="toggleTheme()"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leaderboard Section -->
            <div class="section" id="leaderboardSection">
                <div class="leaderboard-header">
                    <div class="leaderboard-title">Top Players</div>
                    <div class="leaderboard-subtitle">Real-time TRM Token Rankings</div>
                </div>
                <div class="leaderboard-list" id="leaderboardList">
                    <!-- Leaderboard items will be populated here -->
                </div>
            </div>

            <!-- Friends Section -->
            <div class="section" id="friendsSection">
                <div class="friends-header">
                    <div class="friends-title">Invite Friends</div>
                </div>
                
                <div class="referral-section">
                    <div class="referral-link" id="referralLink">
                        Generating referral link...
                    </div>
                    <button class="copy-button" onclick="copyReferralLink()">Copy Referral Link</button>
                    
                    <div class="referral-stats">
                        <div class="referral-stat">
                            <div class="referral-stat-value" id="referralCount">0</div>
                            <div class="referral-stat-label">Total Referrals</div>
                        </div>
                        <div class="referral-stat">
                            <div class="referral-stat-value" id="referralEarnings">0</div>
                            <div class="referral-stat-label">Referral Earnings</div>
                        </div>
                    </div>
                </div>
                
                <div class="referrals-list" id="referralsList">
                    <!-- Referrals will be populated here -->
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <div class="nav-container">
                <button class="nav-button active" onclick="switchSection('home')">
                    <div class="nav-icon">üè†</div>
                    <span class="nav-label">Home</span>
                </button>
                <button class="nav-button" onclick="switchSection('tasks')">
                    <div class="nav-icon">üìã</div>
                    <span class="nav-label">Tasks</span>
                </button>
                <button class="nav-button" onclick="switchSection('profile')">
                    <div class="nav-icon">üë§</div>
                    <span class="nav-label">Profile</span>
                </button>
                <button class="nav-button" onclick="switchSection('leaderboard')">
                    <div class="nav-icon">üèÜ</div>
                    <span class="nav-label">Leaderboard</span>
                </button>
                <button class="nav-button" onclick="switchSection('friends')">
                    <div class="nav-icon">üë•</div>
                    <span class="nav-label">Friends</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
            authDomain: "msc-by-shawon.firebaseapp.com",
            projectId: "msc-by-shawon",
            storageBucket: "msc-by-shawon.firebasestorage.app",
            messagingSenderId: "432753389120",
            appId: "1:432753389120:web:dcbb46ca39408a405579a5",
            measurementId: "G-8LHGLJSSEE"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const analytics = firebase.analytics();

        // Global Variables
        let currentUser = null;
        let userData = null;
        let farmingInterval = null;
        let tonConnect = null;
        let walletConnected = false;

        // Telegram Bot API
        const telegramBotToken = '8099896534:AAFmOTkOjLC8RSSJy-dXtjPQotF3hJlyXTQ';

        // Initialize App
        window.onload = function() {
            initializeTelegramApp();
            initializeTONConnect();
            loadUserData();
            setupEventListeners();
        };

        // Initialize Telegram Mini App
        function initializeTelegramApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const webApp = window.Telegram.WebApp;
                webApp.ready();
                webApp.expand();
                
                // Get user data from Telegram
                currentUser = webApp.initDataUnsafe?.user;
                
                if (currentUser) {
                    console.log('Telegram User:', currentUser);
                    initializeUser(currentUser);
                }
            }
        }

        // Initialize TON Connect
        function initializeTONConnect() {
            try {
                tonConnect = new TONConnectUI({
                    manifestUrl: 'https://trimint.vercel.app/tonconnect-manifest.json',
                    buttonRootId: null
                });

                tonConnect.onStatusChange(wallet => {
                    if (wallet) {
                        walletConnected = true;
                        document.getElementById('walletButton').textContent = 'Connected';
                        document.getElementById('walletButton').classList.add('connected');
                        document.getElementById('walletAddress').textContent = wallet.account.address;
                        document.getElementById('walletAddress').classList.add('show');
                        document.getElementById('walletActions').style.display = 'flex';
                        
                        // Save wallet address to Firebase
                        saveWalletAddress(wallet.account.address);
                    } else {
                        walletConnected = false;
                        document.getElementById('walletButton').textContent = 'Connect TON Wallet';
                        document.getElementById('walletButton').classList.remove('connected');
                        document.getElementById('walletAddress').classList.remove('show');
                        document.getElementById('walletActions').style.display = 'none';
                    }
                });
            } catch (error) {
                console.error('TON Connect initialization error:', error);
            }
        }

        // Initialize User in Firebase
        function initializeUser(telegramUser) {
            const userId = telegramUser.id;
            const userRef = database.ref('users/' + userId);

            userRef.once('value').then((snapshot) => {
                if (!snapshot.exists()) {
                    // New user - create initial data
                    const referralCode = getReferralFromURL();
                    const initialData = {
                        telegramId: userId,
                        firstName: telegramUser.first_name || 'User',
                        lastName: telegramUser.last_name || '',
                        username: telegramUser.username || '',
                        photoUrl: telegramUser.photo_url || '',
                        balance: referralCode ? 5000 : 0,
                        level: 'Bronze',
                        totalFriends: 0,
                        totalEarned: 0,
                        farmingTime: 0,
                        tasksCompleted: 0,
                        referrals: [],
                        walletAddress: '',
                        farmingActive: false,
                        farmingStartTime: null,
                        completedTasks: [],
                        referralCode: generateReferralCode(userId),
                        referredBy: referralCode || null,
                        createdAt: firebase.database.ServerValue.TIMESTAMP,
                        lastActive: firebase.database.ServerValue.TIMESTAMP
                    };

                    // Process referral if exists
                    if (referralCode) {
                        processReferral(referralCode, userId, telegramUser.first_name);
                        showReferralInfo(referralCode);
                    }

                    userRef.set(initialData).then(() => {
                        userData = initialData;
                        updateUI();
                        hideLoadingScreen();
                    });
                } else {
                    userData = snapshot.val();
                    userData.lastActive = firebase.database.ServerValue.TIMESTAMP;
                    userRef.update({ lastActive: userData.lastActive });
                    updateUI();
                    hideLoadingScreen();
                }
            });
        }

        // Get referral code from URL
        function getReferralFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const startapp = urlParams.get('startapp');
            return startapp ? startapp : null;
        }

        // Process referral
        function processReferral(referralCode, newUserId, newUserName) {
            const referrerRef = database.ref('users/' + referralCode);
            
            referrerRef.once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const referrerData = snapshot.val();
                    
                    // Add referral to referrer's list
                    if (!referrerData.referrals) {
                        referrerData.referrals = [];
                    }
                    
                    referrerData.referrals.push({
                        userId: newUserId,
                        userName: newUserName,
                        earned: 5000,
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                    
                    // Update referrer's data
                    referrerRef.update({
                        referrals: referrerData.referrals,
                        balance: referrerData.balance + 5000,
                        totalFriends: (referrerData.totalFriends || 0) + 1,
                        totalEarned: (referrerData.totalEarned || 0) + 5000
                    });
                }
            });
        }

        // Show referral info on loading screen
        function showReferralInfo(referralCode) {
            const referrerRef = database.ref('users/' + referralCode);
            
            referrerRef.once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const referrerData = snapshot.val();
                    document.getElementById('referralName').textContent = referrerData.firstName;
                    document.getElementById('referralInfo').style.display = 'block';
                    
                    // Hide after 3 seconds
                    setTimeout(() => {
                        document.getElementById('referralInfo').style.display = 'none';
                    }, 3000);
                }
            });
        }

        // Generate referral code
        function generateReferralCode(userId) {
            return userId.toString();
        }

        // Hide loading screen
        function hideLoadingScreen() {
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
            }, 2000);
        }

        // Load user data
        function loadUserData() {
            if (currentUser) {
                const userId = currentUser.id;
                const userRef = database.ref('users/' + userId);
                
                userRef.on('value', (snapshot) => {
                    userData = snapshot.val();
                    if (userData) {
                        updateUI();
                        updateLevel();
                    }
                });
            }
        }

        // Update UI with user data
        function updateUI() {
            if (!userData) return;

            // Update header
            document.getElementById('userName').textContent = userData.firstName || 'User';
            document.getElementById('userBalance').textContent = userData.balance || 0;
            document.getElementById('userLevel').textContent = userData.level || 'Bronze';
            document.getElementById('levelBadge').textContent = (userData.level || 'Bronze').toUpperCase();
            
            // Update profile
            document.getElementById('profileName').textContent = userData.firstName || 'User';
            document.getElementById('totalFriends').textContent = userData.totalFriends || 0;
            document.getElementById('totalEarned').textContent = userData.totalEarned || 0;
            document.getElementById('farmingTime').textContent = formatTime(userData.farmingTime || 0);
            document.getElementById('tasksCompleted').textContent = userData.tasksCompleted || 0;
            
            // Update initials
            const initial = (userData.firstName || 'U')[0].toUpperCase();
            document.getElementById('avatarInitial').textContent = initial;
            document.getElementById('profileInitial').textContent = initial;
            
            // Update referral link
            const referralLink = `https://t.me/TrimintBot/open?startapp=${userData.telegramId}`;
            document.getElementById('referralLink').textContent = referralLink;
            document.getElementById('referralCount').textContent = userData.referrals ? userData.referrals.length : 0;
            document.getElementById('referralEarnings').textContent = (userData.referrals ? userData.referrals.length : 0) * 5000;
            
            // Load referrals
            loadReferrals();
            
            // Load tasks
            loadTasks();
            
            // Load leaderboard
            loadLeaderboard();
            
            // Check farming status
            if (userData.farmingActive && userData.farmingStartTime) {
                resumeFarming();
            }
        }

        // Update user level based on balance
        function updateLevel() {
            if (!userData) return;
            
            let newLevel = 'Bronze';
            const balance = userData.balance || 0;
            
            if (balance >= 50000) {
                newLevel = 'Diamond';
            } else if (balance >= 10000) {
                newLevel = 'Gold';
            } else {
                newLevel = 'Bronze';
            }
            
            if (userData.level !== newLevel) {
                userData.level = newLevel;
                database.ref('users/' + userData.telegramId).update({ level: newLevel });
            }
        }

        // Format time
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return `${hours}h ${minutes}m`;
        }

        // Switch between sections
        function switchSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName + 'Section').classList.add('active');
            
            // Add active class to clicked button
            event.target.closest('.nav-button').classList.add('active');
            
            // Load section-specific data
            if (sectionName === 'leaderboard') {
                loadLeaderboard();
            } else if (sectionName === 'friends') {
                loadReferrals();
            } else if (sectionName === 'tasks') {
                loadTasks();
            }
        }

        // Farming functions
        function toggleFarming() {
            if (!userData) return;
            
            const button = document.getElementById('farmingButton');
            const coin = document.getElementById('mainCoin');
            
            if (userData.farmingActive) {
                // Stop farming
                stopFarming();
            } else {
                // Start farming
                startFarming();
            }
        }

        function startFarming() {
            if (!userData) return;
            
            userData.farmingActive = true;
            userData.farmingStartTime = Date.now();
            
            const button = document.getElementById('farmingButton');
            const coin = document.getElementById('mainCoin');
            const farmingInfo = document.getElementById('farmingInfo');
            
            button.textContent = 'Stop Farming';
            button.style.background = 'linear-gradient(135deg, #ef4444, #f59e0b)';
            coin.classList.add('farming');
            farmingInfo.style.display = 'block';
            
            // Update Firebase
            database.ref('users/' + userData.telegramId).update({
                farmingActive: true,
                farmingStartTime: userData.farmingStartTime
            });
            
            // Start farming interval
            farmingInterval = setInterval(() => {
                const elapsed = Date.now() - userData.farmingStartTime;
                const maxTime = 12 * 60 * 60 * 1000; // 12 hours
                
                if (elapsed >= maxTime) {
                    stopFarming();
                    return;
                }
                
                // Add 0.001 TRM per second
                userData.balance = (userData.balance || 0) + 0.001;
                userData.totalEarned = (userData.totalEarned || 0) + 0.001;
                userData.farmingTime = (userData.farmingTime || 0) + 1;
                
                // Update UI
                document.getElementById('userBalance').textContent = userData.balance.toFixed(3);
                document.getElementById('totalEarned').textContent = userData.totalEarned.toFixed(3);
                document.getElementById('farmingTime').textContent = formatTime(userData.farmingTime);
                
                // Update countdown
                const remaining = Math.max(0, maxTime - elapsed);
                const hours = Math.floor(remaining / 3600000);
                const minutes = Math.floor((remaining % 3600000) / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                document.getElementById('countdown').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // Show token animation
                showTokenAnimation();
                
                // Update Firebase every 10 seconds
                if (userData.farmingTime % 10 === 0) {
                    database.ref('users/' + userData.telegramId).update({
                        balance: userData.balance,
                        totalEarned: userData.totalEarned,
                        farmingTime: userData.farmingTime
                    });
                    updateLevel();
                }
            }, 1000);
        }

        function stopFarming() {
            if (!userData) return;
            
            userData.farmingActive = false;
            userData.farmingStartTime = null;
            
            const button = document.getElementById('farmingButton');
            const coin = document.getElementById('mainCoin');
            const farmingInfo = document.getElementById('farmingInfo');
            
            button.textContent = 'Start Farming';
            button.style.background = 'linear-gradient(135deg, #10b981, #6366f1)';
            coin.classList.remove('farming');
            farmingInfo.style.display = 'none';
            
            // Clear interval
            if (farmingInterval) {
                clearInterval(farmingInterval);
                farmingInterval = null;
            }
            
            // Update Firebase
            database.ref('users/' + userData.telegramId).update({
                farmingActive: false,
                farmingStartTime: null,
                balance: userData.balance,
                totalEarned: userData.totalEarned,
                farmingTime: userData.farmingTime
            });
        }

        function resumeFarming() {
            if (!userData.farmingActive || !userData.farmingStartTime) return;
            
            const elapsed = Date.now() - userData.farmingStartTime;
            const maxTime = 12 * 60 * 60 * 1000; // 12 hours
            
            if (elapsed < maxTime) {
                // Resume farming
                startFarming();
            } else {
                // Farming expired, reset
                userData.farmingActive = false;
                userData.farmingStartTime = null;
                database.ref('users/' + userData.telegramId).update({
                    farmingActive: false,
                    farmingStartTime: null
                });
            }
        }

        function showTokenAnimation() {
            const animation = document.createElement('div');
            animation.className = 'token-animation';
            animation.textContent = '+0.001 TRM';
            animation.style.left = '50%';
            animation.style.top = '50%';
            document.body.appendChild(animation);
            
            setTimeout(() => {
                animation.remove();
            }, 2000);
        }

        // Wallet functions
        function toggleWallet() {
            if (!tonConnect) return;
            
            if (walletConnected) {
                tonConnect.disconnect();
            } else {
                tonConnect.connectWallet();
            }
        }

        function copyWalletAddress() {
            if (!walletConnected || !tonConnect.wallet) return;
            
            const address = tonConnect.wallet.account.address;
            navigator.clipboard.writeText(address).then(() => {
                alert('Wallet address copied!');
            });
        }

        function disconnectWallet() {
            if (!tonConnect) return;
            tonConnect.disconnect();
        }

        function saveWalletAddress(address) {
            if (!userData) return;
            
            userData.walletAddress = address;
            database.ref('users/' + userData.telegramId).update({
                walletAddress: address
            });
        }

        // Tasks functions
        function loadTasks() {
            const tasksRef = database.ref('tasks');
            tasksRef.once('value').then((snapshot) => {
                const tasks = snapshot.val();
                const tasksList = document.getElementById('tasksList');
                tasksList.innerHTML = '';
                
                if (tasks) {
                    Object.entries(tasks).forEach(([taskId, task]) => {
                        const taskElement = createTaskElement(taskId, task);
                        tasksList.appendChild(taskElement);
                    });
                }
            });
        }

        function createTaskElement(taskId, task) {
            const div = document.createElement('div');
            div.className = 'task-item';
            
            const isCompleted = userData && userData.completedTasks && userData.completedTasks.includes(taskId);
            const buttonText = isCompleted ? 'Completed' : 'OPEN';
            const buttonClass = isCompleted ? 'disabled' : '';
            
            div.innerHTML = `
                <div class="task-header">
                    <div class="task-icon" style="background-image: url('${task.icon || ''}'); background-size: cover;">
                        ${!task.icon ? 'üìã' : ''}
                    </div>
                    <div class="task-info">
                        <div class="task-title">${task.name || 'Task'}</div>
                        <div class="task-reward">+${task.reward || 0} TRM Tokens</div>
                    </div>
                </div>
                <div class="task-description">
                    ${task.description || 'Complete this task to earn TRM tokens'}
                </div>
                <button class="task-button ${buttonClass}" 
                        onclick="completeTask('${taskId}', '${task.link || ''}', ${task.reward || 0})"
                        ${isCompleted ? 'disabled' : ''}>
                    ${buttonText}
                </button>
            `;
            
            return div;
        }

        function completeTask(taskId, taskLink, reward) {
            if (!userData || userData.completedTasks && userData.completedTasks.includes(taskId)) {
                if (taskLink) {
                    window.open(taskLink, '_blank');
                }
                return;
            }
            
            // Update button to processing
            const button = event.target;
            button.textContent = 'PROCESSING';
            button.disabled = true;
            
            // Open task link
            if (taskLink) {
                window.open(taskLink, '_blank');
            }
            
            // Wait 10 seconds then add reward
            setTimeout(() => {
                if (!userData.completedTasks) {
                    userData.completedTasks = [];
                }
                
                userData.completedTasks.push(taskId);
                userData.balance = (userData.balance || 0) + reward;
                userData.totalEarned = (userData.totalEarned || 0) + reward;
                userData.tasksCompleted = (userData.tasksCompleted || 0) + 1;
                
                // Update UI
                updateUI();
                
                // Update Firebase
                database.ref('users/' + userData.telegramId).update({
                    completedTasks: userData.completedTasks,
                    balance: userData.balance,
                    totalEarned: userData.totalEarned,
                    tasksCompleted: userData.tasksCompleted
                });
                
                // Update button
                button.textContent = 'Completed';
                button.classList.add('disabled');
                
                // Show success animation
                showTokenAnimation();
            }, 10000);
        }

        function watchAd() {
            // Show Monetag ad
            try {
                // Trigger Monetag ad display
                if (window.libtl) {
                    window.libtl.showAd();
                }
                
                // Add 1 TRM after ad
                setTimeout(() => {
                    if (userData) {
                        userData.balance = (userData.balance || 0) + 1;
                        userData.totalEarned = (userData.totalEarned || 0) + 1;
                        
                        // Update UI
                        updateUI();
                        
                        // Update Firebase
                        database.ref('users/' + userData.telegramId).update({
                            balance: userData.balance,
                            totalEarned: userData.totalEarned
                        });
                        
                        showTokenAnimation();
                    }
                }, 2000);
            } catch (error) {
                console.error('Error showing ad:', error);
            }
        }

        // Leaderboard functions
        function loadLeaderboard() {
            const usersRef = database.ref('users').orderByChild('balance').limitToLast(25);
            usersRef.once('value').then((snapshot) => {
                const users = snapshot.val();
                const leaderboardList = document.getElementById('leaderboardList');
                leaderboardList.innerHTML = '';
                
                if (users) {
                    // Convert to array and sort by balance
                    const usersArray = Object.entries(users).map(([userId, userData]) => ({
                        userId,
                        ...userData
                    })).sort((a, b) => b.balance - a.balance);
                    
                    usersArray.forEach((user, index) => {
                        const userElement = createLeaderboardItem(index + 1, user);
                        leaderboardList.appendChild(userElement);
                    });
                }
            });
        }

        function createLeaderboardItem(rank, user) {
            const div = document.createElement('div');
            div.className = 'leaderboard-item';
            
            let rankClass = '';
            if (rank === 1) rankClass = 'gold';
            else if (rank === 2) rankClass = 'silver';
            else if (rank === 3) rankClass = 'bronze';
            
            div.innerHTML = `
                <div class="rank-number ${rankClass}">${rank}</div>
                <div class="leaderboard-user">
                    <div class="leaderboard-avatar">
                        <img src="${user.photoUrl || ''}" alt="${user.firstName}" 
                             style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div style="display: none; width: 100%; height: 100%; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; font-weight: bold;">
                            ${(user.firstName || 'U')[0].toUpperCase()}
                        </div>
                    </div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${user.firstName || 'User'}</div>
                        <div class="leaderboard-level">${user.level || 'Bronze'}</div>
                    </div>
                </div>
                <div class="leaderboard-balance">
                    <div class="balance-amount">
                        <div class="coin-icon"></div>
                        ${user.balance ? user.balance.toFixed(3) : '0'}
                    </div>
                </div>
            `;
            
            return div;
        }

        // Friends functions
        function loadReferrals() {
            if (!userData || !userData.referrals) {
                document.getElementById('referralsList').innerHTML = `
                    <div style="padding: 20px; text-align: center; color: var(--light-text); opacity: 0.6;">
                        No referrals yet. Invite friends to earn TRM tokens!
                    </div>
                `;
                return;
            }
            
            const referralsList = document.getElementById('referralsList');
            referralsList.innerHTML = '';
            
            userData.referrals.forEach(referral => {
                const referralElement = createReferralItem(referral);
                referralsList.appendChild(referralElement);
            });
        }

        function createReferralItem(referral) {
            const div = document.createElement('div');
            div.className = 'referral-item';
            
            div.innerHTML = `
                <div class="referral-avatar">
                    ${(referral.userName || 'U')[0].toUpperCase()}
                </div>
                <div class="referral-info">
                    <div class="referral-name">${referral.userName || 'Unknown User'}</div>
                    <div class="referral-earned">Earned: +${referral.earned || 0} TRM</div>
                </div>
            `;
            
            return div;
        }

        function copyReferralLink() {
            if (!userData) return;
            
            const referralLink = `https://t.me/TrimintBot/open?startapp=${userData.telegramId}`;
            navigator.clipboard.writeText(referralLink).then(() => {
                // Show success message
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.background = 'linear-gradient(135deg, #10b981, #6366f1)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '';
                }, 2000);
            });
        }

        // Theme toggle
        function toggleTheme() {
            const body = document.body;
            const toggle = document.getElementById('themeToggle');
            
            body.classList.toggle('dark-mode');
            toggle.classList.toggle('active');
            
            // Save preference to Firebase
            if (userData) {
                const isDarkMode = body.classList.contains('dark-mode');
                database.ref('users/' + userData.telegramId).update({
                    darkMode: isDarkMode
                });
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Listen for real-time leaderboard updates
            database.ref('users').on('value', (snapshot) => {
                const currentSection = document.querySelector('.section.active');
                if (currentSection && currentSection.id === 'leaderboardSection') {
                    loadLeaderboard();
                }
            });
            
            // Listen for task updates
            database.ref('tasks').on('value', () => {
                const currentSection = document.querySelector('.section.active');
                if (currentSection && currentSection.id === 'tasksSection') {
                    loadTasks();
                }
            });
            
            // Load user theme preference
            if (userData && userData.darkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('themeToggle').classList.add('active');
            }
        }

        // Error handling
        window.addEventListener('error', (event) => {
            console.error('App error:', event.error);
        });

        // Handle page visibility change
        document.addEventListener('visibilitychange', () => {
            if (document.hidden && userData && userData.farmingActive) {
                // Page is hidden, pause farming animation but keep counting
                console.log('App hidden, farming continues in background');
            }
        });
    </script>
</body>
</html>
