<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trimint - Telegram Mining App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6cf7;
            --secondary-color: #f0f2ff;
            --accent-color: #6c63ff;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --coin-color: #ffd700;
        }

        [data-theme="dark"] {
            --primary-color: #5a7cff;
            --secondary-color: #1a1a2e;
            --accent-color: #7c72ff;
            --text-color: #e0e0e0;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333;
            --success-color: #66bb6a;
            --warning-color: #ffb74d;
            --danger-color: #ef5350;
            --coin-color: #ffeb3b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-bottom: 80px;
        }

        .container {
            max-width: 100%;
            padding: 15px;
            margin: 0 auto;
            width: 100%;
        }

        header {
            background-color: var(--card-bg);
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .logo img {
            width: 30px;
            height: 30px;
        }

        .balance-container {
            display: flex;
            align-items: center;
            gap: 5px;
            background-color: var(--secondary-color);
            padding: 5px 10px;
            border-radius: 20px;
        }

        .balance-container img {
            width: 20px;
            height: 20px;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2rem;
            cursor: pointer;
        }

        .content {
            flex: 1;
            padding: 20px 0;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .btn:hover {
            background-color: var(--accent-color);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: var(--text-color);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-warning {
            background-color: var(--warning-color);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            background: none;
            border: none;
            color: var(--text-color);
            cursor: pointer;
            transition: color 0.3s;
            font-size: 0.8rem;
        }

        .nav-btn.active {
            color: var(--primary-color);
        }

        .nav-btn i {
            font-size: 1.2rem;
        }

        .nav-btn.home-btn {
            position: relative;
            top: -15px;
            background-color: var(--primary-color);
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.home-btn i {
            font-size: 1.8rem;
        }

        .coin-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
        }

        .coin {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: var(--coin-color);
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .coin:hover {
            transform: scale(1.05);
        }

        .coin.farming {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        .coin img {
            width: 120px;
            height: 120px;
        }

        .farming-info {
            margin-top: 20px;
            text-align: center;
        }

        .countdown {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .task-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .task-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: var(--primary-color);
            color: white;
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .task-reward {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--success-color);
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
        }

        .leaderboard-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .leaderboard-details {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .leaderboard-balance {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .referral-link {
            background-color: var(--secondary-color);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .referral-link-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 10px;
        }

        .referral-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .referral-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .referral-details {
            flex: 1;
        }

        .referral-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .referral-earned {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--success-color);
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-details {
            flex: 1;
        }

        .profile-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-level {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .level-bronze {
            background-color: #cd7f32;
            color: white;
        }

        .level-silver {
            background-color: #c0c0c0;
            color: #333;
        }

        .level-gold {
            background-color: #ffd700;
            color: #333;
        }

        .level-diamond {
            background-color: #b9f2ff;
            color: #333;
        }

        .profile-stats {
            display: flex;
            gap: 10px;
        }

        .profile-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            flex: 1;
        }

        .profile-stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .profile-stat-label {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .wallet-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            margin-bottom: 20px;
        }

        .wallet-address {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .wallet-actions {
            display: flex;
            gap: 10px;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-radius: 10px;
            background-color: var(--secondary-color);
            margin-bottom: 15px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background-color: #ccc;
            border-radius: 34px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .toggle-switch.active {
            background-color: var(--primary-color);
        }

        .toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-logo {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .loading-subtext {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            background-color: var(--success-color);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            transform: translateX(150%);
            transition: transform 0.3s;
        }

        .notification.show {
            transform: translateX(0);
        }

        .ads-container {
            margin: 20px 0;
            text-align: center;
        }

        .floating-coin {
            position: absolute;
            font-size: 1.5rem;
            color: var(--coin-color);
            font-weight: bold;
            animation: floatUp 2s ease-out forwards;
            pointer-events: none;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(0.5);
                opacity: 0;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .coin {
                width: 120px;
                height: 120px;
            }
            
            .coin img {
                width: 90px;
                height: 90px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="Trimint Logo" class="loading-logo">
        <div class="loading-text">Welcome to Trimint</div>
        <div class="loading-subtext" id="loadingSubtext">Loading your profile...</div>
    </div>

    <div class="notification" id="notification"></div>

    <header>
        <div class="logo">
            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="Trimint">
            <span>Trimint</span>
        </div>
        <div class="balance-container">
            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM">
            <span id="balance">0</span>
            <span>TRM</span>
        </div>
        <button class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon"></i>
        </button>
    </header>

    <div class="content">
        <div class="container">
            <!-- Home Section -->
            <div class="section active" id="homeSection">
                <div class="card">
                    <div class="card-title">Mining Center</div>
                    <div class="coin-container">
                        <div class="coin" id="miningCoin">
                            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM Coin">
                        </div>
                        <div class="farming-info">
                            <div class="countdown" id="farmingCountdown">Start Farming</div>
                            <button class="btn" id="startFarmingBtn">Start Farming</button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Wallet Connection</div>
                    <div class="wallet-info" id="walletInfo">
                        <div class="wallet-address" id="walletAddress">Not Connected</div>
                        <div class="wallet-actions">
                            <button class="btn" id="connectWalletBtn">Connect TON Wallet</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tasks Section -->
            <div class="section" id="tasksSection">
                <div class="card">
                    <div class="card-title">Tasks</div>
                    <div class="ads-container">
                        <div id="monetagAds"></div>
                    </div>
                    <div id="tasksList">
                        <!-- Tasks will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Leaderboard Section -->
            <div class="section" id="leaderboardSection">
                <div class="card">
                    <div class="card-title">Top Miners</div>
                    <div id="leaderboardList">
                        <!-- Leaderboard will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Friends Section -->
            <div class="section" id="friendsSection">
                <div class="card">
                    <div class="card-title">Referral Program</div>
                    <div class="referral-link">
                        <div class="referral-link-text" id="referralLink">https://t.me/TrimintBot/mine?startapp=</div>
                        <button class="btn" id="copyReferralBtn">Copy</button>
                    </div>
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="totalReferrals">0</div>
                            <div class="profile-stat-label">Total Referrals</div>
                        </div>
                        <div class="profile-stat">
                            <div class="profile-stat-value" id="referralEarnings">0</div>
                            <div class="profile-stat-label">Referral Earnings</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-title">Your Referrals</div>
                    <div id="referralsList">
                        <!-- Referrals will be loaded here -->
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div class="section" id="profileSection">
                <div class="card">
                    <div class="profile-info">
                        <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="Profile" class="profile-avatar" id="profileAvatar">
                        <div class="profile-details">
                            <div class="profile-name" id="profileName">User</div>
                            <div class="profile-level level-bronze" id="profileLevel">Bronze</div>
                            <div class="profile-stats">
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profileBalance">0</div>
                                    <div class="profile-stat-label">Balance</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profileFriends">0</div>
                                    <div class="profile-stat-label">Friends</div>
                                </div>
                                <div class="profile-stat">
                                    <div class="profile-stat-value" id="profileRank">-</div>
                                    <div class="profile-stat-label">Rank</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Settings</div>
                    <div class="settings-item">
                        <div>Notifications</div>
                        <div class="toggle-switch active" id="notificationsToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="settings-item">
                        <div>Sound Effects</div>
                        <div class="toggle-switch active" id="soundToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="settings-item">
                        <div>Auto Farming</div>
                        <div class="toggle-switch" id="autoFarmingToggle">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom-nav">
        <button class="nav-btn" id="tasksNavBtn">
            <i class="fas fa-tasks"></i>
            <span>Tasks</span>
        </button>
        <button class="nav-btn" id="leaderboardNavBtn">
            <i class="fas fa-trophy"></i>
            <span>Leaderboard</span>
        </button>
        <button class="nav-btn home-btn active" id="homeNavBtn">
            <i class="fas fa-home"></i>
        </button>
        <button class="nav-btn" id="friendsNavBtn">
            <i class="fas fa-user-friends"></i>
            <span>Friends</span>
        </button>
        <button class="nav-btn" id="profileNavBtn">
            <i class="fas fa-user"></i>
            <span>Profile</span>
        </button>
    </div>

    <!-- Wallet Modal -->
    <div class="modal" id="walletModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">TON Wallet</div>
                <button class="modal-close" id="closeWalletModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="wallet-info">
                    <div class="wallet-address" id="modalWalletAddress">Not Connected</div>
                    <div class="wallet-actions">
                        <button class="btn" id="copyWalletBtn">Copy</button>
                        <button class="btn btn-danger" id="disconnectWalletBtn">Disconnect</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="closeWalletModalBtn">Close</button>
            </div>
        </div>
    </div>

    <!-- Monetag Ads Script -->
    <script src='//libtl.com/sdk.js' data-zone='10290264' data-sdk='show_10290264'></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
            authDomain: "msc-by-shawon.firebaseapp.com",
            projectId: "msc-by-shawon",
            storageBucket: "msc-by-shawon.firebasestorage.app",
            messagingSenderId: "432753389120",
            appId: "1:432753389120:web:dcbb46ca39408a405579a5",
            measurementId: "G-8LHGLJSSEE"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Telegram Bot API
        const telegramBotToken = '8099896534:AAFmOTkOjLC8RSSJy-dXtjPQotF3hJlyXTQ';
        const telegramBotUrl = `https://api.telegram.org/bot${telegramBotToken}`;

        // App State
        let currentUser = null;
        let userBalance = 0;
        let isFarming = false;
        let farmingStartTime = null;
        let farmingEndTime = null;
        let farmingInterval = null;
        let countdownInterval = null;
        let isWalletConnected = false;
        let walletAddress = null;
        let referrals = [];
        let tasks = [];
        let leaderboard = [];

        // DOM Elements
        const loadingScreen = document.getElementById('loadingScreen');
        const loadingSubtext = document.getElementById('loadingSubtext');
        const notification = document.getElementById('notification');
        const themeToggle = document.getElementById('themeToggle');
        const balanceElement = document.getElementById('balance');
        const miningCoin = document.getElementById('miningCoin');
        const startFarmingBtn = document.getElementById('startFarmingBtn');
        const farmingCountdown = document.getElementById('farmingCountdown');
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const walletInfo = document.getElementById('walletInfo');
        const walletAddressElement = document.getElementById('walletAddress');
        const tasksList = document.getElementById('tasksList');
        const leaderboardList = document.getElementById('leaderboardList');
        const referralLink = document.getElementById('referralLink');
        const copyReferralBtn = document.getElementById('copyReferralBtn');
        const totalReferrals = document.getElementById('totalReferrals');
        const referralEarnings = document.getElementById('referralEarnings');
        const referralsList = document.getElementById('referralsList');
        const profileAvatar = document.getElementById('profileAvatar');
        const profileName = document.getElementById('profileName');
        const profileLevel = document.getElementById('profileLevel');
        const profileBalance = document.getElementById('profileBalance');
        const profileFriends = document.getElementById('profileFriends');
        const profileRank = document.getElementById('profileRank');
        const notificationsToggle = document.getElementById('notificationsToggle');
        const soundToggle = document.getElementById('soundToggle');
        const autoFarmingToggle = document.getElementById('autoFarmingToggle');
        const walletModal = document.getElementById('walletModal');
        const closeWalletModal = document.getElementById('closeWalletModal');
        const closeWalletModalBtn = document.getElementById('closeWalletModalBtn');
        const modalWalletAddress = document.getElementById('modalWalletAddress');
        const copyWalletBtn = document.getElementById('copyWalletBtn');
        const disconnectWalletBtn = document.getElementById('disconnectWalletBtn');
        const monetagAds = document.getElementById('monetagAds');

        // Navigation
        const homeNavBtn = document.getElementById('homeNavBtn');
        const tasksNavBtn = document.getElementById('tasksNavBtn');
        const leaderboardNavBtn = document.getElementById('leaderboardNavBtn');
        const friendsNavBtn = document.getElementById('friendsNavBtn');
        const profileNavBtn = document.getElementById('profileNavBtn');

        const homeSection = document.getElementById('homeSection');
        const tasksSection = document.getElementById('tasksSection');
        const leaderboardSection = document.getElementById('leaderboardSection');
        const friendsSection = document.getElementById('friendsSection');
        const profileSection = document.getElementById('profileSection');

        // Initialize Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        // Initialize App
        function initApp() {
            // Get user data from Telegram
            const telegramUser = tg.initDataUnsafe?.user;
            
            if (telegramUser) {
                currentUser = {
                    id: telegramUser.id,
                    firstName: telegramUser.first_name,
                    lastName: telegramUser.last_name || '',
                    username: telegramUser.username || '',
                    photoUrl: telegramUser.photo_url || 'https://i.postimg.cc/fTQktNmX/maincoin.png'
                };

                // Update loading screen with referral info if available
                const urlParams = new URLSearchParams(window.location.search);
                const referrerId = urlParams.get('startapp');
                
                if (referrerId && referrerId !== currentUser.id.toString()) {
                    loadingSubtext.textContent = `Referred by user ${referrerId}`;
                    // Process referral
                    processReferral(referrerId);
                } else {
                    loadingSubtext.textContent = 'Welcome, ' + currentUser.firstName + '!';
                }

                // Load user data from Firebase
                loadUserData();
                
                // Load tasks from Firebase
                loadTasks();
                
                // Load leaderboard from Firebase
                loadLeaderboard();
                
                // Load referrals from Firebase
                loadReferrals();
                
                // Initialize Monetag Ads
                initializeMonetagAds();
                
                // Hide loading screen after a delay
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 2000);
            } else {
                // Fallback for testing outside Telegram
                currentUser = {
                    id: 123456789,
                    firstName: 'Test',
                    lastName: 'User',
                    username: 'testuser',
                    photoUrl: 'https://i.postimg.cc/fTQktNmX/maincoin.png'
                };
                
                loadingSubtext.textContent = 'Welcome, ' + currentUser.firstName + '!';
                
                // Load user data from Firebase
                loadUserData();
                
                // Load tasks from Firebase
                loadTasks();
                
                // Load leaderboard from Firebase
                loadLeaderboard();
                
                // Load referrals from Firebase
                loadReferrals();
                
                // Initialize Monetag Ads
                initializeMonetagAds();
                
                // Hide loading screen after a delay
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                }, 2000);
            }
        }

        // Load user data from Firebase
        function loadUserData() {
            database.ref('users/' + currentUser.id).once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    userBalance = userData.balance || 0;
                    isFarming = userData.isFarming || false;
                    farmingStartTime = userData.farmingStartTime || null;
                    farmingEndTime = userData.farmingEndTime || null;
                    isWalletConnected = userData.isWalletConnected || false;
                    walletAddress = userData.walletAddress || null;
                    referrals = userData.referrals || [];
                    
                    // Update UI with user data
                    updateBalance();
                    updateProfile();
                    updateWalletStatus();
                    
                    // Check if farming is in progress
                    if (isFarming && farmingEndTime) {
                        const now = new Date().getTime();
                        if (now < farmingEndTime) {
                            // Continue farming
                            startFarming(false);
                        } else {
                            // Farming completed
                            completeFarming();
                        }
                    }
                } else {
                    // Create new user
                    saveUserData();
                }
            }).catch((error) => {
                console.error("Error loading user data:", error);
                showNotification("Error loading user data", "error");
            });
        }

        // Save user data to Firebase
        function saveUserData() {
            database.ref('users/' + currentUser.id).set({
                id: currentUser.id,
                firstName: currentUser.firstName,
                lastName: currentUser.lastName,
                username: currentUser.username,
                photoUrl: currentUser.photoUrl,
                balance: userBalance,
                isFarming: isFarming,
                farmingStartTime: farmingStartTime,
                farmingEndTime: farmingEndTime,
                isWalletConnected: isWalletConnected,
                walletAddress: walletAddress,
                referrals: referrals,
                lastUpdated: new Date().toISOString()
            }).then(() => {
                console.log("User data saved successfully");
            }).catch((error) => {
                console.error("Error saving user data:", error);
                showNotification("Error saving user data", "error");
            });
        }

        // Update balance in UI
        function updateBalance() {
            balanceElement.textContent = userBalance.toFixed(3);
            profileBalance.textContent = userBalance.toFixed(3);
        }

        // Update profile in UI
        function updateProfile() {
            profileAvatar.src = currentUser.photoUrl;
            profileName.textContent = currentUser.firstName + ' ' + currentUser.lastName;
            
            // Update level based on balance
            let level, levelClass;
            if (userBalance < 10000) {
                level = 'Bronze';
                levelClass = 'level-bronze';
            } else if (userBalance < 50000) {
                level = 'Gold';
                levelClass = 'level-gold';
            } else {
                level = 'Diamond';
                levelClass = 'level-diamond';
            }
            
            profileLevel.textContent = level;
            profileLevel.className = 'profile-level ' + levelClass;
            
            // Update friends count
            profileFriends.textContent = referrals.length;
            
            // Update rank
            updateRank();
        }

        // Update user rank
        function updateRank() {
            // Find user rank in leaderboard
            const userIndex = leaderboard.findIndex(user => user.id === currentUser.id);
            if (userIndex !== -1) {
                profileRank.textContent = '#' + (userIndex + 1);
            } else {
                profileRank.textContent = '-';
            }
        }

        // Update wallet status in UI
        function updateWalletStatus() {
            if (isWalletConnected && walletAddress) {
                walletAddressElement.textContent = walletAddress.substring(0, 6) + '...' + walletAddress.substring(walletAddress.length - 4);
                modalWalletAddress.textContent = walletAddress;
                connectWalletBtn.textContent = 'Connected';
                connectWalletBtn.classList.add('btn-success');
                connectWalletBtn.disabled = true;
            } else {
                walletAddressElement.textContent = 'Not Connected';
                modalWalletAddress.textContent = 'Not Connected';
                connectWalletBtn.textContent = 'Connect TON Wallet';
                connectWalletBtn.classList.remove('btn-success');
                connectWalletBtn.disabled = false;
            }
        }

        // Start farming
        function startFarming(isNew = true) {
            if (isFarming) return;
            
            isFarming = true;
            startFarmingBtn.textContent = 'Farming...';
            startFarmingBtn.disabled = true;
            miningCoin.classList.add('farming');
            
            if (isNew) {
                farmingStartTime = new Date().getTime();
                farmingEndTime = farmingStartTime + (12 * 60 * 60 * 1000); // 12 hours
                saveUserData();
            }
            
            // Update countdown
            updateCountdown();
            countdownInterval = setInterval(updateCountdown, 1000);
            
            // Add tokens every second
            farmingInterval = setInterval(() => {
                userBalance += 0.001;
                updateBalance();
                saveUserData();
                
                // Show floating coin animation
                showFloatingCoin();
            }, 1000);
        }

        // Update countdown
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = farmingEndTime - now;
            
            if (distance < 0) {
                completeFarming();
                return;
            }
            
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
            
            farmingCountdown.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Complete farming
        function completeFarming() {
            isFarming = false;
            startFarmingBtn.textContent = 'Start Farming';
            startFarmingBtn.disabled = false;
            miningCoin.classList.remove('farming');
            farmingCountdown.textContent = 'Start Farming';
            
            clearInterval(farmingInterval);
            clearInterval(countdownInterval);
            
            saveUserData();
            showNotification("Farming completed! You've earned TRM tokens.", "success");
        }

        // Show floating coin animation
        function showFloatingCoin() {
            const coin = document.createElement('div');
            coin.className = 'floating-coin';
            coin.textContent = '+0.001 TRM';
            
            const rect = miningCoin.getBoundingClientRect();
            coin.style.left = `${rect.left + rect.width / 2}px`;
            coin.style.top = `${rect.top}px`;
            
            document.body.appendChild(coin);
            
            setTimeout(() => {
                coin.remove();
            }, 2000);
        }

        // Connect TON Wallet
        function connectWallet() {
            // Open TON wallet connection
            window.open('https://trimint.vercel.app/', '_blank');
            
            // For demo purposes, we'll simulate a successful connection
            setTimeout(() => {
                isWalletConnected = true;
                walletAddress = 'EQD' + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
                updateWalletStatus();
                saveUserData();
                showNotification("Wallet connected successfully!", "success");
            }, 3000);
        }

        // Disconnect TON Wallet
        function disconnectWallet() {
            isWalletConnected = false;
            walletAddress = null;
            updateWalletStatus();
            saveUserData();
            showNotification("Wallet disconnected", "info");
            walletModal.classList.remove('active');
        }

        // Copy wallet address
        function copyWalletAddress() {
            if (walletAddress) {
                navigator.clipboard.writeText(walletAddress).then(() => {
                    showNotification("Wallet address copied to clipboard", "success");
                }).catch(err => {
                    console.error('Could not copy text: ', err);
                    showNotification("Failed to copy wallet address", "error");
                });
            }
        }

        // Load tasks from Firebase
        function loadTasks() {
            database.ref('tasks').once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const tasksData = snapshot.val();
                    tasks = Object.values(tasksData);
                    renderTasks();
                } else {
                    // No tasks available
                    tasksList.innerHTML = '<p>No tasks available at the moment.</p>';
                }
            }).catch((error) => {
                console.error("Error loading tasks:", error);
                showNotification("Error loading tasks", "error");
            });
        }

        // Render tasks
        function renderTasks() {
            tasksList.innerHTML = '';
            
            // Add Watch Ads task
            const watchAdsTask = document.createElement('div');
            watchAdsTask.className = 'task-item';
            watchAdsTask.innerHTML = `
                <div class="task-icon">
                    <i class="fas fa-ad"></i>
                </div>
                <div class="task-details">
                    <div class="task-title">Watch Ads</div>
                    <div class="task-reward">
                        <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM" width="16">
                        <span>1 TRM</span>
                    </div>
                </div>
                <button class="btn" id="watchAdsBtn">Watch</button>
            `;
            tasksList.appendChild(watchAdsTask);
            
            // Add other tasks
            tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = 'task-item';
                
                // Check if task is completed by the user
                const isCompleted = checkTaskCompleted(task.id);
                
                taskElement.innerHTML = `
                    <div class="task-icon">
                        <i class="fas fa-${task.icon || 'check-circle'}"></i>
                    </div>
                    <div class="task-details">
                        <div class="task-title">${task.name}</div>
                        <div class="task-reward">
                            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM" width="16">
                            <span>${task.reward} TRM</span>
                        </div>
                    </div>
                    <button class="btn ${isCompleted ? 'btn-success' : ''}" id="task-${task.id}" ${isCompleted ? 'disabled' : ''}>
                        ${isCompleted ? 'Completed' : 'Open'}
                    </button>
                `;
                
                tasksList.appendChild(taskElement);
                
                // Add event listener to task button
                const taskBtn = document.getElementById(`task-${task.id}`);
                if (taskBtn && !isCompleted) {
                    taskBtn.addEventListener('click', () => {
                        openTask(task);
                    });
                }
            });
            
            // Add event listener to Watch Ads button
            const watchAdsBtn = document.getElementById('watchAdsBtn');
            if (watchAdsBtn) {
                watchAdsBtn.addEventListener('click', () => {
                    watchAds();
                });
            }
        }

        // Check if task is completed by the user
        function checkTaskCompleted(taskId) {
            // This would check in Firebase if the user has completed the task
            // For demo purposes, we'll return false
            return false;
        }

        // Open task
        function openTask(task) {
            const taskBtn = document.getElementById(`task-${task.id}`);
            taskBtn.textContent = 'Processing...';
            taskBtn.disabled = true;
            
            // Open task link
            window.open(task.link, '_blank');
            
            // Simulate task completion after 10 seconds
            setTimeout(() => {
                userBalance += task.reward;
                updateBalance();
                saveUserData();
                
                taskBtn.textContent = 'Completed';
                taskBtn.classList.add('btn-success');
                
                showNotification(`Task completed! You've earned ${task.reward} TRM.`, "success");
                
                // Mark task as completed in Firebase
                markTaskCompleted(task.id);
            }, 10000);
        }

        // Mark task as completed in Firebase
        function markTaskCompleted(taskId) {
            database.ref('users/' + currentUser.id + '/completedTasks/' + taskId).set({
                completedAt: new Date().toISOString()
            }).then(() => {
                console.log("Task marked as completed");
            }).catch((error) => {
                console.error("Error marking task as completed:", error);
            });
        }

        // Watch ads
        function watchAds() {
            const watchAdsBtn = document.getElementById('watchAdsBtn');
            watchAdsBtn.textContent = 'Watching...';
            watchAdsBtn.disabled = true;
            
            // Show Monetag ads
            if (window.MonetagSDK) {
                window.MonetagSDK.showAd();
            }
            
            // Simulate ad completion after 5 seconds
            setTimeout(() => {
                userBalance += 1;
                updateBalance();
                saveUserData();
                
                watchAdsBtn.textContent = 'Watch';
                watchAdsBtn.disabled = false;
                
                showNotification("Ad watched! You've earned 1 TRM.", "success");
            }, 5000);
        }

        // Initialize Monetag Ads
        function initializeMonetagAds() {
            // Monetag ads will be initialized automatically by the script
            console.log("Monetag ads initialized");
        }

        // Load leaderboard from Firebase
        function loadLeaderboard() {
            database.ref('users').orderByChild('balance').limitToLast(25).once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const usersData = snapshot.val();
                    leaderboard = Object.values(usersData).reverse();
                    renderLeaderboard();
                } else {
                    // No users available
                    leaderboardList.innerHTML = '<p>No users on the leaderboard yet.</p>';
                }
            }).catch((error) => {
                console.error("Error loading leaderboard:", error);
                showNotification("Error loading leaderboard", "error");
            });
        }

        // Render leaderboard
        function renderLeaderboard() {
            leaderboardList.innerHTML = '';
            
            leaderboard.forEach((user, index) => {
                const leaderboardItem = document.createElement('div');
                leaderboardItem.className = 'leaderboard-item';
                
                // Determine rank color
                let rankClass = '';
                if (index === 0) rankClass = 'style="color: gold;"';
                else if (index === 1) rankClass = 'style="color: silver;"';
                else if (index === 2) rankClass = 'style="color: #cd7f32;"';
                
                leaderboardItem.innerHTML = `
                    <div class="leaderboard-rank" ${rankClass}>${index + 1}</div>
                    <img src="${user.photoUrl}" alt="${user.firstName}" class="leaderboard-avatar">
                    <div class="leaderboard-details">
                        <div class="leaderboard-name">${user.firstName} ${user.lastName}</div>
                        <div class="leaderboard-balance">
                            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM" width="16">
                            <span>${user.balance.toFixed(3)} TRM</span>
                        </div>
                    </div>
                `;
                
                leaderboardList.appendChild(leaderboardItem);
            });
        }

        // Load referrals from Firebase
        function loadReferrals() {
            // Update referral link
            referralLink.textContent = `https://t.me/TrimintBot/mine?startapp=${currentUser.id}`;
            
            // Load referrals from Firebase
            database.ref('users/' + currentUser.id + '/referrals').once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const referralsData = snapshot.val();
                    referrals = Object.values(referralsData);
                    renderReferrals();
                } else {
                    // No referrals
                    referralsList.innerHTML = '<p>No referrals yet.</p>';
                }
                
                // Update referral stats
                totalReferrals.textContent = referrals.length;
                referralEarnings.textContent = (referrals.length * 5000).toFixed(3);
            }).catch((error) => {
                console.error("Error loading referrals:", error);
                showNotification("Error loading referrals", "error");
            });
        }

        // Render referrals
        function renderReferrals() {
            referralsList.innerHTML = '';
            
            referrals.forEach(referral => {
                const referralItem = document.createElement('div');
                referralItem.className = 'referral-item';
                
                referralItem.innerHTML = `
                    <img src="${referral.photoUrl}" alt="${referral.firstName}" class="referral-avatar">
                    <div class="referral-details">
                        <div class="referral-name">${referral.firstName} ${referral.lastName}</div>
                        <div class="referral-earned">
                            <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" alt="TRM" width="16">
                            <span>${referral.earned || 0} TRM earned</span>
                        </div>
                    </div>
                `;
                
                referralsList.appendChild(referralItem);
            });
        }

        // Process referral
        function processReferral(referrerId) {
            // Check if referrer exists
            database.ref('users/' + referrerId).once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    // Add referral to referrer's list
                    const referralData = {
                        id: currentUser.id,
                        firstName: currentUser.firstName,
                        lastName: currentUser.lastName,
                        username: currentUser.username,
                        photoUrl: currentUser.photoUrl,
                        joinedAt: new Date().toISOString(),
                        earned: 0
                    };
                    
                    database.ref('users/' + referrerId + '/referrals/' + currentUser.id).set(referralData).then(() => {
                        console.log("Referral added successfully");
                        
                        // Add reward to referrer
                        database.ref('users/' + referrerId).once('value').then((referrerSnapshot) => {
                            if (referrerSnapshot.exists()) {
                                const referrerData = referrerSnapshot.val();
                                const newBalance = (referrerData.balance || 0) + 5000;
                                
                                database.ref('users/' + referrerId + '/balance').set(newBalance).then(() => {
                                    console.log("Referral reward added successfully");
                                    showNotification("You've been referred by " + referrerData.firstName + "!", "info");
                                }).catch((error) => {
                                    console.error("Error adding referral reward:", error);
                                });
                            }
                        }).catch((error) => {
                            console.error("Error getting referrer data:", error);
                        });
                    }).catch((error) => {
                        console.error("Error adding referral:", error);
                    });
                }
            }).catch((error) => {
                console.error("Error checking referrer:", error);
            });
        }

        // Copy referral link
        function copyReferralLink() {
            const referralLinkText = `https://t.me/TrimintBot/mine?startapp=${currentUser.id}`;
            navigator.clipboard.writeText(referralLinkText).then(() => {
                showNotification("Referral link copied to clipboard", "success");
            }).catch(err => {
                console.error('Could not copy text: ', err);
                showNotification("Failed to copy referral link", "error");
            });
        }

        // Show notification
        function showNotification(message, type = 'info') {
            notification.textContent = message;
            notification.className = 'notification show';
            
            if (type === 'success') {
                notification.style.backgroundColor = 'var(--success-color)';
            } else if (type === 'error') {
                notification.style.backgroundColor = 'var(--danger-color)';
            } else {
                notification.style.backgroundColor = 'var(--primary-color)';
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Toggle theme
        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            body.setAttribute('data-theme', newTheme);
            
            // Update theme toggle icon
            const icon = themeToggle.querySelector('i');
            if (newTheme === 'dark') {
                icon.className = 'fas fa-sun';
            } else {
                icon.className = 'fas fa-moon';
            }
            
            // Save theme preference
            localStorage.setItem('theme', newTheme);
        }

        // Toggle settings
        function toggleSetting(toggleElement) {
            toggleElement.classList.toggle('active');
            
            // Save setting preference
            const settingName = toggleElement.id.replace('Toggle', '');
            const isActive = toggleElement.classList.contains('active');
            localStorage.setItem(settingName, isActive);
        }

        // Navigate to section
        function navigateToSection(sectionId) {
            // Hide all sections
            homeSection.classList.remove('active');
            tasksSection.classList.remove('active');
            leaderboardSection.classList.remove('active');
            friendsSection.classList.remove('active');
            profileSection.classList.remove('active');
            
            // Remove active class from all nav buttons
            homeNavBtn.classList.remove('active');
            tasksNavBtn.classList.remove('active');
            leaderboardNavBtn.classList.remove('active');
            friendsNavBtn.classList.remove('active');
            profileNavBtn.classList.remove('active');
            
            // Show selected section
            document.getElementById(sectionId + 'Section').classList.add('active');
            
            // Add active class to selected nav button
            document.getElementById(sectionId + 'NavBtn').classList.add('active');
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize app
            initApp();
            
            // Load theme preference
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.body.setAttribute('data-theme', savedTheme);
            
            // Update theme toggle icon
            const icon = themeToggle.querySelector('i');
            if (savedTheme === 'dark') {
                icon.className = 'fas fa-sun';
            } else {
                icon.className = 'fas fa-moon';
            }
            
            // Load settings preferences
            const notificationsEnabled = localStorage.getItem('notifications') !== 'false';
            const soundEnabled = localStorage.getItem('sound') !== 'false';
            const autoFarmingEnabled = localStorage.getItem('autoFarming') === 'true';
            
            if (!notificationsEnabled) {
                notificationsToggle.classList.remove('active');
            }
            
            if (!soundEnabled) {
                soundToggle.classList.remove('active');
            }
            
            if (autoFarmingEnabled) {
                autoFarmingToggle.classList.add('active');
            }
            
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Navigation
            homeNavBtn.addEventListener('click', () => navigateToSection('home'));
            tasksNavBtn.addEventListener('click', () => navigateToSection('tasks'));
            leaderboardNavBtn.addEventListener('click', () => navigateToSection('leaderboard'));
            friendsNavBtn.addEventListener('click', () => navigateToSection('friends'));
            profileNavBtn.addEventListener('click', () => navigateToSection('profile'));
            
            // Start farming
            startFarmingBtn.addEventListener('click', () => startFarming());
            
            // Connect wallet
            connectWalletBtn.addEventListener('click', connectWallet);
            
            // Wallet modal
            walletAddressElement.addEventListener('click', () => {
                if (isWalletConnected) {
                    walletModal.classList.add('active');
                }
            });
            
            closeWalletModal.addEventListener('click', () => {
                walletModal.classList.remove('active');
            });
            
            closeWalletModalBtn.addEventListener('click', () => {
                walletModal.classList.remove('active');
            });
            
            copyWalletBtn.addEventListener('click', copyWalletAddress);
            disconnectWalletBtn.addEventListener('click', disconnectWallet);
            
            // Copy referral link
            copyReferralBtn.addEventListener('click', copyReferralLink);
            
            // Settings toggles
            notificationsToggle.addEventListener('click', () => toggleSetting(notificationsToggle));
            soundToggle.addEventListener('click', () => toggleSetting(soundToggle));
            autoFarmingToggle.addEventListener('click', () => toggleSetting(autoFarmingToggle));
            
            // Check for auto farming
            if (autoFarmingToggle.classList.contains('active') && !isFarming) {
                startFarming();
            }
        });
    </script>
</body>
</html>
