<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trimint Admin Panel</title>
  <link rel="icon" href="https://i.postimg.cc/fTQktNmX/maincoin.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      /* Admin Dark Green Theme */
      --primary-color: #00d084;
      --secondary-color: #00a86b;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --dark-bg: #0a2e0a;
      --card-bg: #0d4d0d;
      --border-color: #106610;
      --text-primary: #ffffff;
      --text-secondary: #e0ffe0;
      --text-muted: #a0d0a0;
    }
    
    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0a2e0a 0%, #0d4d0d 30%, #106610 70%, #1a7a1a 100%);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    /* Login Screen */
    #loginScreen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #0a2e0a 0%, #0d4d0d 100%);
    }
    
    .login-container {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 40px;
      width: 100%;
      max-width: 400px;
      border: 1px solid var(--border-color);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }
    
    .login-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .login-logo {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin-bottom: 20px;
      filter: drop-shadow(0 8px 16px rgba(0, 208, 132, 0.4));
    }
    
    .login-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 8px;
    }
    
    .login-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
    }
    
    .form-input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      color: var(--text-primary);
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary-color);
      background: rgba(255, 255, 255, 0.08);
    }
    
    .form-input::placeholder {
      color: var(--text-muted);
    }
    
    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 208, 132, 0.3);
    }
    
    .login-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Admin Dashboard */
    #adminDashboard {
      display: none;
    }
    
    .admin-header {
      background: var(--card-bg);
      border-bottom: 1px solid var(--border-color);
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .admin-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
    }
    
    .admin-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .admin-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid var(--primary-color);
    }
    
    .admin-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .logout-btn {
      padding: 8px 16px;
      background: var(--danger-color);
      border: none;
      border-radius: 8px;
      color: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .logout-btn:hover {
      background: #dc2626;
    }
    
    .admin-container {
      display: flex;
      min-height: calc(100vh - 80px);
    }
    
    .sidebar {
      width: 250px;
      background: var(--card-bg);
      border-right: 1px solid var(--border-color);
      padding: 20px 0;
    }
    
    .sidebar-menu {
      list-style: none;
    }
    
    .sidebar-item {
      margin-bottom: 5px;
    }
    
    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 20px;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .sidebar-link:hover {
      background: rgba(0, 208, 132, 0.1);
      color: var(--primary-color);
    }
    
    .sidebar-link.active {
      background: rgba(0, 208, 132, 0.2);
      color: var(--primary-color);
      border-left: 3px solid var(--primary-color);
    }
    
    .sidebar-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .main-content {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    
    .content-section {
      display: none;
    }
    
    .content-section.active {
      display: block;
    }
    
    .section-header {
      margin-bottom: 30px;
    }
    
    .section-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
    }
    
    .section-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 24px;
      border: 1px solid var(--border-color);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    }
    
    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 16px;
      background: rgba(0, 208, 132, 0.1);
      color: var(--primary-color);
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    .stat-change {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
    }
    
    .stat-change.positive {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success-color);
    }
    
    .stat-change.negative {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger-color);
    }
    
    /* Tables */
    .table-container {
      background: var(--card-bg);
      border-radius: 15px;
      border: 1px solid var(--border-color);
      overflow: hidden;
      margin-bottom: 30px;
    }
    
    .table-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .table-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .table-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn-sm {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-primary {
      background: var(--primary-color);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--secondary-color);
    }
    
    .btn-secondary {
      background: var(--border-color);
      color: var(--text-secondary);
    }
    
    .btn-secondary:hover {
      background: #1a7a1a;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .data-table th {
      background: rgba(0, 208, 132, 0.1);
      padding: 16px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .data-table td {
      padding: 16px;
      border-top: 1px solid var(--border-color);
      font-size: 14px;
      color: var(--text-primary);
    }
    
    .data-table tr:hover {
      background: rgba(0, 208, 132, 0.05);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .user-avatar-small {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 2px solid var(--primary-color);
    }
    
    .user-details {
      display: flex;
      flex-direction: column;
    }
    
    .user-name {
      font-weight: 600;
      color: var(--text-primary);
    }
    
    .user-id {
      font-size: 12px;
      color: var(--text-muted);
    }
    
    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-active {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success-color);
    }
    
    .status-inactive {
      background: rgba(239, 68, 68, 0.1);
      color: var(--danger-color);
    }
    
    /* Charts */
    .chart-container {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 24px;
      border: 1px solid var(--border-color);
      margin-bottom: 30px;
    }
    
    .chart-header {
      margin-bottom: 20px;
    }
    
    .chart-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }
    
    /* Forms */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .form-card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 24px;
      border: 1px solid var(--border-color);
    }
    
    .form-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 20px;
    }
    
    .action-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-success {
      background: var(--success-color);
      color: white;
    }
    
    .btn-success:hover {
      background: #059669;
    }
    
    .btn-danger {
      background: var(--danger-color);
      color: white;
    }
    
    .btn-danger:hover {
      background: #dc2626;
    }
    
    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      color: var(--text-secondary);
    }
    
    .spinner {
      width: 24px;
      height: 24px;
      border: 2px solid var(--border-color);
      border-top-color: var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 12px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
    }
    
    .toast {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 10px;
      padding: 16px 20px;
      margin-bottom: 10px;
      min-width: 300px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease;
    }
    
    .toast.success {
      border-left: 4px solid var(--success-color);
    }
    
    .toast.error {
      border-left: 4px solid var(--danger-color);
    }
    
    .toast.warning {
      border-left: 4px solid var(--warning-color);
    }
    
    .toast-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .toast-message {
      font-size: 14px;
      color: var(--text-secondary);
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .admin-container {
        flex-direction: column;
      }
      
      .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
<script src="https://sites.super.myninja.ai/_assets/ninja-daytona-script.js"></script>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen">
    <div class="login-container">
      <div class="login-header">
        <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" class="login-logo" alt="Trimint">
        <h1 class="login-title">Admin Panel</h1>
        <p class="login-subtitle">Sign in to manage Trimint</p>
      </div>
      
      <form id="loginForm">
        <div class="form-group">
          <label class="form-label">Username</label>
          <input type="text" class="form-input" id="username" placeholder="Enter username" required>
        </div>
        
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-input" id="password" placeholder="Enter password" required>
        </div>
        
        <button type="submit" class="login-btn" id="loginBtn">
          Sign In
        </button>
      </form>
    </div>
  </div>
  
  <!-- Admin Dashboard -->
  <div id="adminDashboard">
    <header class="admin-header">
      <h1 class="admin-title">Trimint Admin Panel</h1>
      <div class="admin-user">
        <img src="https://i.postimg.cc/fTQktNmX/maincoin.png" class="admin-avatar" alt="Admin">
        <span class="admin-name" id="adminName">Admin</span>
        <button class="logout-btn" id="logoutBtn">Logout</button>
      </div>
    </header>
    
    <div class="admin-container">
      <aside class="sidebar">
        <nav>
          <ul class="sidebar-menu">
            <li class="sidebar-item">
              <a class="sidebar-link active" data-section="dashboard">
                <span class="sidebar-icon">üìä</span>
                <span>Dashboard</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" data-section="users">
                <span class="sidebar-icon">üë•</span>
                <span>Users</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" data-section="transactions">
                <span class="sidebar-icon">üí∞</span>
                <span>Transactions</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" data-section="referrals">
                <span class="sidebar-icon">ü§ù</span>
                <span>Referrals</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" data-section="tasks">
                <span class="sidebar-icon">‚úÖ</span>
                <span>Tasks</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" data-section="settings">
                <span class="sidebar-icon">‚öôÔ∏è</span>
                <span>Settings</span>
              </a>
            </li>
            <li class="sidebar-item">
              <a class="sidebar-link" data-section="analytics">
                <span class="sidebar-icon">üìà</span>
                <span>Analytics</span>
              </a>
            </li>
          </ul>
        </nav>
      </aside>
      
      <main class="main-content">
        <!-- Dashboard Section -->
        <section class="content-section active" id="dashboard">
          <div class="section-header">
            <h2 class="section-title">Dashboard</h2>
            <p class="section-subtitle">Overview of Trimint platform</p>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üë•</div>
              <div class="stat-value" id="totalUsers">0</div>
              <div class="stat-label">Total Users</div>
              <div class="stat-change positive">+12.5%</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">üí∞</div>
              <div class="stat-value" id="totalBalance">0</div>
              <div class="stat-label">Total TRM Supply</div>
              <div class="stat-change positive">+8.3%</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">ü§ù</div>
              <div class="stat-value" id="totalReferrals">0</div>
              <div class="stat-label">Total Referrals</div>
              <div class="stat-change positive">+15.2%</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">‚ö°</div>
              <div class="stat-value" id="activeFarmers">0</div>
              <div class="stat-label">Active Farmers</div>
              <div class="stat-change negative">-2.1%</div>
            </div>
          </div>
          
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">User Growth</h3>
            </div>
            <canvas id="userGrowthChart" width="400" height="200"></canvas>
          </div>
        </section>
        
        <!-- Users Section -->
        <section class="content-section" id="users">
          <div class="section-header">
            <h2 class="section-title">User Management</h2>
            <p class="section-subtitle">Manage all platform users</p>
          </div>
          
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">All Users</h3>
              <div class="table-actions">
                <button class="btn-sm btn-primary" id="exportUsersBtn">Export CSV</button>
                <button class="btn-sm btn-secondary" id="refreshUsersBtn">Refresh</button>
              </div>
            </div>
            <div class="data-table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>Balance</th>
                    <th>Referrals</th>
                    <th>Status</th>
                    <th>Joined</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody">
                  <tr>
                    <td colspan="6" class="loading">
                      <div class="spinner"></div>
                      Loading users...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
        
        <!-- Transactions Section -->
        <section class="content-section" id="transactions">
          <div class="section-header">
            <h2 class="section-title">Transaction Monitor</h2>
            <p class="section-subtitle">Track all TRM transactions</p>
          </div>
          
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Recent Transactions</h3>
              <div class="table-actions">
                <button class="btn-sm btn-primary" id="exportTransactionsBtn">Export CSV</button>
              </div>
            </div>
            <div class="data-table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Transaction ID</th>
                    <th>User</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Time</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody id="transactionsTableBody">
                  <tr>
                    <td colspan="6" class="loading">
                      <div class="spinner"></div>
                      Loading transactions...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
        
        <!-- Referrals Section -->
        <section class="content-section" id="referrals">
          <div class="section-header">
            <h2 class="section-title">Referral Statistics</h2>
            <p class="section-subtitle">Monitor referral program performance</p>
          </div>
          
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-icon">üéØ</div>
              <div class="stat-value" id="topReferrerCount">0</div>
              <div class="stat-label">Top Referrer Count</div>
            </div>
            
            <div class="stat-card">
              <div class="stat-icon">üíé</div>
              <div class="stat-value" id="totalCommissionPaid">0</div>
              <div class="stat-label">Total Commission Paid</div>
            </div>
          </div>
          
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Top Referrers</h3>
            </div>
            <div class="data-table-wrapper">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Rank</th>
                    <th>User</th>
                    <th>Referrals</th>
                    <th>Commission Earned</th>
                  </tr>
                </thead>
                <tbody id="referralsTableBody">
                  <tr>
                    <td colspan="4" class="loading">
                      <div class="spinner"></div>
                      Loading referrals...
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>
        
        <!-- Tasks Section -->
        <section class="content-section" id="tasks">
          <div class="section-header">
            <h2 class="section-title">Task Management</h2>
            <p class="section-subtitle">Manage platform tasks and rewards</p>
          </div>
          
          <div class="form-grid">
            <div class="form-card">
              <h3 class="form-title">Create New Task</h3>
              <form id="createTaskForm">
                <div class="form-group">
                  <label class="form-label">Task Name</label>
                  <input type="text" class="form-input" id="taskName" placeholder="Enter task name" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Reward (TRM)</label>
                  <input type="number" class="form-input" id="taskReward" placeholder="Enter reward amount" required>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Task Link</label>
                  <input type="url" class="form-input" id="taskLink" placeholder="https://example.com" required>
                </div>
                
                <div class="action-buttons">
                  <button type="submit" class="btn btn-success">Create Task</button>
                </div>
              </form>
            </div>
            
            <div class="form-card">
              <h3 class="form-title">Existing Tasks</h3>
              <div id="tasksList">
                <div class="loading">
                  <div class="spinner"></div>
                  Loading tasks...
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Settings Section -->
        <section class="content-section" id="settings">
          <div class="section-header">
            <h2 class="section-title">System Settings</h2>
            <p class="section-subtitle">Configure platform parameters</p>
          </div>
          
          <div class="form-grid">
            <div class="form-card">
              <h3 class="form-title">Farming Settings</h3>
              <form id="farmingSettingsForm">
                <div class="form-group">
                  <label class="form-label">Farming Duration (hours)</label>
                  <input type="number" class="form-input" id="farmingDuration" value="12" min="1" max="24">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Farming Rate (TRM per second)</label>
                  <input type="number" class="form-input" id="farmingRate" value="0.001" step="0.001" min="0.001">
                </div>
                
                <div class="action-buttons">
                  <button type="submit" class="btn btn-success">Update Settings</button>
                </div>
              </form>
            </div>
            
            <div class="form-card">
              <h3 class="form-title">Referral Settings</h3>
              <form id="referralSettingsForm">
                <div class="form-group">
                  <label class="form-label">Referral Bonus (TRM)</label>
                  <input type="number" class="form-input" id="referralBonus" value="5000" min="0">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Commission Rate (%)</label>
                  <input type="number" class="form-input" id="commissionRate" value="20" min="0" max="100">
                </div>
                
                <div class="action-buttons">
                  <button type="submit" class="btn btn-success">Update Settings</button>
                </div>
              </form>
            </div>
          </div>
        </section>
        
        <!-- Analytics Section -->
        <section class="content-section" id="analytics">
          <div class="section-header">
            <h2 class="section-title">Analytics & Reports</h2>
            <p class="section-subtitle">Detailed platform analytics</p>
          </div>
          
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">TRM Distribution</h3>
            </div>
            <canvas id="trmDistributionChart" width="400" height="200"></canvas>
          </div>
          
          <div class="chart-container">
            <div class="chart-header">
              <h3 class="chart-title">Daily Active Users</h3>
            </div>
            <canvas id="dailyActiveUsersChart" width="400" height="200"></canvas>
          </div>
        </section>
      </main>
    </div>
  </div>
  
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>
  
  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
      authDomain: "msc-by-shawon.firebaseapp.com",
      databaseURL: "https://msc-by-shawon-default-rtdb.firebaseio.com",
      projectId: "msc-by-shawon",
      storageBucket: "msc-by-shawon.firebasestorage.app",
      messagingSenderId: "432753389120",
      appId: "1:432753389120:web:dcbb46ca39408a405579a5",
      measurementId: "G-8LHGLJSSEE"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    // Global Variables
    let currentUser = null;
    let usersData = [];
    let transactionsData = [];
    
    // DOM Elements
    const loginScreen = document.getElementById('loginScreen');
    const adminDashboard = document.getElementById('adminDashboard');
    const loginForm = document.getElementById('loginForm');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const adminName = document.getElementById('adminName');
    
    // Toast Notification System
    function showToast(title, message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <div class="toast-title">${title}</div>
        <div class="toast-message">${message}</div>
      `;
      
      const toastContainer = document.getElementById('toastContainer');
      toastContainer.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 5000);
    }
    
    // Authentication
    function authenticate(username, password) {
      // Simple authentication - in production, use proper auth system
      const validCredentials = {
        'admin': 'trimint2024',
        'trimint': 'admin123'
      };
      
      return validCredentials[username] === password;
    }
    
    // Login Handler
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = usernameInput.value.trim();
      const password = passwordInput.value.trim();
      
      if (!username || !password) {
        showToast('Error', 'Please enter username and password', 'error');
        return;
      }
      
      loginBtn.disabled = true;
      loginBtn.textContent = 'Signing in...';
      
      setTimeout(() => {
        if (authenticate(username, password)) {
          currentUser = username;
          adminName.textContent = username.charAt(0).toUpperCase() + username.slice(1);
          
          loginScreen.style.display = 'none';
          adminDashboard.style.display = 'block';
          
          showToast('Success', 'Welcome to Trimint Admin Panel', 'success');
          
          // Load initial data
          loadDashboardData();
          loadUsers();
          loadTransactions();
          loadReferrals();
          loadTasks();
        } else {
          showToast('Error', 'Invalid credentials', 'error');
          loginBtn.disabled = false;
          loginBtn.textContent = 'Sign In';
        }
      }, 1000);
    });
    
    // Logout Handler
    logoutBtn.addEventListener('click', () => {
      currentUser = null;
      adminDashboard.style.display = 'none';
      loginScreen.style.display = 'flex';
      loginForm.reset();
      loginBtn.disabled = false;
      loginBtn.textContent = 'Sign In';
      
      showToast('Success', 'Logged out successfully', 'success');
    });
    
    // Sidebar Navigation
    document.querySelectorAll('.sidebar-link').forEach(link => {
      link.addEventListener('click', function() {
        const section = this.dataset.section;
        
        // Update active state
        document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
        this.classList.add('active');
        
        // Show corresponding section
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.getElementById(section).classList.add('active');
        
        // Load section-specific data
        if (section === 'dashboard') loadDashboardData();
        if (section === 'users') loadUsers();
        if (section === 'transactions') loadTransactions();
        if (section === 'referrals') loadReferrals();
        if (section === 'tasks') loadTasks();
        if (section === 'analytics') loadAnalytics();
      });
    });
    
    // Load Dashboard Data
    function loadDashboardData() {
      db.ref('users').once('value').then(snapshot => {
        const users = snapshot.val() || {};
        const userCount = Object.keys(users).length;
        
        let totalBalance = 0;
        let totalReferrals = 0;
        let activeFarmers = 0;
        
        Object.values(users).forEach(user => {
          totalBalance += user.balance || 0;
          if (user.farmingActive) activeFarmers++;
        });
        
        // Count referrals
        Object.values(users).forEach(user => {
          if (user.referredBy) totalReferrals++;
        });
        
        document.getElementById('totalUsers').textContent = userCount.toLocaleString();
        document.getElementById('totalBalance').textContent = Math.floor(totalBalance).toLocaleString();
        document.getElementById('totalReferrals').textContent = totalReferrals.toLocaleString();
        document.getElementById('activeFarmers').textContent = activeFarmers.toLocaleString();
        
        // Update charts
        updateUserGrowthChart();
      });
    }
    
    // Load Users
    function loadUsers() {
      const tbody = document.getElementById('usersTableBody');
      tbody.innerHTML = '<tr><td colspan="6" class="loading"><div class="spinner"></div>Loading users...</td></tr>';
      
      db.ref('users').once('value').then(snapshot => {
        const users = snapshot.val() || {};
        usersData = Object.entries(users).map(([id, user]) => ({ id, ...user }));
        
        tbody.innerHTML = '';
        
        usersData.forEach(user => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>
              <div class="user-info">
                <img src="${user.avatar || 'https://i.postimg.cc/fTQktNmX/maincoin.png'}" class="user-avatar-small" alt="${user.name}">
                <div class="user-details">
                  <div class="user-name">${user.name || 'Unknown'}</div>
                  <div class="user-id">ID: ${user.id}</div>
                </div>
              </div>
            </td>
            <td>${(user.balance || 0).toLocaleString()} TRM</td>
            <td>${user.referrals || 0}</td>
            <td>
              <span class="status-badge ${user.farmingActive ? 'status-active' : 'status-inactive'}">
                ${user.farmingActive ? 'Farming' : 'Inactive'}
              </span>
            </td>
            <td>${new Date((user.createdAt || Date.now()) * 1000).toLocaleDateString()}</td>
            <td>
              <button class="btn-sm btn-primary" onclick="viewUserDetails('${user.id}')">View</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      });
    }
    
    // Load Transactions
    function loadTransactions() {
      const tbody = document.getElementById('transactionsTableBody');
      tbody.innerHTML = '<tr><td colspan="6" class="loading"><div class="spinner"></div>Loading transactions...</td></tr>';
      
      // Simulate transaction data
      setTimeout(() => {
        tbody.innerHTML = `
          <tr>
            <td>#TRX001</td>
            <td>User 1</td>
            <td>Farming Reward</td>
            <td>43.2 TRM</td>
            <td>${new Date().toLocaleString()}</td>
            <td><span class="status-badge status-active">Completed</span></td>
          </tr>
          <tr>
            <td>#TRX002</td>
            <td>User 2</td>
            <td>Referral Bonus</td>
            <td>5,000 TRM</td>
            <td>${new Date().toLocaleString()}</td>
            <td><span class="status-badge status-active">Completed</span></td>
          </tr>
          <tr>
            <td>#TRX003</td>
            <td>User 3</td>
            <td>Task Reward</td>
            <td>10,000 TRM</td>
            <td>${new Date().toLocaleString()}</td>
            <td><span class="status-badge status-active">Completed</span></td>
          </tr>
        `;
      }, 1000);
    }
    
    // Load Referrals
    function loadReferrals() {
      const tbody = document.getElementById('referralsTableBody');
      tbody.innerHTML = '<tr><td colspan="4" class="loading"><div class="spinner"></div>Loading referrals...</td></tr>';
      
      db.ref('users').once('value').then(snapshot => {
        const users = snapshot.val() || {};
        const referralCounts = {};
        
        // Count referrals for each user
        Object.values(users).forEach(user => {
          if (user.referredBy) {
            referralCounts[user.referredBy] = (referralCounts[user.referredBy] || 0) + 1;
          }
        });
        
        // Get top referrers
        const topReferrers = Object.entries(referralCounts)
          .sort((a, b) => b[1] - a[1])
          .slice(0, 10);
        
        tbody.innerHTML = '';
        
        topReferrers.forEach(([userId, count], index) => {
          const user = users[userId];
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>#${index + 1}</td>
            <td>
              <div class="user-info">
                <img src="${user?.avatar || 'https://i.postimg.cc/fTQktNmX/maincoin.png'}" class="user-avatar-small" alt="${user?.name}">
                <div class="user-details">
                  <div class="user-name">${user?.name || 'Unknown'}</div>
                  <div class="user-id">ID: ${userId}</div>
                </div>
              </div>
            </td>
            <td>${count}</td>
            <td>${(count * 5000).toLocaleString()} TRM</td>
          `;
          tbody.appendChild(tr);
        });
        
        // Update stats
        document.getElementById('topReferrerCount').textContent = (topReferrers[0]?.[1] || 0).toLocaleString();
        document.getElementById('totalCommissionPaid').textContent = (Object.keys(referralCounts).length * 5000).toLocaleString();
      });
    }
    
    // Load Tasks
    function loadTasks() {
      const tasksList = document.getElementById('tasksList');
      tasksList.innerHTML = '<div class="loading"><div class="spinner"></div>Loading tasks...</div>';
      
      db.ref('tasks').once('value').then(snapshot => {
        const tasks = snapshot.val() || {};
        
        if (Object.keys(tasks).length === 0) {
          tasksList.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No tasks found</p>';
          return;
        }
        
        tasksList.innerHTML = '';
        
        Object.entries(tasks).forEach(([id, task]) => {
          const taskDiv = document.createElement('div');
          taskDiv.style.cssText = 'background: rgba(255, 255, 255, 0.05); padding: 12px; border-radius: 8px; margin-bottom: 8px;';
          taskDiv.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-weight: 600; color: var(--text-primary);">${task.name}</div>
                <div style="font-size: 12px; color: var(--text-muted);">Reward: ${task.amount} TRM</div>
              </div>
              <button class="btn-sm btn-danger" onclick="deleteTask('${id}')">Delete</button>
            </div>
          `;
          tasksList.appendChild(taskDiv);
        });
      });
    }
    
    // Create Task Handler
    document.getElementById('createTaskForm').addEventListener('submit', (e) => {
      e.preventDefault();
      
      const taskName = document.getElementById('taskName').value.trim();
      const taskReward = document.getElementById('taskReward').value.trim();
      const taskLink = document.getElementById('taskLink').value.trim();
      
      if (!taskName || !taskReward || !taskLink) {
        showToast('Error', 'Please fill all fields', 'error');
        return;
      }
      
      const newTask = {
        name: taskName,
        amount: taskReward,
        link: taskLink,
        createdAt: Date.now()
      };
      
      db.ref('tasks').push(newTask).then(() => {
        showToast('Success', 'Task created successfully', 'success');
        document.getElementById('createTaskForm').reset();
        loadTasks();
      }).catch(error => {
        showToast('Error', 'Failed to create task', 'error');
      });
    });
    
    // Delete Task
    function deleteTask(taskId) {
      if (confirm('Are you sure you want to delete this task?')) {
        db.ref('tasks/' + taskId).remove().then(() => {
          showToast('Success', 'Task deleted successfully', 'success');
          loadTasks();
        }).catch(error => {
          showToast('Error', 'Failed to delete task', 'error');
        });
      }
    }
    
    // Load Analytics
    function loadAnalytics() {
      loadTRMDistributionChart();
      loadDailyActiveUsersChart();
    }
    
    // Update User Growth Chart
    function updateUserGrowthChart() {
      const ctx = document.getElementById('userGrowthChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
          datasets: [{
            label: 'New Users',
            data: [120, 190, 300, 500, 720, 890],
            borderColor: '#00d084',
            backgroundColor: 'rgba(0, 208, 132, 0.1)',
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#e0ffe0' }
            }
          },
          scales: {
            y: {
              ticks: { color: '#e0ffe0' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            x: {
              ticks: { color: '#e0ffe0' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });
    }
    
    // Load TRM Distribution Chart
    function loadTRMDistributionChart() {
      const ctx = document.getElementById('trmDistributionChart').getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Farming Rewards', 'Referral Bonuses', 'Task Rewards', 'Ad Rewards'],
          datasets: [{
            data: [45000, 25000, 18000, 12000],
            backgroundColor: ['#00d084', '#00a86b', '#10b981', '#059669']
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#e0ffe0' }
            }
          }
        }
      });
    }
    
    // Load Daily Active Users Chart
    function loadDailyActiveUsersChart() {
      const ctx = document.getElementById('dailyActiveUsersChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
          datasets: [{
            label: 'Active Users',
            data: [320, 402, 378, 452, 389, 423, 467],
            backgroundColor: '#00d084'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              labels: { color: '#e0ffe0' }
            }
          },
          scales: {
            y: {
              ticks: { color: '#e0ffe0' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            x: {
              ticks: { color: '#e0ffe0' },
              grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
          }
        }
      });
    }
    
    // Export Users CSV
    document.getElementById('exportUsersBtn').addEventListener('click', () => {
      if (usersData.length === 0) {
        showToast('Error', 'No user data to export', 'error');
        return;
      }
      
      let csv = 'ID,Name,Balance,Referrals,Status,Created At\n';
      usersData.forEach(user => {
        csv += `${user.id},"${user.name || 'Unknown'}",${user.balance || 0},${user.referrals || 0},${user.farmingActive ? 'Farming' : 'Inactive'},"${new Date((user.createdAt || Date.now()) * 1000).toLocaleDateString()}"\n`;
      });
      
      downloadCSV(csv, 'trimint_users.csv');
      showToast('Success', 'Users data exported successfully', 'success');
    });
    
    // Export Transactions CSV
    document.getElementById('exportTransactionsBtn').addEventListener('click', () => {
      showToast('Info', 'Transaction export coming soon', 'warning');
    });
    
    // Refresh Users
    document.getElementById('refreshUsersBtn').addEventListener('click', () => {
      loadUsers();
      showToast('Success', 'Users data refreshed', 'success');
    });
    
    // Download CSV Helper
    function downloadCSV(csv, filename) {
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      window.URL.revokeObjectURL(url);
    }
    
    // View User Details
    function viewUserDetails(userId) {
      showToast('Info', `User details for ID: ${userId}`, 'success');
      // In production, this would open a modal with detailed user information
    }
    
    // Settings Forms
    document.getElementById('farmingSettingsForm').addEventListener('submit', (e) => {
      e.preventDefault();
      showToast('Success', 'Farming settings updated', 'success');
    });
    
    document.getElementById('referralSettingsForm').addEventListener('submit', (e) => {
      e.preventDefault();
      showToast('Success', 'Referral settings updated', 'success');
    });
  </script>
<script>
      // Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyAt9PRbvok0g5XL4187btrPvGx6VjfurJU",
        authDomain: "msc-by-shawon.firebaseapp.com",
        databaseURL: "https://msc-by-shawon-default-rtdb.firebaseio.com",
        projectId: "msc-by-shawon",
        storageBucket: "msc-by-shawon.firebasestorage.app",
        messagingSenderId: "432753389120",
        appId: "1:432753389120:web:dcbb46ca39408a405579a5"
      };
      
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
      
      // Admin credentials
      const ADMIN_CREDENTIALS = [
        { username: 'admin', password: 'trimint2024' },
        { username: 'trimint', password: 'admin123' }
      ];
      
      // DOM elements
      const loginScreen = document.getElementById('loginScreen');
      const adminDashboard = document.getElementById('adminDashboard');
      const loginForm = document.getElementById('loginForm');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const loginBtn = document.getElementById('loginBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      const adminName = document.getElementById('adminName');
      
      // Login functionality
      loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const username = usernameInput.value.trim();
        const password = passwordInput.value.trim();
        
        // Validate credentials
        const isValid = ADMIN_CREDENTIALS.some(cred => 
          cred.username === username && cred.password === password
        );
        
        if (isValid) {
          loginBtn.disabled = true;
          loginBtn.textContent = 'Signing in...';
          
          setTimeout(() => {
            adminName.textContent = username.charAt(0).toUpperCase() + username.slice(1);
            loginScreen.style.display = 'none';
            adminDashboard.style.display = 'block';
            showToast('Login successful', 'Welcome to Trimint Admin Panel', 'success');
            loadDashboard();
          }, 1000);
        } else {
          showToast('Login failed', 'Invalid username or password', 'error');
          passwordInput.value = '';
        }
      });
      
      // Logout functionality
      logoutBtn.addEventListener('click', function() {
        loginScreen.style.display = 'flex';
        adminDashboard.style.display = 'none';
        usernameInput.value = '';
        passwordInput.value = '';
        loginBtn.disabled = false;
        loginBtn.textContent = 'Sign In';
        showToast('Logged out', 'You have been successfully logged out', 'success');
      });
      
      // Sidebar navigation
      document.querySelectorAll('.sidebar-link').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Remove active class from all links
          document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
          
          // Add active class to clicked link
          this.classList.add('active');
          
          // Hide all sections
          document.querySelectorAll('.content-section').forEach(section => {
            section.classList.remove('active');
          });
          
          // Show selected section
          const sectionId = this.getAttribute('data-section');
          const targetSection = document.getElementById(sectionId);
          if (targetSection) {
            targetSection.classList.add('active');
            loadSectionData(sectionId);
          }
        });
      });
      
      // Load section data
      function loadSectionData(section) {
        switch(section) {
          case 'dashboard':
            loadDashboard();
            break;
          case 'users':
            loadUsers();
            break;
          case 'transactions':
            loadTransactions();
            break;
          case 'referrals':
            loadReferrals();
            break;
          case 'tasks':
            loadTasks();
            break;
          case 'settings':
            loadSettings();
            break;
          case 'analytics':
            loadAnalytics();
            break;
        }
      }
      
      // Dashboard data
      async function loadDashboard() {
        try {
          const usersSnapshot = await database.ref('users').once('value');
          const users = usersSnapshot.val() || {};
          
          const totalUsers = Object.keys(users).length;
          let totalTRM = 0;
          let totalReferrals = 0;
          let activeFarmers = 0;
          
          Object.values(users).forEach(user => {
            totalTRM += user.trmBalance || 0;
            if (user.referrals) {
              totalReferrals += Object.keys(user.referrals).length;
            }
            if (user.farming && user.farming.active) {
              activeFarmers++;
            }
          });
          
          // Update stats cards
          document.getElementById('totalUsers').textContent = totalUsers.toLocaleString();
          document.getElementById('totalTRM').textContent = totalTRM.toLocaleString();
          document.getElementById('totalReferrals').textContent = totalReferrals.toLocaleString();
          document.getElementById('activeFarmers').textContent = activeFarmers.toLocaleString();
          
        } catch (error) {
          console.error('Error loading dashboard:', error);
          showToast('Error', 'Failed to load dashboard data', 'error');
        }
      }
      
      // Load users
      async function loadUsers() {
        try {
          const usersSnapshot = await database.ref('users').once('value');
          const users = usersSnapshot.val() || {};
          
          const tbody = document.querySelector('#usersTable tbody');
          tbody.innerHTML = '';
          
          Object.entries(users).forEach(([userId, userData]) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>
                <div class="user-info">
                  <img src="${userData.photo_url || 'https://i.postimg.cc/fTQktNmX/maincoin.png'}" class="user-avatar-small" alt="User">
                  <div class="user-details">
                    <span class="user-name">${userData.firstName} ${userData.lastName || ''}</span>
                    <span class="user-id">ID: ${userId}</span>
                  </div>
                </div>
              </td>
              <td>${(userData.trmBalance || 0).toLocaleString()}</td>
              <td>${userData.level || 1}</td>
              <td>${userData.verified ? '‚úÖ Verified' : '‚ùå Not verified'}</td>
              <td>
                <span class="status-badge ${userData.online ? 'status-active' : 'status-inactive'}">
                  ${userData.online ? 'Active' : 'Inactive'}
                </span>
              </td>
              <td>
                <button class="btn-sm btn-primary" onclick="viewUserDetails('${userId}')">View</button>
                <button class="btn-sm btn-secondary" onclick="editUser('${userId}')">Edit</button>
              </td>
            `;
            tbody.appendChild(row);
          });
          
        } catch (error) {
          console.error('Error loading users:', error);
          showToast('Error', 'Failed to load users', 'error');
        }
      }
      
      // Load transactions
      async function loadTransactions() {
        try {
          const transactionsSnapshot = await database.ref('transactions').once('value');
          const transactions = transactionsSnapshot.val() || {};
          
          const tbody = document.querySelector('#transactionsTable tbody');
          tbody.innerHTML = '';
          
          Object.entries(transactions).forEach(([txId, txData]) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${txId.substring(0, 12)}...</td>
              <td>${txData.type || 'Unknown'}</td>
              <td>${txData.amount || 0} TRM</td>
              <td>${txData.userId ? txData.userId.substring(0, 12) + '...' : 'N/A'}</td>
              <td>${new Date(txData.timestamp || Date.now()).toLocaleString()}</td>
              <td>
                <span class="status-badge ${txData.status === 'completed' ? 'status-active' : 'status-inactive'}">
                  ${txData.status || 'pending'}
                </span>
              </td>
            `;
            tbody.appendChild(row);
          });
          
        } catch (error) {
          console.error('Error loading transactions:', error);
          showToast('Error', 'Failed to load transactions', 'error');
        }
      }
      
      // Load referrals
      async function loadReferrals() {
        try {
          const usersSnapshot = await database.ref('users').once('value');
          const users = usersSnapshot.val() || {};
          
          const referralData = [];
          
          Object.entries(users).forEach(([userId, userData]) => {
            if (userData.referrals) {
              const referralCount = Object.keys(userData.referrals).length;
              if (referralCount > 0) {
                referralData.push({
                  userId,
                  name: `${userData.firstName} ${userData.lastName || ''}`,
                  referrals: referralCount,
                  earnings: userData.referralEarnings || 0
                });
              }
            }
          });
          
          // Sort by referral count
          referralData.sort((a, b) => b.referrals - a.referrals);
          
          const tbody = document.querySelector('#referralsTable tbody');
          tbody.innerHTML = '';
          
          referralData.slice(0, 50).forEach(data => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>
                <div class="user-info">
                  <img src="${users[data.userId].photo_url || 'https://i.postimg.cc/fTQktNmX/maincoin.png'}" class="user-avatar-small" alt="User">
                  <div class="user-details">
                    <span class="user-name">${data.name}</span>
                    <span class="user-id">ID: ${data.userId.substring(0, 12)}...</span>
                  </div>
                </div>
              </td>
              <td>${data.referrals}</td>
              <td>${data.earnings.toLocaleString()} TRM</td>
              <td>
                <button class="btn-sm btn-primary" onclick="viewReferralDetails('${data.userId}')">View Details</button>
              </td>
            `;
            tbody.appendChild(row);
          });
          
        } catch (error) {
          console.error('Error loading referrals:', error);
          showToast('Error', 'Failed to load referral data', 'error');
        }
      }
      
      // Load tasks
      async function loadTasks() {
        try {
          const tasksSnapshot = await database.ref('tasks').once('value');
          const tasks = tasksSnapshot.val() || {};
          
          const tbody = document.querySelector('#tasksTable tbody');
          tbody.innerHTML = '';
          
          Object.entries(tasks).forEach(([taskId, taskData]) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${taskData.title || 'Untitled'}</td>
              <td>${taskData.reward || 0} TRM</td>
              <td>${taskData.type || 'Unknown'}</td>
              <td>${taskData.active ? 'Active' : 'Inactive'}</td>
              <td>${taskData.completions || 0}</td>
              <td>
                <button class="btn-sm btn-primary" onclick="editTask('${taskId}')">Edit</button>
                <button class="btn-sm btn-danger" onclick="deleteTask('${taskId}')">Delete</button>
              </td>
            `;
            tbody.appendChild(row);
          });
          
        } catch (error) {
          console.error('Error loading tasks:', error);
          showToast('Error', 'Failed to load tasks', 'error');
        }
      }
      
      // Load settings
      function loadSettings() {
        // Settings will be loaded from Firebase or local storage
        console.log('Loading settings...');
      }
      
      // Load analytics
      async function loadAnalytics() {
        try {
          const usersSnapshot = await database.ref('users').once('value');
          const users = usersSnapshot.val() || {};
          
          // Prepare data for charts
          const userGrowthData = prepareUserGrowthData(users);
          const trmDistributionData = prepareTRMDistributionData(users);
          
          // Create user growth chart
          const userGrowthCtx = document.getElementById('userGrowthChart').getContext('2d');
          new Chart(userGrowthCtx, {
            type: 'line',
            data: {
              labels: userGrowthData.labels,
              datasets: [{
                label: 'New Users',
                data: userGrowthData.data,
                borderColor: '#00d084',
                backgroundColor: 'rgba(0, 208, 132, 0.1)',
                tension: 0.4
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: {
                  display: false
                }
              }
            }
          });
          
          // Create TRM distribution chart
          const trmDistCtx = document.getElementById('trmDistributionChart').getContext('2d');
          new Chart(trmDistCtx, {
            type: 'doughnut',
            data: {
              labels: trmDistributionData.labels,
              datasets: [{
                data: trmDistributionData.data,
                backgroundColor: ['#00d084', '#00a86b', '#0099cc', '#006699', '#ffd700']
              }]
            },
            options: {
              responsive: true
            }
          });
          
        } catch (error) {
          console.error('Error loading analytics:', error);
          showToast('Error', 'Failed to load analytics', 'error');
        }
      }
      
      // Prepare user growth data
      function prepareUserGrowthData(users) {
        const last7Days = [];
        const today = new Date();
        
        for (let i = 6; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          last7Days.push(date.toISOString().split('T')[0]);
        }
        
        const data = last7Days.map(date => {
          return Object.values(users).filter(user => 
            user.joinDate && user.joinDate.startsWith(date)
          ).length;
        });
        
        return {
          labels: last7Days.map(date => new Date(date).toLocaleDateString()),
          data
        };
      }
      
      // Prepare TRM distribution data
      function prepareTRMDistributionData(users) {
        const distribution = {
          '0-1000': 0,
          '1000-10000': 0,
          '10000-50000': 0,
          '50000-100000': 0,
          '100000+': 0
        };
        
        Object.values(users).forEach(user => {
          const balance = user.trmBalance || 0;
          if (balance < 1000) distribution['0-1000']++;
          else if (balance < 10000) distribution['1000-10000']++;
          else if (balance < 50000) distribution['10000-50000']++;
          else if (balance < 100000) distribution['50000-100000']++;
          else distribution['100000+']++;
        });
        
        return {
          labels: Object.keys(distribution),
          data: Object.values(distribution)
        };
      }
      
      // User actions
      function viewUserDetails(userId) {
        console.log('Viewing user:', userId);
        // Implement user details modal
      }
      
      function editUser(userId) {
        console.log('Editing user:', userId);
        // Implement user edit modal
      }
      
      function viewReferralDetails(userId) {
        console.log('Viewing referral details:', userId);
        // Implement referral details modal
      }
      
      function editTask(taskId) {
        console.log('Editing task:', taskId);
        // Implement task edit modal
      }
      
      function deleteTask(taskId) {
        if (confirm('Are you sure you want to delete this task?')) {
          database.ref(`tasks/${taskId}`).remove()
            .then(() => {
              showToast('Success', 'Task deleted successfully', 'success');
              loadTasks();
            })
            .catch(error => {
              console.error('Error deleting task:', error);
              showToast('Error', 'Failed to delete task', 'error');
            });
        }
      }
      
      // Export users to CSV
      document.getElementById('exportUsersBtn').addEventListener('click', function() {
        database.ref('users').once('value')
          .then(snapshot => {
            const users = snapshot.val() || {};
            const csv = convertToCSV(users);
            downloadCSV(csv, 'trimint_users.csv');
            showToast('Success', 'Users exported successfully', 'success');
          })
          .catch(error => {
            console.error('Error exporting users:', error);
            showToast('Error', 'Failed to export users', 'error');
          });
      });
      
      // Convert data to CSV
      function convertToCSV(data) {
        const headers = ['User ID', 'First Name', 'Last Name', 'TRM Balance', 'Level', 'Verified', 'Join Date'];
        const rows = [headers.join(',')];
        
        Object.entries(data).forEach(([userId, userData]) => {
          const row = [
            userId,
            userData.firstName || '',
            userData.lastName || '',
            userData.trmBalance || 0,
            userData.level || 1,
            userData.verified || false,
            userData.joinDate || ''
          ];
          rows.push(row.join(','));
        });
        
        return rows.join('\n');
      }
      
      // Download CSV file
      function downloadCSV(csv, filename) {
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        window.URL.revokeObjectURL(url);
      }
      
      // Toast notification system
      function showToast(title, message, type = 'info') {
        const toastContainer = document.querySelector('.toast-container') || createToastContainer();
        
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = `
          <div class="toast-title">${title}</div>
          <div class="toast-message">${message}</div>
        `;
        
        toastContainer.appendChild(toast);
        
        setTimeout(() => {
          toast.style.animation = 'slideIn 0.3s ease reverse';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }
      
      function createToastContainer() {
        const container = document.createElement('div');
        container.className = 'toast-container';
        document.body.appendChild(container);
        return container;
      }
      
      // Settings form handlers
      document.getElementById('saveSettingsBtn').addEventListener('click', function() {
        const settings = {
          farmingDuration: parseInt(document.getElementById('farmingDuration').value) || 12,
          farmingRate: parseFloat(document.getElementById('farmingRate').value) || 0.001,
          referralBonus: parseInt(document.getElementById('referralBonus').value) || 5000,
          minWithdrawal: parseInt(document.getElementById('minWithdrawal').value) || 10000
        };
        
        database.ref('settings').set(settings)
          .then(() => {
            showToast('Success', 'Settings saved successfully', 'success');
          })
          .catch(error => {
            console.error('Error saving settings:', error);
            showToast('Error', 'Failed to save settings', 'error');
          });
      });
      
      // Task creation form
      document.getElementById('createTaskBtn').addEventListener('click', function() {
        const taskForm = document.getElementById('taskForm');
        const formData = new FormData(taskForm);
        
        const task = {
          title: document.getElementById('taskTitle').value,
          description: document.getElementById('taskDescription').value,
          reward: parseInt(document.getElementById('taskReward').value),
          type: document.getElementById('taskType').value,
          url: document.getElementById('taskUrl').value,
          active: true,
          completions: 0,
          createdAt: new Date().toISOString()
        };
        
        database.ref('tasks').push(task)
          .then(() => {
            showToast('Success', 'Task created successfully', 'success');
            taskForm.reset();
            loadTasks();
          })
          .catch(error => {
            console.error('Error creating task:', error);
            showToast('Error', 'Failed to create task', 'error');
          });
      });
      
    </script>
  </body>
</html>
